/*
* @Description: å…³é”®å¸§å°å·¥å…·,é€æ¸ä¸°å¯Œä¸­
* @Author: Bullet.S
* @Date: 2019-09-28 11:48:53
 * @LastEditors: Bullet.S
 * @LastEditTime: 2025-02-14 18:52:54
* @Email: animator.bullet@foxmail.com
*/
try(cui.UnRegisterDialogBar rolBsKeyTools) catch()
try(destroydialog rolBsKeyTools)catch()
try(destroydialog rolFnKeys)catch()
try(destroydialog rolAddMyScripts)catch()
try(destroydialog rolCustomFps)catch()
try(destroydialog rolCustomBtn)catch()
try (callbacks.removeScripts #animationRangeChange id:#BsUpdateTimeRange) catch ()
try (callbacks.removeScripts #filePostOpen id:#BsUpdateFps) catch ()
try (callbacks.removeScripts #timeunitsChange id:#BsUpdateFps) catch ()
try (callbacks.removeScripts #filePostOpen id:#BsUpdatePlaySpeed) catch ()
try (callbacks.removeScripts #timeunitsChange id:#BsUpdatePlaySpeed) catch ()
try (callbacks.removeScripts #filePostOpen id:#BsRefreshRecentFiles) catch ()

global curVerBsKeyTools  = "1.0.1"
global verUrlBsKeyTools  = "https://gitee.com/acebullet/BsKeyTools/raw/main/_BsKeyTools/version.dat"
global oldUrlBskeyTools  = "https://gitee.com/acebullet/BsKeyTools/raw/main/_BsKeyTools/_BsKeyTools%EF%BC%88%E8%A3%85%E5%AE%8C%E9%87%8D%E5%90%AFMAX,%E8%AF%AF%E6%9D%80%E8%AF%B7%E4%BF%A1%E4%BB%BB%EF%BC%89.exe"
global oldFileBsKeyTools = (getdir #temp) + "\\_BsKeyTools_Classic.exe"
-- global dlUrlBsKeyTools   = "https://gitee.com/acebullet/BsKeyTools/raw/main/_BsKeyTools/_BsKeyTools.exe"
global dlUrlBsKeyTools   = "https://anibullet.github.io/guide/"
global dlFileBsKeyTools  = (getdir #temp) + "\\_BsKeyTools.exe"

Global BulletConfig       = execute ("@\"" + (getDir #maxData) + "\\BulletConfig.ini\"")  --é…ç½®æ–‡ä»¶è·¯å¾„
Global startupBsKeyTools  = (getDir #Scripts) + "\\BulletScripts\\StartupMS\\BulletKeyTools.ms"
Global startupPath        = (getDir #StartupScripts)+ "\\BulletKeyTools.ms"
Global iniPos  	--ä½ç½®ä¿å­˜è®°å½•
global iniRolDockPos
global iniTogglePanelPos
Global idBtn                = 1
global iniBsAutoCheckUpdate = false
global iniCollopseType		= 0
Global switchToolPanel      = 0
-- global switchMSPanel        = 0
Global iniToolBtnAll        = #(101,102,103,104,105,106,107,108,109,110,111,112,
							201,202,203,204,205,206,207,208,209,210,211,212,
							301,302,303,304,305,306,307,308,309,310,311,312,
							401,402,403,404,405,406,407,408,409,410,411,412)
global iniIsIcon   = false
global tooglePersp = false
-- global isMouseInBsKeyTools = true
global dateTime    		= (dotNetClass "System.DateTime").Now
global iniCostTime 		= #(0,0,0,0)
global arrNewCostTime 	= iniCostTime

try(FileIn ((getDir #scripts) + "\\BulletScripts\\fnSaveLoadConfig.ms"))
catch(messagebox "åŠ è½½é…ç½®å¤±è´¥ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
stLoadConfigAll.fnLoadConfigBsKeyToolsAll()
try(FileIn ((getDir #scripts) + "\\BulletScripts\\fnCheckUpdate.ms"))
catch(messagebox "æ‰“å¼€ fnCheckUpdate.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
try(FileIn ((getDir #scripts) + "\\BulletScripts\\fnGetColorTheme.ms"))
catch(messagebox "æ‰“å¼€ fnGetColorTheme.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsSwitchBtnString.ms"))
catch(messagebox "æ‰“å¼€ BsSwitchBtnString.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")

Global arrToolC1 = #()
Global arrToolC2 = #()
Global arrToolC3 = #()
Global arrToolC4 = #()
Global arrSourToolC1 = #()
Global arrSourToolC2 = #()
Global arrSourToolC3 = #()
Global arrSourToolC4 = #()

Global rolBsKeyTools
global rolAddMyScripts
global rolTogglePanel
Global posMouMoved       = [0,0]
Global switchMouseState  = false
Global switchSelKeyRange = 0
Global arrLastSelRange   = #()
Global switchAllKeyRange = 0
Global iniAddToolbars    = 0
Global arrLastAllRange   = #()
Global arrKeysTime       = #()  -----------bipedå’Œboneçš„é¦–å°¾å¸§
Global arrLinkKeys       = #()  -----------å­˜linkå¸§
Global arrKeysSelected   = #()  -----------å­˜é€‰ä¸­çš„å¸§
global arrBlockingKeys   = #()  -----------é€‰ä¸­æˆ–è€…æ‰€æœ‰ç‰©ä½“çš„æ‰€æœ‰å…³é”®å¸§
global arrBoneEndAll     = #()  -----------æœ«ç«¯éª¨éª¼ä¸´æ—¶å±‚
Global keyFirst
Global keyEnd
Global keySelFirst
Global keySelEnd
Global fnAddKyes
Global fnSelectKeys
Global fnSelLinkKeys
-- Global fnAddLinkTimesKeys
-- Global fnAddLinkParamsKeys
Global keyMovedOffset = 5
Global symbol ----é€‰æ‹©çš„èŒƒå›´åˆ¤æ–­, 0å·¦è¾¹,1å³è¾¹,2å…¨éƒ¨
Global layerTraj --è½¨è¿¹è¾…åŠ©å±‚
Global arrTraj            = #()  ---è½¨è¿¹å­˜æ”¾æ•°ç»„, æ–¹ä¾¿åˆ é™¤
Global arrTempUnSelection = #()  ---éšè—æœªé€‰ä¸­ä¸´æ—¶å­˜æ”¾æ•°ç»„
Global menuSetFps
Global menuSetSpeed
Global SIOFile = dotNetClass "System.IO.File"
Global SIODir = dotNetClass "System.IO.Directory"
dotnet.loadAssembly "Microsoft.VisualBasic.dll"
Global FileIO = dotnetclass "Microsoft.VisualBasic.FileIO.FileSystem"
Global UIOption = (dotnetclass "Microsoft.VisualBasic.FileIO.UIOption").OnlyErrorDialogs
-- Global myTimer = dotnetobject "System.Timers.Timer" 500 autoreset:true
------------------å…¨å±€å˜é‡-------------------------------------------------------------------

-------------------å³é”®é¢æ¿ç©ºç™½å¤„è®¾ç½®---------------------------------------------------------
fn getFilesequenceFile f &base &digits = 
(
	f = getFilenameFile f
	base = trimRight f "0123456789"
	digits = subString f (base.count + 1) -1
)

fn fnPseudoNaturalSort a b =  --æ–‡ä»¶åæ’åºæ–°æ–¹æ³•--https://forums.cgsociety.org/t/sorting-filenames/1219205/4
(
	a = a as string
	b = b as string
	getFilesequenceFile a &aBase &aDigits
	-- hackhackhack.  This pads a number with zeros to 6 digits without using a loop.
	-- things will fail if there's more digits.. 6 'seems' safe.
	aDigits = subString ((1000000 + (aDigits as integer)) as string) 2 -1
	getFilesequenceFile b &bBase &bDigits
	bDigits = subString ((1000000 + (bDigits as integer)) as string) 2 -1
	a = aBase + aDigits
	b = bBase + bDigits

	case of (
	(a == b): 0
	(a < b): -1
	(a > b): 1
	)
)

------------------æ·»åŠ toolbar-----------------------------------------------
-- <Item typeID="2" type="CTB_MACROBUTTON" width="77" height="0" controlID="0" macroTypeID="3" macroType="MB_TYPE_ACTION" actionTableID="647394" imageID="-1" imageName="" actionID="BulletKeyTools`_[BulletTools]" tip="BsKeyTools" label="BsKeyTools" />

-- <Item typeID="2" type="CTB_MACROBUTTON" width="0" height="0" controlID="0" macroTypeID="3" macroType="MB_TYPE_ACTION" actionTableID="647394" imageID="-1" imageName="" actionID="BulletKeyTools`_[BulletTools]" tip="BsKeyTools" label="BsKeyTools" />
iniAddToolbars  = fnGetConfig iniAddToolbars "BulletKeyToolsSet"  "ToolBarBtn" (iniAddToolbars as string)
----addToolBarButtonåœ¨BsKeyToolsMenuBar.msä¸­
-----------------------------------------------------------------------------------------------------
global arrToolNewC1 = #();global arrToolNewC2 = #();global arrToolNewC3 = #();global arrToolNewC4 = #();
global arrToolsAll
global arrToolsNameAll

rollout rolCustomBtn "è‡ªå®šä¹‰åŠŸèƒ½æŒ‰é’®ä½ç½®" width:490 height:210
(
	dotNetControl dotnetBtnTabCon "System.Windows.Forms.TabControl" height:165 width:30 align:#center pos:[136,18]

	multilistbox mlbToolsBtnAll "å·²é€‰æ‹©:        " width:100 height:12 pos:[5,4] selection:0
	button btnAddToSort ">>>" width:30 height:40 pos:[106,20]
	button btnRemoveFromSort "<<<" width:30 height:40 pos:[106,60]
	listbox mlbToolBtn1 "å‰©ä½™:     " width:80 height:12 pos:[167,4] selection:0
	listbox mlbToolBtn2 "å‰©ä½™:     " width:80 height:12 pos:[247,4] selection:0
	listbox mlbToolBtn3 "å‰©ä½™:     " width:80 height:12 pos:[327,4] selection:0
	listbox mlbToolBtn4 "å‰©ä½™:     " width:80 height:12 pos:[407,4] selection:0
	button btnMoveUp "â†‘" width:30 height:40 pos:[106,100]
	button btnMoveDown "â†“" width:30 height:40 pos:[106,140]
	button btnResetBtn "é‡ç½®é»˜è®¤" width:60 height:25 pos:[0,185]
	button btnCollectCurrent "åŠ è½½å½“å‰" width:60 height:25 pos:[60,185]
	button btnReAdd "æ¸…ç©º" width:50 height:25 pos:[120,185]
	button btnSetBtn ">>> ç¡®è®¤è®¾ç½®æ’åºï¼ˆæ¯ç»„æœ€å¤š12ä¸ªæŒ‰é’®ï¼‰<<<" width:320 height:25 pos:[170,185]
	
	fn fnSwitchTab = 
	(
		local strCurIndex = (rolCustomBtn.dotnetBtnTabCon.SelectedIndex + 1) as string
		local arrMlbToolBtn = #(mlbToolBtn1,mlbToolBtn2,mlbToolBtn3,mlbToolBtn4)
		for i in arrMlbToolBtn do
		(
			if (i.name)[i.name.count] == strCurIndex then i.enabled = true
			else i.enabled = false
		)
	)
	
	on dotnetBtnTabCon Selected arg do
	(
		fnSwitchTab()
	)		
	
	fn fnToolBtnCountText =
	(
		mlbToolBtn1.caption = "å‰©ä½™: " + (12 - mlbToolBtn1.items.count) as string
		mlbToolBtn2.caption = "å‰©ä½™: " + (12 - mlbToolBtn2.items.count) as string
		mlbToolBtn3.caption = "å‰©ä½™: " + (12 - mlbToolBtn3.items.count) as string
		mlbToolBtn4.caption = "å‰©ä½™: " + (12 - mlbToolBtn4.items.count) as string
	)
	
	fn fnAddRemoveItems action:"add" =
	(
		local arrBtnSort = #(rolCustomBtn.mlbToolBtn1,rolCustomBtn.mlbToolBtn2,
							rolCustomBtn.mlbToolBtn3,rolCustomBtn.mlbToolBtn4)
		local arrTarSort = arrBtnSort[rolCustomBtn.dotnetBtnTabCon.SelectedIndex + 1]
		local numSelAddBtn = (rolCustomBtn.mlbToolsBtnAll.selection as array).count
		local arrBtnAllTemp = join #() (mlbToolsBtnAll.items as array)
		local arrTarSortTemp = join #() (arrTarSort.items as array)
		
		if (action == "add") then 
		(
			if numSelAddBtn > 0 and ((arrTarSort.items as array).count + numSelAddBtn) <= 12 then
			(
				for i in mlbToolsBtnAll.selection as array do
				(
					append arrTarSortTemp arrBtnAllTemp[i]
				)
				for i in mlbToolsBtnAll.selection as array do
				(
					deleteitem arrBtnAllTemp (finditem arrBtnAllTemp mlbToolsBtnAll.items[i])
				)
				arrTarSort.items = arrTarSortTemp
				mlbToolsBtnAll.items = arrBtnAllTemp
				-- mlbToolsBtnAll.selection = 0
			)
			else if ((arrTarSort.items as array).count + numSelAddBtn) > 12 then (messagebox"æ¯æ æœ€å¤š12ä¸ªæŒ‰é’®...          "beep:false)
		)
		else if (action == "remove") then 
		(
			if arrTarSort.selection != 0 then 
			(
				arrBtnAllTemp = join #(arrTarSort.selected) arrBtnAllTemp
				deleteitem arrTarSortTemp (finditem arrTarSortTemp arrTarSort.selected)
				mlbToolsBtnAll.items = arrBtnAllTemp
				arrTarSort.items = arrTarSortTemp
				-- arrTarSort.selection = 0
			)
		)
	)

	fn fnSaveBtnSort =
	(
		arrToolNewC1 = mlbToolBtn1.items
		arrToolNewC2 = mlbToolBtn2.items
		arrToolNewC3 = mlbToolBtn3.items
		arrToolNewC4 = mlbToolBtn4.items
		-- arrToolsAll = arrToolC1 + arrToolC2 + arrToolC3 + arrToolC4
		-- arrToolsNameAll = for i in arrToolsAll collect i.caption
		local arrToolsNewAll = arrToolNewC1 + arrToolNewC2 + arrToolNewC3 + arrToolNewC4
		local arrIniToolBtnAllNew = #()
		for i in arrToolsNewAll do 
		(
			append arrIniToolBtnAllNew iniToolBtnAll[finditem arrToolsNameAll i]
		)
		iniToolBtnAll = (join #() arrIniToolBtnAllNew)
		fnSetToolBtnConfig ()
		-- print iniToolBtnAll #nomap
		rolBsKeyTools.fnReloadToolsBtn()
		rolBsKeyTools.fnSwitchToolsBtn idBtn
	)

	fn fnRefreshMlbToolBtn =
	(
		mlbToolBtn1.items    = for i in arrToolC1 collect i.caption
		mlbToolBtn2.items    = for i in arrToolC2 collect i.caption
		mlbToolBtn3.items    = for i in arrToolC3 collect i.caption
		mlbToolBtn4.items    = for i in arrToolC4 collect i.caption
		mlbToolsBtnAll.items = #()
		fnToolBtnCountText()
	)

	fn fnCheckSort =
	(
		if (((mlbToolsBtnAll.items as array).count == 0) and ((mlbToolBtn1.items as array).count == 12) and
			((mlbToolBtn1.items as array).count == 12) and ((mlbToolBtn1.items as array).count == 12) and 
			((mlbToolBtn1.items as array).count == 12)) then (true) else (false)
	)

	fn fnMoveItems action:"MoveUp" = 
	(
		local arrBtnSort = #(rolCustomBtn.mlbToolBtn1,rolCustomBtn.mlbToolBtn2,
							rolCustomBtn.mlbToolBtn3,rolCustomBtn.mlbToolBtn4)
		local arrTarSort = arrBtnSort[rolCustomBtn.dotnetBtnTabCon.SelectedIndex + 1]
		local arrTarSortTemp = join #() (arrTarSort.items as array)
		
		if arrTarSort.selection != 0 then 
		(
			local tarSortBtn = arrTarSort.selected
			local tarSortBtnIndex = arrTarSort.selection
			
			if (action == "MoveUp") and (tarSortBtnIndex != 1) then 
			(
				deleteItem arrTarSortTemp tarSortBtnIndex
				insertitem tarSortBtn arrTarSortTemp (tarSortBtnIndex - 1)
				arrTarSort.selection = (tarSortBtnIndex - 1)
			)
			else if (action == "MoveDown") and (tarSortBtnIndex != 12) then
			(
				deleteItem arrTarSortTemp tarSortBtnIndex
				insertitem tarSortBtn arrTarSortTemp (tarSortBtnIndex + 1)
				arrTarSort.selection = (tarSortBtnIndex + 1)
			)
			arrTarSort.items = arrTarSortTemp
			-- print arrTarSortTemp #nomap
		)
	)

	on rolCustomBtn open do 
	(
		local arrBtnTabCon = #(rolBsKeyTools.ckbC1.caption,rolBsKeyTools.ckbC2.caption,
						rolBsKeyTools.ckbC3.caption,rolBsKeyTools.ckbC4.caption)
		arrToolNewC1              = #();arrToolNewC2 = #();arrToolNewC3 = #();arrToolNewC4 = #();
		arrToolsAll               = arrToolC1 + arrToolC2 + arrToolC3 + arrToolC4
		arrToolsNameAll           = for i in arrToolsAll collect i.caption
		mlbToolsBtnAll.items      = arrToolsNameAll
		mlbToolsBtnAll.text       = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
		dotnetBtnTabCon.dock      = dotnetBtnTabCon.dock.Fill
		dotnetBtnTabCon.Drawmode  = dotnetBtnTabCon.Drawmode.OwnerDrawFixed
		dotnetBtnTabCon.SizeMode  = dotnetBtnTabCon.SizeMode.Fixed
		dotnetBtnTabCon.ItemSize  = dotNetobject "System.Drawing.Size" 40 30
		dotnetBtnTabCon.alignment = (dotnetclass "system.Windows.Forms.Tabalignment").left
        
        for aTab in arrBtnTabCon do
        (
            dotnetBtnTabCon.TabPages.add aTab
        )
        rolCustomBtn.dotnetBtnTabCon.SelectedIndex = 0
		fnSwitchTab()
		fnToolBtnCountText()
	)
	
	on mlbToolsBtnAll selectionEnd do 
	(
		mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
	)
	
	on btnAddToSort pressed do
	(
		fnAddRemoveItems()
		fnToolBtnCountText()
		mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
	)

	on btnRemoveFromSort pressed do
	(
		fnAddRemoveItems action:"remove"
		fnToolBtnCountText()
		mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
	)

	on btnSetBtn pressed do 
	(
		if fnCheckSort() == true then
		(
			fnSaveBtnSort()
			try(destroydialog rolCustomBtn)catch()
		)
		else (messagebox "è¯·ç¡®è®¤æŒ‰é’®éƒ½æ’åºå®Œæ¯•,æ‰èƒ½å®Œæˆè®¾ç½®...                    " beep:false)
	)
	on btnResetBtn pressed do 
	(
		if (queryBox "æ˜¯å¦é‡ç½®åŠŸèƒ½æŒ‰é’®é»˜è®¤ä½ç½®ï¼Ÿ                   " \
		title:"é‡ç½®ä½ç½®" beep:false) then
		(
			iniToolBtnAll = #(101,102,103,104,105,106,107,108,109,110,111,112,
							201,202,203,204,205,206,207,208,209,210,211,212,
							301,302,303,304,305,306,307,308,309,310,311,312,
							401,402,403,404,405,406,407,408,409,410,411,412)
			fnSetToolBtnConfig ()
			rolBsKeyTools.fnReloadToolsBtn()
			rolBsKeyTools.fnSwitchToolsBtn idBtn
			-- print iniToolBtnAll #nomap
			fnRefreshMlbToolBtn()
			arrToolsAll = arrToolC1 + arrToolC2 + arrToolC3 + arrToolC4
			arrToolsNameAll = for i in arrToolsAll collect i.caption
			mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
		)
	)
	on btnReAdd pressed do 
	(
		if (queryBox "æ˜¯å¦æ¸…ç©ºå½“å‰åˆ—è¡¨é‡æ–°æ’åºï¼Ÿ                   " \
		title:"æ¸…ç©ºé‡æ–°æ’åº" beep:false) then
		(
			arrToolsAll = arrToolC1 + arrToolC2 + arrToolC3 + arrToolC4
			arrToolsNameAll = for i in arrToolsAll collect i.caption
			mlbToolsBtnAll.items = arrToolsNameAll
			arrToolNewC1 = #();arrToolNewC2 = #();arrToolNewC3 = #();arrToolNewC4 = #();
			mlbToolBtn1.items = #();mlbToolBtn2.items = #();mlbToolBtn3.items = #();mlbToolBtn4.items = #()
			fnToolBtnCountText()
			mlbToolsBtnAll.selection = 0
			mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
		)
	)
	on btnCollectCurrent pressed do 
	(
		fnRefreshMlbToolBtn()
		mlbToolsBtnAll.text = "å·²é€‰æ‹©: " + (rolCustomBtn.mlbToolsBtnAll.selection as array).count as string
	)
	
	on btnMoveUp pressed do 
	(
		fnMoveItems action:"MoveUp"
	)

	on btnMoveDown pressed do 
	(
		fnMoveItems action:"MoveDown"
	)
)
--------------------------------------------------------------------------------------------------------
fn fnSwitchIconStyle = 
(
	rolBsKeyTools.ckbFnBoxDisplay.images      = #("UVWUnwrapView_16i.bmp","UVWUnwrapView_16a.bmp",28,9,10,9,10,true,false)
	rolBsKeyTools.ckbIsoSelection.images      = #("IsolateSelection_16i.bmp","IsolateSelection_16i.bmp",1,1,1,1,1,true,true)
	-- rolBsKeyTools.chkJudgeLinkKey.images      = #("Maintoolbar_24i.bmp","Maintoolbar_24i.bmp",103,6,5,6,5,true,true)
	rolBsKeyTools.ckbShadowCut.images         = #("Radiosity_16i.bmp","Radiosity_16i.bmp",6,3,4,3,4,true,true)
	rolBsKeyTools.ckbFreezeMesh.images        = #("UVWUnwrapView_16i.bmp","UVWUnwrapView_16a.bmp",27,17,19,17,19,true,false)
	rolBsKeyTools.btnCutFrameDisplay.images   = #("AutoGrid_16i.bmp","AutoGrid_16i.bmp",2,2,2,2,2,true,true)
	rolBsKeyTools.btnAllFrameDisplay.images   = #("UVWUnwrapModes_16i.bmp","UVWUnwrapModes_16a.bmp",28,11,12,11,12,true,false)
	-- rolBsKeyTools.btnTrackBarTools.images     = #("PFSubObjectIcons_24i.bmp","PFSubObjectIcons_24i.bmp",2,2,2,2,2,true,true)
	rolBsKeyTools.ckbHideBones.images         = #("Systems_16i.bmp","Systems_16i.bmp",3,3,1,3,1,true,true)
	rolBsKeyTools.ckbHideBiped.images         = #("PhysX_Main_16i.bmp","PhysX_Main_16a.bmp",33,18,17,18,17,true,false)
	rolBsKeyTools.btnImageComp.images         = #("FileLinkActionItems_16i.bmp","FileLinkActionItems_16i.bmp",9,5,6,5,6,true,true)
	rolBsKeyTools.btnTrajedit.images          = #("bip_curve_16i.bmp","bip_curve_16i.bmp",20,7,7,7,7,true,true)
	rolBsKeyTools.btnFileOpen.images          = #("UVWUnwrapOption_16i.bmp","UVWUnwrapOption_16a.bmp",30,6,6,6,6,true,false)
	rolBsKeyTools.btnLightTable.images        = #("SW_PartDyn_16i.bmp","SW_PartDyn_16i.bmp",5,1,1,1,1,true,true)
	rolBsKeyTools.ckbPlayBlocking.images      = #("bip_mfltrans_i.bmp","bip_mfltrans_i.bmp",26,21,21,21,21,true,true)
	rolBsKeyTools.btnSpringMagic.images       = #("PhysX_Main_16i.bmp","PhysX_Main_16a.bmp",33,32,32,32,32,true,false)
	rolBsKeyTools.btnCSTools.images           = #("bip_layer_i.bmp","bip_layer_i.bmp",24,17,17,17,17,true,true)
	rolBsKeyTools.btnAnimCopyPaste.images     = #("UVWUnwrapView_16i.bmp","UVWUnwrapView_16a.bmp",27,1,2,1,2,true,false)
	rolBsKeyTools.btnLayerManager.images      = #("AnimLayerToolbar_16i.bmp","AnimLayerToolbar_16i.bmp",12,1,1,1,1,true,true)
	rolBsKeyTools.btnSelectionsetTools.images = #("enss_tools_16i.bmp","enss_tools_16i.bmp",13,1,1,1,1,true,true)
	rolBsKeyTools.btnPoseTool.images          = #("bip_modes_i.bmp","bip_modes_i.bmp",8,1,1,1,1,true,true)
	rolBsKeyTools.btnQuicksave.images         = #("PhysX_Main_16i.bmp","PhysX_Main_16a.bmp",33,1,1,1,1,true,false)
)

rcmenu menuConfig
(
	subMenu "å¸®åŠ©  /  Help"
	(
		menuItem mItemHelpVideo ">> è§†é¢‘æ•™ç¨‹ <<"
		menuItem mItemHelpDoc ">> å¸®åŠ©æ–‡æ¡£ <<"
		menuItem mItemBugReport ">> é—®é¢˜å»ºè®® <<"
		-- subMenu "å…³äºæˆ‘ [æ¬¢è¿äº¤æµ]"
		-- (
			separator menuAboutMe
			menuItem mItemBilibili "ğŸ“º Bilibili"
			menuItem mItemTwitter "ğŸ¦ Twitter"
			menuItem mItemQgroup "ğŸ§ Qgroup"
		-- )
		separator menuSepClose
		menuItem mItemUninstall "å¸è½½ [æœŸå¾…å†å†è§]"
	)
	submenu "é¢æ¿åµŒå…¥è®¾ç½®"
	(
		menuItem mItemFloat "æµ®åŠ¨" checked:(if not rolBsKeyTools.dialogBar then true else false)
		separator menuSepDock
		menuItem mItemTop "ä¸Š" checked:(if rolBsKeyTools.dialogBar and (cui.getDockState rolBsKeyTools) as string == "cui_dock_top" then true else false)
		menuItem mItemBottom "ä¸‹" checked:(if rolBsKeyTools.dialogBar and (cui.getDockState rolBsKeyTools) as string == "cui_dock_bottom" then true else false)
		menuItem mItemLeft "å·¦" checked:(if rolBsKeyTools.dialogBar and (cui.getDockState rolBsKeyTools) as string == "cui_dock_left" then true else false)
		menuItem mItemRight "å³" checked:(if rolBsKeyTools.dialogBar and (cui.getDockState rolBsKeyTools) as string == "cui_dock_right" then true else false)
	)
	separator menuSepHelp
	menuItem mItemCleanVirus "æ€æ¯’å·¥å…· [æ¨èå¼€å¯]"
	menuItem mItemWinBack "çª—å£æ‰¾å› [ä¼šæœ‰ç”¨çš„]"
	menuItem mItemTimeline "æ—¶é—´è½´å·¥å…· [Mayaé£æ ¼]"
	menuItem mItemIsStartup "æ˜¯å¦éš3dsMaxè‡ªå¯"
	menuItem mItemAddToolBarBtn "æ·»åŠ å·¥å…·æ å¿«é€Ÿå¯åŠ¨"
	subMenu "è‡ªå®šä¹‰åŠŸèƒ½é…ç½®"
	(
		menuItem mItemCustomSortBtn "è‡ªå®šä¹‰åŠŸèƒ½æŒ‰é’®ä½ç½®"
		-- menuItem mItemCustomScripts "è‡ªå®šä¹‰è„šæœ¬é…ç½®ç®¡ç†"
		menuItem mItemCollapse "è‡ªåŠ¨æ”¶ç¼©é¢æ¿ [ç²¾ç®€]"
		menuItem mItemCollapseFull "è‡ªåŠ¨æ”¶ç¼©é¢æ¿ [æµ®å¤¸]"
		menuItem mItemResetCount "é¢æ¿è®¡æ—¶é‡ç½® [æµ®å¤¸]"
		menuItem mItemIsIcon "åˆ‡æ¢å›¾æ ‡æ¨¡å¼ [å®éªŒ]"
	)
	separator menuSepCustom
	subMenu "æ›´æ–°è®¾ç½® [éœ€è¦è”ç½‘]"
	(
		menuItem mItemCheckUpdate "æ£€æŸ¥æ›´æ–° [éœ€è¦è”ç½‘]"
		menuItem mItemForceUpdate "å¼ºåˆ¶æ›´æ–° [Betaå°é²œ]"
		menuItem mItemAutoCheckUpdate "è‡ªå¯æ£€æµ‹ [å»ºè®®æ›´æ–°]"
		menuItem mItemUpdateLog "æ›´æ–°è®°å½• [éœ€æ±‚ä½•åœ¨]"
		menuItem mItemUndoVersion "å›é€€ç‰ˆæœ¬ [ä¸Šä¸ªç‰ˆæœ¬]"
	)
	subMenu "è°ƒè¯•ç›¸å…³ [è°¨æ…ä½¿ç”¨]"
	(
		menuItem mItemScriptsPath "è„šæœ¬ç›®å½• [æŸ¥é”™ä¼˜åŒ–]"
		menuItem mItemConfigFilePath "é…ç½®æ–‡ä»¶ [å¤‡ä»½å¯¼å…¥]"
		menuItem mItemBackupConfigFile "å¤‡ä»½é…ç½® [åˆ°ç”µè„‘æ¡Œé¢]"
		menuItem mItemDarkEditor "æ·±è‰²ç¼–è¾‘å™¨ [Maxscript]"
		menuItem mItemHelpDocs "è„šæœ¬æ–‡æ¡£ [3dsMaxå®˜æ–¹]"
		menuItem mItemFBXReview "FBXæŸ¥çœ‹å™¨ [3dsMaxå®˜æ–¹]"
		menuItem mItemRolloutBuilder "è„šæœ¬ç•Œé¢åˆ›å»º [å­¦ä¹ å·¥å…·]"
		menuItem mItemHwndViewer "å¥æŸ„ç ”ç©¶ [æŸ¥çœ‹å·¥å…·]"
		menuItem mItemDotNetProperty "DotNetå±æ€§ [ç´¢å¼•å·¥å…·]"
		menuItem mItemFixThumbnail "ä¿®å¤ç¼©ç•¥å›¾ [ç®¡ç†å‘˜è¿è¡Œ]"
	)
	menuItem mItemClose "å…³é—­å·¥å…· | [ Close ]"

	fn fnLoadDockPos rolTarget wSize hSize =
	(
		if doesFileExist BulletConfig do
		(
			curMaxVersion = ((maxVersion())[1] / 1000)
			if curMaxVersion > 20 then  --é«˜ç‰ˆæœ¬max,2019+
			(
				try
				(
					nameAttrClass = "BulletKeyToolsSet"
					btnsArr = rolTarget.controls
					iniRolDockPos = fnGetConfig iniRolDockPos nameAttrClass "DockPos" "float"
					case iniRolDockPos of
					(
						"cui_dock_top":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be horizontal
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 38
									btnsArr[b].width = 130
								)
								else if b == 2 then (btnsArr[b].pos = [50,20])
								else if b == 3 then (btnsArr[b].pos = [115,20])
								else if b == 4 then (btnsArr[b].pos = [351,2])
								else if b == 7 then (btnsArr[b].pos = [135,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 8 then (btnsArr[b].pos = [165,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 9 then (btnsArr[b].pos = [195,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 11 then (btnsArr[b].pos = [232,2];btnsArr[b].width = 47;btnsArr[b].height = 17)
								else if b == 12 then (btnsArr[b].pos = [230,20];btnsArr[b].width = 50)
								else if b == 13 then (btnsArr[b].pos = [280,0];btnsArr[b].width = 60)
								else if b == 14 then (btnsArr[b].pos = [280,20];btnsArr[b].width = 60)
								else if b == 15 then (btnsArr[b].pos = [380,0];btnsArr[b].width = 60;btnsArr[b].height = 20) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [380,20];btnsArr[b].width = 60;btnsArr[b].height = 20) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									btnsArr[b].height = 20
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,0])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,20])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].height = 20)
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 20)
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 20)
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x + btnsArr[b - 4].width,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 38 then (btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x + btnsArr[35].width + 5,0];btnsArr[b].height = 40;btnsArr[b].width = 25)
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[35].pos.y]
									btnsArr[b].height = 40
									btnsArr[b].width = 25
								)
								else if b == 43 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width + 5,0];btnsArr[b].width = 60;btnsArr[b].height = 20) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 56 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 67 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 68 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 79 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 80 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b > 44 and b <= 90 then 
								(
									btnsArr[b].height = 20
									btnsArr[b].width = 60
									if ((mod b 2) == 0) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,btnsArr[b - 2].pos.y])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,btnsArr[b - 2].pos.y])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = false
									btnsArr[b].pos = rolBsKeyTools.btnPos
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [342,22]
									btnsArr[b].width = 35
									btnsArr[b].height = 16
								)
								else if b == 95 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos;btnsArr[b].width = 130)
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 40
							rolTarget.width = 2050
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_horz)
							cui.DockDialogBar rolTarget #cui_dock_top
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_top as string))catch()
						)
						"cui_dock_bottom":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be horizontal
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 38
									btnsArr[b].width = 130
								)
								else if b == 2 then (btnsArr[b].pos = [50,20])
								else if b == 3 then (btnsArr[b].pos = [115,20])
								else if b == 4 then (btnsArr[b].pos = [351,2])
								else if b == 7 then (btnsArr[b].pos = [135,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 8 then (btnsArr[b].pos = [165,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 9 then (btnsArr[b].pos = [195,0];btnsArr[b].width = 30;btnsArr[b].height = 40)
								else if b == 11 then (btnsArr[b].pos = [232,2];btnsArr[b].width = 47;btnsArr[b].height = 17)
								else if b == 12 then (btnsArr[b].pos = [230,20];btnsArr[b].width = 50)
								else if b == 13 then (btnsArr[b].pos = [280,0];btnsArr[b].width = 60)
								else if b == 14 then (btnsArr[b].pos = [280,20];btnsArr[b].width = 60)
								else if b == 15 then (btnsArr[b].pos = [380,0];btnsArr[b].width = 60;btnsArr[b].height = 20) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [380,20];btnsArr[b].width = 60;btnsArr[b].height = 20) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									btnsArr[b].height = 20
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,0])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,20])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].height = 20)
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 20)
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 20)
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x + btnsArr[b - 4].width,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 38 then (btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x + btnsArr[35].width + 5,0];btnsArr[b].height = 40;btnsArr[b].width = 25)
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[35].pos.y]
									btnsArr[b].height = 40
									btnsArr[b].width = 25
								)
								else if b == 43 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width + 5,0];btnsArr[b].width = 60;btnsArr[b].height = 20) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 56 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 67 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 68 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 79 then (btnsArr[b].pos = [btnsArr[43].pos.x,0];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b == 80 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,20];btnsArr[b].width = 60;btnsArr[b].height = 20)
								else if b > 44 and b <= 90 then 
								(
									btnsArr[b].height = 20
									btnsArr[b].width = 60
									if ((mod b 2) == 0) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,btnsArr[b - 2].pos.y])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + btnsArr[b - 2].width,btnsArr[b - 2].pos.y])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = false
									btnsArr[b].pos = rolBsKeyTools.btnPos
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [342,22]
									btnsArr[b].width = 35
									btnsArr[b].height = 16
								)
								else if b == 95 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos;btnsArr[b].width = 130)
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 40
							rolTarget.width = 2050
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_horz)
							cui.DockDialogBar rolTarget #cui_dock_bottom
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_bottom as string))catch()
						)
						"cui_dock_left":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be vertical 
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 140
									btnsArr[b].width = 130
								)
								else if b == 2 then (btnsArr[b].pos = [50,40])
								else if b == 3 then (btnsArr[b].pos = [115,40])
								else if b == 4 then (btnsArr[b].pos = [5,20])
								else if b == 7 then (btnsArr[b].pos = [5,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 8 then (btnsArr[b].pos = [45,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 9 then (btnsArr[b].pos = [85,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 11 then (btnsArr[b].pos = [7,95];btnsArr[b].width = 55;btnsArr[b].height = 17)
								else if b == 12 then (btnsArr[b].pos = [65,93];btnsArr[b].width = 60)
								else if b == 13 then (btnsArr[b].pos = [5,115];btnsArr[b].width = 60)
								else if b == 14 then (btnsArr[b].pos = [65,115];btnsArr[b].width = 60)
								else if b == 15 then (btnsArr[b].pos = [5,155];btnsArr[b].width = 60;btnsArr[b].height = 25) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [65,155];btnsArr[b].width = 60;btnsArr[b].height = 25) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									btnsArr[b].height = 25
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [5,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
									else (btnsArr[b].pos = [65,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x,btnsArr[b - 4].pos.y + btnsArr[b - 4].height + 2];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 38 then
								(
									btnsArr[b].pos = [0,440]
									btnsArr[b].width = 130
									btnsArr[b].height = 260
								)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x,btnsArr[35].pos.y + btnsArr[35].height + 30];btnsArr[b].height = 30;btnsArr[b].width = 30)
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[35].pos.y + btnsArr[35].height + 30]
									btnsArr[b].width = 30
									btnsArr[b].height = 30
								)
								else if b == 43 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 56 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 67 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 68 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 79 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 80 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b > 44 and b <= 90 then 
								(
									;btnsArr[b].height = 32
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [5,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
									else (btnsArr[b].pos = [65,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = true;btnsArr[b].pos = [10,708]
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [25,20]
									btnsArr[b].width = 100
									btnsArr[b].height = 16
								)
								else if b == 95 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,725];btnsArr[b].width = 130)
								else if b == 96 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,140])
								else if b == 97 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,430])
								else if b == 98 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,880])
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 940
							rolTarget.width = 130
							--
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_vert)
							cui.DockDialogBar rolTarget #cui_dock_left
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_left as string))catch()
						)
						"cui_dock_right":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be vertical 
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 140
									btnsArr[b].width = 130
								)
								else if b == 2 then (btnsArr[b].pos = [50,40])
								else if b == 3 then (btnsArr[b].pos = [115,40])
								else if b == 4 then (btnsArr[b].pos = [5,20])
								else if b == 7 then (btnsArr[b].pos = [5,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 8 then (btnsArr[b].pos = [45,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 9 then (btnsArr[b].pos = [85,60];btnsArr[b].width = 40;btnsArr[b].height = 30)
								else if b == 11 then (btnsArr[b].pos = [7,95];btnsArr[b].width = 55;btnsArr[b].height = 17)
								else if b == 12 then (btnsArr[b].pos = [65,93];btnsArr[b].width = 60)
								else if b == 13 then (btnsArr[b].pos = [5,115];btnsArr[b].width = 60)
								else if b == 14 then (btnsArr[b].pos = [65,115];btnsArr[b].width = 60)
								else if b == 15 then (btnsArr[b].pos = [5,155];btnsArr[b].width = 60;btnsArr[b].height = 25) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [65,155];btnsArr[b].width = 60;btnsArr[b].height = 25) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									btnsArr[b].height = 25
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [5,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
									else (btnsArr[b].pos = [65,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].height = 25)
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x,btnsArr[b - 4].pos.y + btnsArr[b - 4].height + 2];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[b - 1].pos.y];btnsArr[b].width = 60;btnsArr[b].height = 25)
								else if b == 38 then
								(
									btnsArr[b].pos = [0,440]
									btnsArr[b].width = 130
									btnsArr[b].height = 260
								)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x,btnsArr[35].pos.y + btnsArr[35].height + 30];btnsArr[b].height = 30;btnsArr[b].width = 30)
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + btnsArr[b - 1].width,btnsArr[35].pos.y + btnsArr[35].height + 30]
									btnsArr[b].width = 30
									btnsArr[b].height = 30
								)
								else if b == 43 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 56 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 67 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 68 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 79 then (btnsArr[b].pos = [5,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b == 80 then (btnsArr[b].pos = [65,490];btnsArr[b].width = 60;btnsArr[b].height = 32)
								else if b > 44 and b <= 90 then 
								(
									;btnsArr[b].height = 32
									btnsArr[b].width = 60
									if ((mod b 2) == 1) then (btnsArr[b].pos = [5,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
									else (btnsArr[b].pos = [65,btnsArr[b - 2].pos.y + btnsArr[b - 2].height + 2])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = true;btnsArr[b].pos = [10,708]
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [25,20]
									btnsArr[b].width = 100
									btnsArr[b].height = 16
								)
								else if b == 95 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,725];btnsArr[b].width = 130)
								else if b == 96 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,140])
								else if b == 97 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,430])
								else if b == 98 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,880])
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 940
							rolTarget.width = 130
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_vert)
							cui.DockDialogBar rolTarget #cui_dock_right
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_right as string))catch()
						)
						default:
						(
							btnsArr[92].text = "2019.9 _ [ Bullet.S ]âœ¨"
							try(cui.UnRegisterDialogBar rolTarget)catch()
							-- for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							-- (
							-- 	case b of
							-- 	(
							-- 		(92):
							-- 		(
							-- 			btnsArr[b].pos = [12,226]
							-- 			btnsArr[b].width = 125 
							-- 			btnsArr[b].height = 15
							-- 		)
							-- 		default:
							-- 		(
										
							-- 		)
							-- 	)
							-- )
							rolTarget.height = hSize
							rolTarget.width = wSize
						)
					)
				)
				catch()
			)
			else
			(
				try
				(
					nameAttrClass = "BulletKeyToolsSet"
					btnsArr = rolTarget.controls
					iniRolDockPos = fnGetConfig iniRolDockPos nameAttrClass "DockPos" "float"
					case iniRolDockPos of
					(
						"cui_dock_top":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be horizontal
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 45
									btnsArr[b].width = 135
								)
								else if b == 2 then (btnsArr[b].pos = [50,25])
								else if b == 3 then (btnsArr[b].pos = [120,25])
								else if b == 4 then (btnsArr[b].pos = [415,5])
								else if b == 7 then (btnsArr[b].pos = [140,10])
								else if b == 8 then (btnsArr[b].pos = [190,10])
								else if b == 9 then (btnsArr[b].pos = [240,10])
								else if b == 11 then (btnsArr[b].pos = [297,7])
								else if b == 12 then (btnsArr[b].visible = true;btnsArr[b].pos = [295,25])
								else if b == 13 then (btnsArr[b].pos = [350,5])
								else if b == 14 then (btnsArr[b].pos = [350,25])
								else if b == 15 then (btnsArr[b].pos = [450,0]) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [450,25]) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									if ((mod b 2) == 1) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,0])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,25])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,0])
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,25])
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,25])
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x + 60,0])
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 38 then (btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x + 50 + 5,10])
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + 30,btnsArr[39].pos.y]
								)
								else if b == 43 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10]) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								-- else if b == 44 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25]) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 56 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 67 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 68 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 79 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 80 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b >= 44 and b <= 90 then 
								(
									-- btnsArr[b].pos = [btnsArr[b - 1].pos.x + 60,btnsArr[b - 1].pos.y]
									if ((mod (b - 43) 12) != 0) then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 60,btnsArr[b - 1].pos.y])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = false
									btnsArr[b].pos = rolBsKeyTools.btnPos
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [405,25]
								)
								else if b == 95 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos)
								-- else if b == 96 then (btnsArr[b].pos = [1435,20];btnsArr[b].width = 110)
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 50
							rolTarget.width = 1820
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_horz)
							cui.DockDialogBar rolTarget #cui_dock_top
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_top as string))catch()
						)
						"cui_dock_bottom":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be horizontal
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 45
									btnsArr[b].width = 135
								)
								else if b == 2 then (btnsArr[b].pos = [50,25])
								else if b == 3 then (btnsArr[b].pos = [120,25])
								else if b == 4 then (btnsArr[b].pos = [415,5])
								else if b == 7 then (btnsArr[b].pos = [140,10])
								else if b == 8 then (btnsArr[b].pos = [190,10])
								else if b == 9 then (btnsArr[b].pos = [240,10])
								else if b == 11 then (btnsArr[b].pos = [297,7])
								else if b == 12 then (btnsArr[b].visible = true;btnsArr[b].pos = [295,25])
								else if b == 13 then (btnsArr[b].pos = [350,5])
								else if b == 14 then (btnsArr[b].pos = [350,25])
								else if b == 15 then (btnsArr[b].pos = [450,0]) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [450,25]) --é¦–å°¾å¸§
								else if b > 16 and b < 31 then 
								(
									if ((mod b 2) == 1) then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,0])
									else (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,25])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 2].pos.x + 50,0])
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,25])
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,25])
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 4].pos.x + 60,0])
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 38 then (btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[35].pos.x + 50 + 5,10])
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + 30,btnsArr[39].pos.y]
								)
								else if b == 43 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10]) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								-- else if b == 44 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25]) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 56 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 67 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 68 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b == 79 then (btnsArr[b].pos = [btnsArr[42].pos.x + 35,10])
								-- else if b == 80 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x,25])
								else if b >= 44 and b <= 90 then 
								(
									-- btnsArr[b].pos = [btnsArr[b - 1].pos.x + 60,btnsArr[b - 1].pos.y]
									if ((mod (b - 43) 12) != 0) then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 60,btnsArr[b - 1].pos.y])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = false
									btnsArr[b].pos = rolBsKeyTools.btnPos
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = [405,25]
								)
								else if b == 95 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos)
								-- else if b == 96 then (btnsArr[b].pos = [1435,20];btnsArr[b].width = 110)
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 50
							rolTarget.width = 1820
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_horz)
							cui.DockDialogBar rolTarget #cui_dock_bottom
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_bottom as string))catch()
						)
						"cui_dock_left":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be vertical 
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 100
									btnsArr[b].width = 160
								)
								else if b == 2 then (btnsArr[b].pos = [52,20])
								else if b == 3 then (btnsArr[b].pos = [143,20])
								else if b == 4 then (btnsArr[b].pos = [70,20])
								else if b == 7 then (btnsArr[b].pos = [5,40])
								else if b == 8 then (btnsArr[b].pos = [55,40])
								else if b == 9 then (btnsArr[b].pos = [105,40])
								else if b == 11 then (btnsArr[b].pos = [7,77])
								else if b == 12 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 13 then (btnsArr[b].pos = [55,75])
								else if b == 14 then (btnsArr[b].pos = [105,75])
								else if b == 15 then (btnsArr[b].pos = [5,115]) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [55,115]) --é¦–å°¾å¸§
								else if b == 17 then (btnsArr[b].pos = [105,115]) --é¦–å°¾å¸§
								else if b > 17 and b < 31 then 
								(
									if ((mod b 3) == 0) then (btnsArr[b].pos = [5,btnsArr[b - 3].pos.y + 25 + 2])
									else if (mod b 3) == 1 then (btnsArr[b].pos = [55,btnsArr[b - 3].pos.y + 25 + 2])
									else if (mod b 3) == 2 then (btnsArr[b].pos = [105,btnsArr[b - 3].pos.y + 25 + 2])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 50,btnsArr[b - 1].pos.y])
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 40,btnsArr[b - 1].pos.y])
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,btnsArr[b - 1].pos.y])
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,btnsArr[b - 1].pos.y])
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 5].pos.x,btnsArr[b - 5].pos.y + 25 + 2])
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 50,btnsArr[b - 1].pos.y])
								else if b == 38 then
								(
									btnsArr[b].pos = [5,320]
									btnsArr[b].width = 150
									btnsArr[b].height = 260
								)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[30].pos.x + 15,btnsArr[30].pos.y + 50 + 35])
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + 30,btnsArr[39].pos.y]
								)
								else if b == 43 then (btnsArr[b].pos = [15,370]) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [85,370]) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [15,370])
								else if b == 56 then (btnsArr[b].pos = [85,370])
								else if b == 67 then (btnsArr[b].pos = [15,370])
								else if b == 68 then (btnsArr[b].pos = [85,370])
								else if b == 79 then (btnsArr[b].pos = [15,370])
								else if b == 80 then (btnsArr[b].pos = [85,370])
								else if b > 44 and b <= 90 then 
								(

									if ((mod b 2) == 1) then (btnsArr[b].pos = [15,btnsArr[b - 2].pos.y + 34])
									else (btnsArr[b].pos = [85,btnsArr[b - 2].pos.y + 34])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = true;btnsArr[b].pos = [25,590]
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = btnsArr[36].pos + [60,3]
								)
								else if b == 95 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,610])
								else if b == 96 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,100])
								else if b == 97 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,310])
								else if b == 98 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,765])
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 915
							rolTarget.width = 160
							--
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_vert)
							cui.DockDialogBar rolTarget #cui_dock_left
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_left as string))catch()
						)
						"cui_dock_right":
						(
							try(cui.UnRegisterDialogBar rolTarget)catch()
							--	rearrange buttons to be vertical 
							for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							(
								if b == 1 then
								(
									btnsArr[b].pos = [0,2]
									btnsArr[b].text = ("BsKeyTools_v" + curVerBsKeyTools)
									btnsArr[b].height = 100
									btnsArr[b].width = 160
								)
								else if b == 2 then (btnsArr[b].pos = [52,20])
								else if b == 3 then (btnsArr[b].pos = [143,20])
								else if b == 4 then (btnsArr[b].pos = [70,20])
								else if b == 7 then (btnsArr[b].pos = [5,40])
								else if b == 8 then (btnsArr[b].pos = [55,40])
								else if b == 9 then (btnsArr[b].pos = [105,40])
								else if b == 11 then (btnsArr[b].pos = [7,77])
								else if b == 12 then (btnsArr[b].visible = false;btnsArr[b].pos = rolBsKeyTools.btnPos)
								else if b == 13 then (btnsArr[b].pos = [55,75])
								else if b == 14 then (btnsArr[b].pos = [105,75])
								else if b == 15 then (btnsArr[b].pos = [5,115]) --é€‰å®šå¸§
								else if b == 16 then (btnsArr[b].pos = [55,115]) --é¦–å°¾å¸§
								else if b == 17 then (btnsArr[b].pos = [105,115]) --é¦–å°¾å¸§
								else if b > 17 and b < 31 then 
								(
									if ((mod b 3) == 0) then (btnsArr[b].pos = [5,btnsArr[b - 3].pos.y + 25 + 2])
									else if (mod b 3) == 1 then (btnsArr[b].pos = [55,btnsArr[b - 3].pos.y + 25 + 2])
									else if (mod b 3) == 2 then (btnsArr[b].pos = [105,btnsArr[b - 3].pos.y + 25 + 2])
								)
								else if b == 31 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 50,btnsArr[b - 1].pos.y])
								else if b == 32 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 40,btnsArr[b - 1].pos.y])
								else if b == 33 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,btnsArr[b - 1].pos.y])
								else if b == 34 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 20,btnsArr[b - 1].pos.y])
								else if b == 35 then (btnsArr[b].pos = [btnsArr[b - 5].pos.x,btnsArr[b - 5].pos.y + 25 + 2])
								else if b == 36 then (btnsArr[b].pos = [btnsArr[b - 1].pos.x + 50,btnsArr[b - 1].pos.y])
								else if b == 38 then
								(
									btnsArr[b].pos = [5,320]
									btnsArr[b].width = 150
									btnsArr[b].height = 260
								)
								else if b == 39 then (btnsArr[b].pos = [btnsArr[30].pos.x + 15,btnsArr[30].pos.y + 50 + 35])
								else if b >= 40 and b <= 42 then 
								(
									btnsArr[b].pos = [btnsArr[b - 1].pos.x + 30,btnsArr[39].pos.y]
								)
								else if b == 43 then (btnsArr[b].pos = [15,370]) --å³è¾¹å·¥å…·ç®±ç¬¬ä¸€ä¸ªæŒ‰é’®
								else if b == 44 then (btnsArr[b].pos = [85,370]) --å³è¾¹å·¥å…·ç®±ç¬¬äºŒä¸ªæŒ‰é’®
								else if b == 55 then (btnsArr[b].pos = [15,370])
								else if b == 56 then (btnsArr[b].pos = [85,370])
								else if b == 67 then (btnsArr[b].pos = [15,370])
								else if b == 68 then (btnsArr[b].pos = [85,370])
								else if b == 79 then (btnsArr[b].pos = [15,370])
								else if b == 80 then (btnsArr[b].pos = [85,370])
								else if b > 44 and b <= 90 then 
								(

									if ((mod b 2) == 1) then (btnsArr[b].pos = [15,btnsArr[b - 2].pos.y + 34])
									else (btnsArr[b].pos = [85,btnsArr[b - 2].pos.y + 34])
								)
								else if b == 92 then 
								(
									-- btnsArr[b].text = "2019 [ Bullet.S ]âœ¨"
									btnsArr[b].visible = true;btnsArr[b].pos = [25,590]
								)
								else if b == 93 then
								(
									btnsArr[b].text = "è®¾ç½®"
									btnsArr[b].pos = btnsArr[36].pos + [60,3]
								)
								else if b == 95 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,610])
								else if b == 96 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,100])
								else if b == 97 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,310])
								else if b == 98 then (btnsArr[b].visible = true;btnsArr[b].pos = [0,765])
								else
								(
									btnsArr[b].visible = false
									-- btnsArr[b].pos = [0,btnsArr[b - 1].pos.y + btnsArr[b - 1].height]
								)
							)
							rolTarget.height = 915
							rolTarget.width = 160
							cui.RegisterDialogBar rolTarget minSize:[rolTarget.width,rolTarget.height] maxSize:[rolTarget.width,rolTarget.height] style:#(#cui_dock_vert)
							cui.DockDialogBar rolTarget #cui_dock_right
							try(setINISetting BulletConfig nameAttrClass "DockPos" (#cui_dock_right as string))catch()
						)
						default:
						(
							-- btnsArr[92].text = "2019.9 _ [ Bullet.S ]âœ¨"
							try(cui.UnRegisterDialogBar rolTarget)catch()
							-- for b = 1 to btnsArr.count where ((btnsArr[b]) != undefined) do
							-- (
							-- 	case b of
							-- 	(
							-- 		(92):
							-- 		(
							-- 			btnsArr[b].pos = [12,226]
							-- 			btnsArr[b].width = 125 
							-- 			btnsArr[b].height = 15
							-- 		)
							-- 		default:
							-- 		(
										
							-- 		)
							-- 	)
							-- )
							rolTarget.height = hSize
							rolTarget.width = wSize
						)
					)
				)
				catch()
			)
		)
	)

	local startupEXTimelineMS = (getDir #Scripts) + "\\BulletScripts\\StartupMS\\EXTimelineStartup.ms"
	local startupEXTimelinePath = (getDir #StartupScripts)+ "\\EXTimelineStartup.ms"

	on menuConfig open do
	(
		-- rolBsKeyTools.timerTickTock.active = false
		-- stLoadConfigAll.fnLoadConfigBsKeyToolsAll ()
		if(SIOFile.Exists startupPath) then (mItemIsStartup.checked = true)
		else (mItemIsStartup.checked = false)
		if(SIOFile.Exists startupEXTimelinePath) then (mItemTimeline.checked = true)
		else (mItemTimeline.checked = false)
		if (iniAddToolbars == 1) then (mItemAddToolBarBtn.checked = true)
		else (mItemAddToolBarBtn.checked = false)
		mItemAutoCheckUpdate.checked = iniBsAutoCheckUpdate
		mItemIsIcon.checked = iniIsIcon
		case iniCollopseType of
		(
			0:(mItemCollapse.checked = false;mItemCollapseFull.checked = false)
			1:(mItemCollapse.checked = true;mItemCollapseFull.checked = false)
			2:(mItemCollapse.checked = false;mItemCollapseFull.checked = true)
			default:mItemCollapse.checked = false
		)
	)

	on mItemTop picked do
	(
		if not mItemTop.checked then 
		(
			rolBsKeyTools.timerTickTock.active = false
			if iniRolDockPos == "float" then (iniPos = (GetDialogPos rolBsKeyTools))
			iniRolDockPos = "cui_dock_top"
			stSetConfigAll.fnSetConfigBsKeyTools ()
			fnLoadDockPos rolBsKeyTools rolBsKeyTools.widthBsSize rolBsKeyTools.heightBsSize
		)
	)

	on mItemBottom picked do
	(
		if not mItemBottom.checked then 
		(
			rolBsKeyTools.timerTickTock.active = false
			if iniRolDockPos == "float" then (iniPos = (GetDialogPos rolBsKeyTools))
			iniRolDockPos = "cui_dock_bottom"
			stSetConfigAll.fnSetConfigBsKeyTools ()
			fnLoadDockPos rolBsKeyTools rolBsKeyTools.widthBsSize rolBsKeyTools.heightBsSize
		)
	)

	on mItemLeft picked do
	(
		if not mItemLeft.checked then 
		(
			rolBsKeyTools.timerTickTock.active = false
			if iniRolDockPos == "float" then (iniPos = (GetDialogPos rolBsKeyTools))
			iniRolDockPos = "cui_dock_left"
			stSetConfigAll.fnSetConfigBsKeyTools ()
			fnLoadDockPos rolBsKeyTools rolBsKeyTools.widthBsSize rolBsKeyTools.heightBsSize
		)
	)

	on mItemRight picked do
	(
		if not mItemRight.checked then 
		(
			rolBsKeyTools.timerTickTock.active = false
			if iniRolDockPos == "float" then (iniPos = (GetDialogPos rolBsKeyTools))
			iniRolDockPos = "cui_dock_right"
			stSetConfigAll.fnSetConfigBsKeyTools ()
			fnLoadDockPos rolBsKeyTools rolBsKeyTools.widthBsSize rolBsKeyTools.heightBsSize
		)
	)

	on mItemFloat picked do
	(
		if not mItemFloat.checked then 
		(
			if iniRolDockPos == "float" then (iniPos = (GetDialogPos rolBsKeyTools))
			iniRolDockPos = "float"
			stSetConfigAll.fnSetConfigBsKeyTools ()
			fnLoadDockPos rolBsKeyTools rolBsKeyTools.widthBsSize rolBsKeyTools.heightBsSize
			setdialogpos rolBsKeyTools iniPos
			try(fileIn ((getDir #Scripts)+ @"\\BulletScripts\\BulletKeyTools.ms");fnCheckRolloutPos rolBsKeyTools)
			catch(messagebox "æ‰“å¼€ BulletKeyTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
		)
	)

	on mItemResetCount picked do
	(
		if not rolBsKeyTools.dialogBar then
		(
			if (queryBox "æ˜¯å¦é‡ç½®æ”¶ç¼©é¢æ¿è®¡æ—¶ç»Ÿè®¡ï¼Ÿ                " \
			title:"è®¡æ—¶é‡ç½®" beep:false) then
			(
				dateTime     	= (dotNetClass "System.DateTime").Now
				iniCostTime 	= #(0,0,0,0)
				arrNewCostTime 	= #(0,0,0,0)
				SetINISetting BulletConfig "BulletKeyToolsSet" "CostTime" (arrNewCostTime as string)
				messagebox " (å·¥å…·ç¬¬ä¸€æ¬¡æ‰“å¼€å¼€å§‹è®¡æ—¶) é‡ç½®å®Œæˆ!                                          " beep:false title:"BsKeyTools"
			)
		)
		else
		(
			messagebox "è¯·è®¾ç½®åµŒå…¥æ¨¡å¼ä¸ºã€æµ®åŠ¨ã€‘!                        "
		)
	)

	on mItemHelpVideo picked do 
	(shellLaunch "https://space.bilibili.com/2031113/lists/560782" "")

	on mItemHelpDoc picked do 
	(shellLaunch "https://anibullet.github.io/" "")

	on mItemBugReport picked do
	(shellLaunch "https://github.com/AniBullet/BsKeyTools/issues" "")

	on mItemBilibili picked do 
	(shellLaunch "https://space.bilibili.com/2031113" "")

	on mItemTwitter picked do 
	(shellLaunch "https://twitter.com/aniBulletCom" "")

	on mItemScriptsPath picked do 
	(shellLaunch (getdir #Scripts) "")

	on mItemQgroup picked do
	(
		if (queryBox "æ˜¯å¦åŠ å…¥ä¸ªäººåˆ†äº«äº¤æµç¾¤ï¼Ÿ\r\n\r\n(æ¸¸æˆï¼ŒåŠ¨ç”»çˆ±å¥½è€…ä¼‘é—²å¹æ°´æ­£èƒ½é‡åˆ†äº«ç¾¤)\r\n\r\nå­å¼¹å·¥å…·äºº(993590655)ï¼Œç¡®è®¤å¯ç›´æ¥è·³è½¬é“¾æ¥~          \r\n        " \
		title:"åŠ å…¥äº¤æµç¾¤" beep:false) then
		(shellLaunch "https://jq.qq.com/?_wv=1027&k=hmeHhTwu" "")
	)

	on mItemCleanVirus picked do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsCleanVirus.ms"))
		catch(messagebox "æ‰“å¼€ BsCleanVirus.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemConfigFilePath picked do
	(
		if (queryBox "æ˜¯å¦æ‰“å¼€é…ç½®æ–‡ä»¶ç›®å½•ï¼Ÿï¼ˆé…ç½®æ–‡ä»¶ï¼šBulletConfig.iniï¼‰\r\n\r\nã€å¦å­˜æˆ–æ›¿æ¢æ­¤æ–‡ä»¶å¯æ‰‹åŠ¨å¤„ç†å¤‡ä»½æˆ–å¯¼å…¥è„šæœ¬é…ç½®ã€‘                                                     " \
		title:"é…ç½®æ–‡ä»¶" beep:false) then (shellLaunch (getFilenamePath BulletConfig) "")
	)

	on mItemRolloutBuilder picked do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\RolloutBuilder.ms"))
		catch(messagebox "æ‰“å¼€ RolloutBuilder.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemHwndViewer picked do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\simple_hwnd_viewer.ms"))
		catch(messagebox "æ‰“å¼€ simple_hwnd_viewer.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemDotNetProperty picked do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Show.NetProperty.ms"))
		catch(messagebox "æ‰“å¼€ Show.NetProperty.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemFBXReview picked do
	(
		try(shelllaunch ((getDir #scripts) + "\\BulletScripts\\Res\\fbxreview.exe") "")
		catch(messagebox "æ‰“å¼€ FBXReview å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemIsStartup picked do 
	(
		if (mItemIsStartup.checked == true) then 
		(
			fnDelFileDir startupPath
			mItemIsStartup.checked = false
			messagebox ("å·²è§£é™¤ BsKeyTools è‡ªå¯ï¼                  ")  title:"è‡ªå¯è®¾ç½®"
		)
		else 
		(
			if (not (SIOFile.Exists startupPath)) do
			(
				try 
				(
					FileIO.Copyfile startupBsKeyTools startupPath UIOption
					-- SIOFile.Copy startupBsKeyTools startupPath
					messagebox ("å·²æ‰“å¼€ BsKeyTools è‡ªå¯ï¼                  ")  title:"è‡ªå¯è®¾ç½®"
					mItemIsStartup.checked = true
					setFileAttribute startupPath #readOnly true
				)
				catch
				(
					-- messagebox ("è‡ªå¯å¤±è´¥ï¼Œçƒ¦è¯·ç®¡ç†å‘˜è¿è¡Œ max æˆ–æ‰‹åŠ¨å¤„ç†ï¼š\r\n\r\næŠŠ StartupMS\\BulletKeyTools.ms å¤åˆ¶åˆ°\r\n\r\n" + (getDir #StartupScripts) + "                    ")
					-- (shellLaunch (getfilenamepath startupBsKeyTools) "")
				)
			)
		)
	)

	on mItemBackupConfigFile picked do 
	(
		local pathDesktop = (@"C:\Users\" + (filterString  (getdir #userscripts) @"\")[3] + @"\Desktop\")
		local fileConfigBcakup = (pathDesktop + "//BulletConfig.ini")
		if (SIOFile.Exists fileConfigBcakup) then 
		(
			fnDelFileDir fileConfigBcakup
			-- SIOFile.Copy BulletConfig fileConfigBcakup
			FileIO.Copyfile BulletConfig fileConfigBcakup UIOption
		)
		else 
		(
			-- SIOFile.Copy BulletConfig fileConfigBcakup
			FileIO.Copyfile BulletConfig fileConfigBcakup UIOption
		)
		if (queryBox "æ˜¯å¦æ‰“å¼€é…ç½®æ–‡ä»¶å¤‡ä»½ç›®å½•ï¼Ÿï¼ˆé…ç½®æ–‡ä»¶ï¼šBulletConfig.iniï¼‰\r\n\r\nã€å¦å­˜æˆ–æ›¿æ¢æ­¤æ–‡ä»¶å¯æ‰‹åŠ¨å¤„ç†å¤‡ä»½æˆ–å¯¼å…¥è„šæœ¬é…ç½®ã€‘                                                     " \
		title:"å¤‡ä»½é…ç½®æ–‡ä»¶" beep:false) then (shellLaunch pathDesktop "")
	)

	on mItemDarkEditor picked do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\DarkScintilla.mzp"))
		catch(messagebox "æ‰“å¼€ DarkScintilla.mzp å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemHelpDocs picked do 
	(
		try(shellLaunch ((getDir #scripts) + "\\BulletScripts\\Res\\MAXScript-Help_2024_ENU.chm") "")
		catch(messagebox "æ‰“å¼€ MAXScript-Help å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemAddToolBarBtn picked do
	(
		if (mItemAddToolBarBtn.checked == false) then 
		(
			if (queryBox "æ˜¯å¦æ·»åŠ  BsKeyTools å¿«æ·å¯åŠ¨å›¾æ ‡åˆ°å·¥å…·æ ï¼Ÿ\r\n\r\n(æ·»åŠ åå¯åœ¨å·¥å…·æ ä¸­æ‰¾åˆ° S å›¾æ ‡ï¼Œç‚¹å‡»å³å¯æ‰“å¼€)                                             " title:"æ·»åŠ åˆ°å·¥å…·æ ") do
			(
				addToolBarButton "BulletKeyTools" "BulletTools" "BsKeyTools" remove: true
				addToolBarButton "BulletKeyTools" "BulletTools" "BsKeyTools"
				mItemAddToolBarBtn.checked = true
				iniAddToolbars = 1
			)
		)
		else
		(
			if (queryBox "æ˜¯å¦ç§»é™¤ BsKeyTools å·¥å…·æ å¿«æ·å¯åŠ¨å›¾æ ‡ï¼Ÿ(ä¸ä¼šå¸è½½æ’ä»¶)                                           " title:"æ·»åŠ åˆ°å·¥å…·æ ") do
			(
				addToolBarButton "BulletKeyTools" "BulletTools" "BsKeyTools" remove: true
				mItemAddToolBarBtn.checked = false
				iniAddToolbars = 0
			)
		)
		SetINISetting BulletConfig "BulletKeyToolsSet"  "ToolBarBtn" (iniAddToolbars as string)
	)

	on mItemCheckUpdate picked do 
	(fnCheckUpdate curVerBsKeyTools verUrlBsKeyTools dlUrlBsKeyTools dlFileBsKeyTools isForceUpdate:false)

	on mItemForceUpdate picked do 
	(fnCheckUpdate curVerBsKeyTools verUrlBsKeyTools dlUrlBsKeyTools dlFileBsKeyTools isForceUpdate:true)

	on mItemUndoVersion picked do 
	(
		local dlUrlPreviousVersion = "https://gitee.com/acebullet/BsKeyTools/raw/main/_BsKeyTools/_PreviousVersion.exe"
		local dlFilePreviousVersion = (getdir #temp) + "\\_PreviousVersion.exe"
		fnCheckUpdate curVerBsKeyTools verUrlBsKeyTools dlUrlPreviousVersion dlFilePreviousVersion isForceUpdate:true
	)

	on mItemAutoCheckUpdate picked do 
	(
		if (mItemAutoCheckUpdate.checked == true) then (mItemAutoCheckUpdate.checked = false)
		else (mItemAutoCheckUpdate.checked = true)
		iniBsAutoCheckUpdate = mItemAutoCheckUpdate.checked
	)

	on mItemClose picked do 
	(
		try(cui.UnRegisterDialogBar rolBsKeyTools) catch()
		try(destroydialog rolBsKeyTools)catch()
		try(destroydialog rolFnKeys)catch()
		try(destroydialog rolAddMyScripts)catch()
	)

	on mItemUninstall picked do
	(
		if (queryBox "æ˜¯å¦å½»åº•æ¸…é™¤ BsKeyToolsï¼Ÿ          \r\n( é…ç½®æ–‡ä»¶é»˜è®¤ä¿ç•™ )" \
		title:"æœ‰ç¼˜å†ä¼š" beep:false) then
		(
			if (iniAddToolbars == 1) then 
			(
				addToolBarButton "BulletKeyTools" "BulletTools" "BsKeyTools" remove: true
				iniAddToolbars = 0
				SetINISetting BulletConfig "BulletKeyToolsSet"  "ToolBarBtn" (iniAddToolbars as string)
			)
			curMaxVersion = ((maxVersion())[1] / 1000)
			if curMaxVersion < 27 then
			(
				if ((menuMan.findMenu "ğŸ® BsKeyTools") != undefined) then 
				(
					menuMan.unRegisterMenu (menuMan.findMenu "ğŸ® BsKeyTools")
					menuMan.updateMenuBar()
				)
				if ((menuMan.findMenu "BsKeyTools") != undefined) then 
				(
					menuMan.unRegisterMenu (menuMan.findMenu "BsKeyTools")
					menuMan.updateMenuBar()
				)
			)

			arrDelPath = #(((getDir #Scripts)+ "\\BulletScripts"),((getDir #maxroot) + "\\UI_ln\\Icons\\cstoolIcons"))
			arrDelMs = #(((getDir #StartupScripts)+ "\\BulletKeyTools.ms"),\
			((getDir #StartupScripts)+ "\\BsKeyToolsMacro.ms"),\
			((getDir #StartupScripts)+ "\\BsKeyToolsMenuBar.ms"),\
			((getDir #StartupScripts)+ "\\BsTrackBarToolsStartup.ms"),\
			((getDir #StartupScripts)+ "\\BsCleanVirusStartup.ms"),\
			((getDir #StartupScripts)+ "\\EXTimelineStartup.ms"))
			for d in arrDelPath do (fnDelDir d)
			for f in arrDelMs do (fnDelFileDir f)
			try(cui.UnRegisterDialogBar rolBsKeyTools) catch()
			try(destroydialog rolBsKeyTools)catch()
			try(destroydialog rolFnKeys)catch()
			try(destroydialog rolAddMyScripts)catch()
			(messagebox "å·²æ¸…ç†å¹²å‡€ï¼Œä¿ç•™é…ç½®æ–‡ä»¶å¤‡ç”¨...    \r\n" beep:false title:"å¸è½½æˆåŠŸï¼")
		)
	)

	on mItemUpdateLog picked do (shellLaunch "https://www.notion.so/bullet4869/4e28c488d5474a9082e164b7c5b6926c" "")

	on mItemCustomSortBtn picked do 
	(
		try(destroydialog rolCustomBtn)catch()
		Createdialog rolCustomBtn fgcolor:myFgColor pos:((getdialogpos rolBsKeyTools)+[0,rolBsKeyTools.height]) parent:rolBsKeyTools.hwnd
	)

	on mItemCustomScripts picked do 
	(
		try(destroydialog rolAddMyScripts)catch()
		createDialog rolAddMyScripts fgcolor:myFgColor \
		pos:[mouse.screenpos.x - 150,mouse.screenpos.y +20]
	)

	on mItemIsIcon picked do 
	(
		-- if not rolBsKeyTools.dialogBar then
		-- (
			if (mItemIsIcon.checked == false) then 
			(
				fnSwitchIconStyle()
				mItemIsIcon.checked = not mItemIsIcon.checked
				iniIsIcon = mItemIsIcon.checked
			)
			else
			(
				mItemIsIcon.checked = not mItemIsIcon.checked
				iniIsIcon = mItemIsIcon.checked
				try(fileIn ((getDir #Scripts)+ @"\\BulletScripts\\BulletKeyTools.ms"))
				catch(messagebox "æ‰“å¼€BsKeyToolså¤±è´¥,\r\nå»ºè®®é‡å¯Maxæˆ–é‡æ–°å®‰è£…...          ")
			)
		-- )
		-- else
		-- (
		-- 	messagebox "è¯·è®¾ç½®åµŒå…¥æ¨¡å¼ä¸ºã€æµ®åŠ¨ã€‘!                        "
		-- )
	)

	on mItemCollapse picked do 
	(
		mItemCollapse.checked = not mItemCollapse.checked
		-- iniCollopseType = mItemCollapse.checked
		if mItemCollapse.checked == true then 
		(
			if not rolBsKeyTools.dialogBar then
			(
				mItemCollapseFull.checked = false
				iniCollopseType = 1
			)
			else
			(
				messagebox "è¯·è®¾ç½®åµŒå…¥æ¨¡å¼ä¸ºã€æµ®åŠ¨ã€‘!                        "
			)
		)
		else
		(
			if mItemCollapseFull.checked == true then iniCollopseType = 2
			else iniCollopseType = 0
		)
		rolBsKeyTools.timerTickTock.active = mItemCollapse.checked
	)

	on mItemCollapseFull picked do 
	(
		mItemCollapseFull.checked = not mItemCollapseFull.checked
		-- iniCollopseType = mItemCollapse.checked
		if mItemCollapseFull.checked == true then 
		(
			if not rolBsKeyTools.dialogBar then
			(
				mItemCollapse.checked = false
				iniCollopseType = 2
			)
			else
			(
				messagebox "è¯·è®¾ç½®åµŒå…¥æ¨¡å¼ä¸ºã€æµ®åŠ¨ã€‘!                        "
			)
		)
		else
		(
			if mItemCollapse.checked == true then iniCollopseType = 1
			else iniCollopseType = 0
		)
		rolBsKeyTools.timerTickTock.active = mItemCollapseFull.checked
	)

	on mItemWinBack picked do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\WinBox.ms"))
		catch(messagebox "æ‰“å¼€ WinBox.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on mItemTimeline picked do 
	(
		if (mItemTimeline.checked == true) then 
		(
			fnDelFileDir startupEXTimelinePath
			mItemTimeline.checked = false
			messagebox ("å·²è§£é™¤ extended_timeline è‡ªå¯ï¼                  ")  title:"timeline è‡ªå¯è®¾ç½®"
		)
		else 
		(
			try(fileIn ((getDir #Scripts)+ @"\\BulletScripts\\Quote\\Heavenly Pictures\\Extended Timeline\\extended_timeline.ms"))
			catch(messagebox "æ‰“å¼€ extended_timeline.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
			if (not (SIOFile.Exists startupEXTimelinePath)) do
			(
				try 
				(
					FileIO.Copyfile startupEXTimelineMS startupEXTimelinePath UIOption
					messagebox ("å·²æ‰“å¼€ extended_timeline è‡ªå¯ï¼                  ")  title:"timeline è‡ªå¯è®¾ç½®"
					mItemTimeline.checked = true
					setFileAttribute startupEXTimelinePath #readOnly true
				)
				catch()
			)
		)
	)

	on mItemFixThumbnail picked do
	(
		if (queryBox "å°è¯•ä¿®å¤ç¼©ç•¥å›¾ï¼Œè‹¥å¤±è´¥è¯·æ³¨æ„å…ˆç”¨ç®¡ç†å‘˜è¿è¡Œ3dsMax...                          " title:"BsKeyTools") then
		(
			try(HiddenDOSCommand ("regsvr32 \"" + (getdir #maxroot) + "MaxThumbnailShellExt.dll\""))catch(messagebox "ä¿®å¤ç¼©ç•¥å›¾å¤±è´¥ï¼Œ\r\n\r\nå¿…é¡»å…ˆç®¡ç†å‘˜è¿è¡Œ3dsMax...                    " beep:false title:"BsKeyTools")
		)
	)
)

-------------------å¸§ç‡,æ’­æ”¾é€Ÿåº¦--------------------------------------------------------------
Global valueFps
Global valuePlaySpeed = ""
Global strCurrentFps = framerate as string + "FPS"

fn fnBsRefFps =
(
	local arrMenuSetFps = #(menuSetFps.menuSet60Fps,menuSetFps.menuSet30Fps, \
							menuSetFps.menuSet24Fps,menuSetFps.menuCustomFps)
	for i in arrMenuSetFps do i.checked = false
	case of
	(
		(framerate == 60):(menuSetFps.menuSet60Fps.checked = true)
		(framerate == 30):(menuSetFps.menuSet30Fps.checked = true)
		(framerate == 24):(menuSetFps.menuSet24Fps.checked = true)
		default:(menuSetFps.menuCustomFps.checked = true)
	)
	menuSetFps.menuCurrentFps.text = "å½“å‰: " + framerate as string + "FPS"
	strCurrentFps = framerate as string + "FPS"
	rolBsKeyTools.btnSetFps.text = strCurrentFps
)

fn fnSetFps numFps =
(
	framerate = numFps
	valueFps = numFps
	fnBsRefFps ()
	slidertime -= 1
	slidertime += 1
)

fn fnRefPlaySpeedValue =
(
	local arrMenuSetSpeed = #(menuSetSpeed.menuSet14Speed,menuSetSpeed.menuSet12Speed, \
		menuSetSpeed.menuSet1Speed,menuSetSpeed.menuSet2Speed,menuSetSpeed.menuSet4Speed)
		for i in arrMenuSetSpeed do i.checked = false
	case of
	(
		(timeConfiguration.playbackSpeed == 1):(valuePlaySpeed = "-1/4x-";menuSetSpeed.menuSet14Speed.checked =true)
		(timeConfiguration.playbackSpeed == 2):(valuePlaySpeed = "-1/2x-";menuSetSpeed.menuSet12Speed.checked =true)
		(timeConfiguration.playbackSpeed == 3):(valuePlaySpeed = "- 1x -";menuSetSpeed.menuSet1Speed.checked =true)
		(timeConfiguration.playbackSpeed == 4):(valuePlaySpeed = "- 2x -";menuSetSpeed.menuSet2Speed.checked =true)
		(timeConfiguration.playbackSpeed == 5):(valuePlaySpeed = "- 4x -";menuSetSpeed.menuSet4Speed.checked =true)
	)
	rolBsKeyTools.btnSetSpeed.text = valuePlaySpeed
	menuSetSpeed.menuCurrentSpeed.text = "å½“å‰: " + valuePlaySpeed
)

fn fnSetSpeed numSpeed =
(
	timeConfiguration.playbackSpeed = numSpeed
	fnRefPlaySpeedValue ()
)

rollout rolCustomFps ""
(
	edittext edtFpsValue "FPS: "  pos:[10,10] width:60 usePercentageWidth:true \
	percentageWidth:44.0 labelOnTop:false text:"60" bold:true readOnly:false --å¸§ç‡æ•°å€¼
	button btnSetFps "Set" pos:[80,8]
	label labTips strCurrentFps

	on rolCustomFps open do 
	(
		edtFpsValue.text = framerate as string
		labTips.text = "å½“å‰:" + framerate as string + "FPS"
		valueFps = framerate as integer
	)

	on edtFpsValue entered val do 
	(
		if ((val != ".") and (val as integer != undefined) and (val != "") and (val as integer >= 0)) then
		(
			valueFps = (val as integer)
		)
		else messagebox "---------------------------\r\nè¯·è¾“å…¥æ­£ç¡®å¸§ç‡æ•°å€¼\r\n"
	)
	on btnSetFps pressed do 
	(
		framerate = valueFps
		labTips.text = "å½“å‰:" + framerate as string + "FPS"
		fnBsRefFps ()
		slidertime -= 1
		slidertime += 1
	)
)

rcmenu menuSetFps
(
	menuItem menuCurrentFps "" enabled:false
	menuItem menuSet60Fps "- 60Fps -"
	menuItem menuSet30Fps "- 30Fps -"
	menuItem menuSet24Fps "- 24Fps -"
	separator menuSepCustom
	menuItem menuCustomFps "è‡ªå®šä¹‰å¸§ç‡"

	on menuSetFps open do (fnBsRefFps ())

	on menuSet60Fps picked do (fnSetFps 60)
	on menuSet30Fps picked do(fnSetFps 30)
	on menuSet24Fps picked do (fnSetFps 24)

	on menuCustomFps picked do
	(
		try (destroyDialog rolCustomFps) catch()
		createdialog rolCustomFps 120 55 fgcolor:myFgColor \
		pos:[mouse.screenpos.x,mouse.screenpos.y]
	)
)

rcmenu menuSetSpeed
(
	menuItem menuCurrentSpeed "" enabled:false
	menuItem menuSet14Speed "-1/4x-"
	menuItem menuSet12Speed "-1/2x-"
	separator menuSepSpeedLow
	menuItem menuSet1Speed "- 1x -"
	separator menuSepSpeedHigh
	menuItem menuSet2Speed "- 2x -"
	menuItem menuSet4Speed "- 4x -"

	on menuSetSpeed open do (fnRefPlaySpeedValue ())

	on menuSet14Speed picked do (fnSetSpeed 1)
	on menuSet12Speed picked do(fnSetSpeed 2)
	on menuSet1Speed picked do (fnSetSpeed 3)
	on menuSet2Speed picked do (fnSetSpeed 4)
	on menuSet4Speed picked do (fnSetSpeed 5)
)
------------------å¸§ç‡,æ’­æ”¾é€Ÿåº¦------------------------------------------------------------

---------------------æ»‘åŠ¨å¸§åˆ‡æ¢rollout---------------------------------
rollout rolFnKeys "æ»‘åŠ¨å¸§åˆ‡æ¢ v1.1" width:280 height:120
(
	group ""
	(
		checkbox chkLHand "å·¦æ‰‹" pos:[24,20] width:50 height:20 color:Blue
		checkbox chkRHand "å³æ‰‹" pos:[96,20] width:50 height:20 color:Green
		checkbox chkLFoot "å·¦è„š" pos:[24,55] width:50 height:20 color:Blue checked:true
		checkbox chkRFoot "å³è„š" pos:[96,55] width:50 height:20 color:Green checked:true
		button btnPlanted "å›ºå®šå…³é”®å¸§" pos:[184,20] width:80 height:25 toolTip:"Set Planted Key"
		button btnSliding "æ»‘åŠ¨å…³é”®å¸§" pos:[184,50] width:80 height:25 toolTip:"Set Sliding Key"
		button btnFree "è‡ªç”±å…³é”®å¸§" pos:[184,80] width:80 height:25 toolTip:"Set Free Key"
		label lblMe "[2019.05.28]  Bullet.S" pos:[24,92] width:120 height:16 color:Green
	)
	
	Fn fnSetKeyType keyType = 
	(
		sliderTime = animationRange.start
		for obj in selection where ((classof obj.baseObject == Biped_Object) \
		and (biped.getCurrentLayer obj.controller == 0)) do
		(
			bipCtrl = obj.controller
			if chkLHand.checked then 
			(
				sel_obj1 = (biped.getNode bipCtrl #larm)
				k = numKeys sel_obj1.controller
					for i=1 to k do
					(
					t = (biped.getkey sel_obj1.controller i).time
						slidertime = t
						with animate on --at time t		
						(
							case of
							(
								(keyType == 1):(biped.SetPlantedKey sel_obj1)
								(keyType == 2):(biped.SetSlidingKey sel_obj1)
								(keyType == 3):(biped.SetFreeKey sel_obj1)
							)
						)
					)
			)
			if chkRHand.checked then 
			(
				sel_obj2 = (biped.getNode bipCtrl #rarm)
				k = numKeys sel_obj2.controller
					for i=1 to k do
					(
					t = (biped.getkey sel_obj2.controller i).time
						slidertime = t
						with animate on --at time t		
						(
							case of
							(
								(keyType == 1):(biped.SetPlantedKey sel_obj2)
								(keyType == 2):(biped.SetSlidingKey sel_obj2)
								(keyType == 3):(biped.SetFreeKey sel_obj2)
							)
						)
					)
			)
			if chkLFoot.checked then 
			(
				sel_obj3 = (biped.getNode bipCtrl #lleg)
				k = numKeys sel_obj3.controller
					for i=1 to k do
					(
					t = (biped.getkey sel_obj3.controller i).time
						slidertime = t
						with animate on --at time t		
						(
							case of
							(
								(keyType == 1):(biped.SetPlantedKey sel_obj3)
								(keyType == 2):(biped.SetSlidingKey sel_obj3)
								(keyType == 3):(biped.SetFreeKey sel_obj3)
							)
						)
					)
			)
			if chkRFoot.checked then 
			(
				sel_obj4 = (biped.getNode bipCtrl #rleg)
				k = numKeys sel_obj4.controller
					for i=1 to k do
					(
					t = (biped.getkey sel_obj4.controller i).time
						slidertime = t
						with animate on --at time t		
						(
							case of
							(
								(keyType == 1):(biped.SetPlantedKey sel_obj4)
								(keyType == 2):(biped.SetSlidingKey sel_obj4)
								(keyType == 3):(biped.SetFreeKey sel_obj4)
							)
						)
					)
			)
		)
	)
	
	on btnPlanted pressed  do
	(
		fnSetKeyType 1
	)
	
	on btnSliding pressed  do
	(
		fnSetKeyType 2
	)
	
	on btnFree pressed  do
	(
		fnSetKeyType 3
	)
)
-----------------------------------------------------------------
-------------ä¸»UI-----------------------------------------------------------------
rollout rolBsKeyTools "" width:355 height:250
(
	local heightBsSize    = 250
	local widthBsSize     = 355
	local strMainRol      = ("BsKeyTools_v" + curVerBsKeyTools)
	local ui_clientOffset = undefined
	local strBtnName      = fnSwitchBtnString()
	local iconPath        = pathconfig.appendpath (getDir #Scripts) @"\\BulletScripts\\Res\\Element"
	local iconCurStr      = strBtnName[2]
	local iconElement     = (iconPath + @"\\" + iconCurStr)
	local iconPrimogem    = (iconPath + @"\\Primogem.png")
	---------------------------------UI--------------------------------------
	groupbox gbxMainUI strMainRol pos:[5,5] width:210 height:217
	
	-- label lblRangeStartText "èµ·å§‹å¸§" pos:[15,21] width:80 height:20
	-- label lblRangeEndText "ç»“æŸå¸§" pos:[65,21] width:80 height:20
	spinner spiStartTime "" pos:[10,21] width:60 height:20 type:#integer \
	range:[-999999999,999999999,animationrange.start] scale:1
	spinner spiEndTime "" pos:[70,21] width:60 height:20 type:#integer \
	range:[-999999999,999999999,animationrange.end] scale:1

	dotnetcontrol btnPrimogem "button" pos:[130,20] width:20 height:18

	button btnMagicBtn "" pos:[150,20] width:60 height:18  \
	tooltip:"ç‚¹æˆ‘ç‚¹æˆ‘ç‚¹æˆ‘~è‰¯å¿ƒå°å·¥å…·" border:false
	checkbox chkJudgeLinkKey "Link?" visible:false \
	pos:[12,48] tooltip:"é€‰æ‹©å¸§å‰ç¡®è®¤æ˜¯å¦å­˜åœ¨ Link å¸§" width:40 height:15 checked:false
	button btnSelBeforeKeys "" border:true \
	pos:[10,40] width:50 height:30 toolTip:"é€‰æ‹©æ»‘æ¡å‰é¢å…³é”®å¸§"  
	button btnSelAllKeys "" border:true \
	pos:[60,40] width:50 height:30 toolTip:"é€‰æ‹©æ‰€æœ‰å…³é”®å¸§"  
	button btnSelAfterKeys "" border:true \
	pos:[110,40] width:50 height:30 toolTip:"é€‰æ‹©æ»‘æ¡åé¢å…³é”®å¸§"

	dotnetcontrol btnElement "button" pos:[170,40] width:30 height:30

	edittext edtMoveKey "" width:50 usePercentageWidth:true percentageWidth:44.0 \ 
	pos:[7,72] labelOnTop:false text:"5f" bold:true readOnly:false height:17
	button btnSet5 "Â±5f" width:50 pos:[60,70] height:20 \
	toolTip:"æ¢å¤é»˜è®¤ç§»åŠ¨å¸§æ•°\r\nå·¦å‡»ï¼š5f\r\nå³å‡»ï¼š-5f"
	button btnSetAdd "å·¦+å³-" width:50 pos:[110,70] height:20 \
	toolTip:"ç§»åŠ¨å¸§æ•°è®¾ç½®å¢å‡ 5 å¸§\r\nå·¦å‡»å¢åŠ ï¼›å³å‡»å‡å°‘"
	-- button btnSetOpposite "è´Ÿ" width:30 pos:[160,85] height:20
	button btnMoveKeys "ç§»åŠ¨å¸§" width:50 height:20 \
	pos:[160,70] toolTip:"ç§»åŠ¨å…³é”®å¸§ï¼Œå…ˆå·¦è¾¹è®¾å®šå¸§æ•°\r\nå·¦å‡»ï¼šå¸§æ èŒƒå›´ä¿æŒä¸å˜~\r\nå³å‡»ï¼šå¸§æ èŒƒå›´åŒæ­¥å¢å‡~"  

	button btnCutFrameDisplay "é€‰å®šå¸§" pos:[10,90] width:50 height:25 \
	tooltip:"é¢„è§ˆé€‰æ‹©å¸§\r\nå†ç‚¹å›åˆ°ä¸Šæ¬¡å¸§èŒƒå›´"
	button btnAllFrameDisplay "é¦–å°¾å¸§" pos:[60,90] width:50 height:25 \
	tooltip:"é¢„è§ˆå…¨éƒ¨å¸§\r\nå†ç‚¹å›åˆ°ä¸Šæ¬¡å¸§èŒƒå›´"
	-- button btnZeroFrameDisplay "é›¶å¸§" pos:[100,40] width:30 height:20 \
	-- tooltip:"é¦–å¸§å›åˆ°0å¸§"
	checkbutton ckbShadowCut "ç§€å‰ªå½±" highlightcolor:myCheckedColor \
	pos:[110,90] width:50 height:25 toolTip:"åˆ‡æ¢å‰ªå½±æ˜¾ç¤º\r\nå³é”®æ‰“å¼€ç¯å¢ƒè‰²è®¾ç½®(8)"
	button btnQuicksave "å¿«å¤‡ä»½" pos:[160,90] width:50 height:25 \
	tooltip:"å¤‡ä»½å½“å‰æ–‡ä»¶\r\nå½“å‰æ–‡ä»¶ç›®å½•.backup æ–‡ä»¶å¤¹\r\nå³é”®å¯å¿«é€Ÿæ‰“å¼€å¤‡ä»½æ–‡ä»¶å¤¹\r\nâ€œæ—¶å…‰æœºâ€ å·¥å…·ä¸­ä¹Ÿèƒ½å¿«é€ŸæŸ¥çœ‹è‡ªåŠ¨ä¿å­˜ç›®å½•"
	checkbutton ckbFnBoxDisplay "BOXæ˜¾"  highlightcolor:myCheckedColor \
	width:50 height:25 toolTip:"éª¨éª¼åˆ‡æ¢Boxæ˜¾ç¤º" pos:[10,115]
	checkbutton ckbFreezeMesh "å†»æ¨¡å‹" highlightcolor:myCheckedColor \
	toolTip:"å†»ç»“è§£å†»æ¨¡å‹" width:50 height:25 pos:[60,115]
	checkbutton ckbHideBones "éšBone" highlightcolor:myCheckedColor \
	width:50 height:25 toolTip:"æ˜¾ç¤ºéšè— bone\r\næ‰€åœ¨å±‚è‹¥éšè—åˆ™ä¸ä¼šæ˜¾ç¤º" pos:[110,115]
	checkbutton ckbHideBiped "éšBiped" width:50 height:25 highlightcolor:myCheckedColor \
	toolTip:"æ˜¾ç¤ºéšè— Bip\r\næ‰€åœ¨å±‚è‹¥éšè—åˆ™ä¸ä¼šæ˜¾ç¤º" pos:[160,115]
	button btnImageComp "æ„å›¾æ¡†" pos:[10,140] width:50 height:25 \
	tooltip:"å„ç§ç»å…¸åˆ†å‰²è§†å›¾ä»¥è¾…åŠ©æ„å›¾"
	button btnTrajedit "è½¨è¿¹çº¿" pos:[60,140] width:50 height:25 \
	tooltip:"åŠ¨ç”»è½¨è¿¹å·¥å…·ä¸ªäººä¼˜åŒ–ç‰ˆï¼ˆby ä¸œè§äº‘ï¼‰\r\nå·¦é”®åŸç‰ˆä¼˜åŒ–\r\nå³é”®é‡æ„æ–°ç‰ˆ"
	button btnFileOpen "æ—¶å…‰æœº" pos:[110,140] width:50 height:25 \
	tooltip:"å¿«é€Ÿæ‰“å¼€maxæ–‡ä»¶\r\nå¯æ”¶è—å¸¸ç”¨ç›®å½•"
	button btnLightTable "æ´‹è‘±çš®" pos:[160,140] width:50 height:25 \
	toolTip:"æ˜¾ç¤ºè¿åŠ¨é‡å½± (ä¿®æ”¹è‡ªSan_oOo)"
	checkButton ckbPlayBlocking "è·³å¸§æ’­" pos:[10,165] width:50 height:25 
	highlightcolor:myCheckedColor tooltip:"ç‚¹å‡»é¢„è§ˆå…³é”®å¸§ Blocking åŠ¨ç”»\r\nè‹¥æœ‰ Link å¸§éœ€è¦æŒ‰ä¸‹ä¸Šé¢æŒ‰é’®" checked:false
	button btnSpringMagic "é£˜å¸¦è§£" pos:[60,165] width:50 height:25 \
	tooltip:"å·¦ç‚¹æ–°ç‰ˆ,å³ç‚¹æ—§ç‰ˆ" 
	button btnCSTools "CSé€‰æ‹©" pos:[110,165] width:50 height:25 \
	toolTip:"å¿«é€Ÿé€‰æ‹©CSéª¨éª¼å’Œè°ƒBipedç­‰\r\nå·¦é”®BsBipedTools\r\nå³é”®è€ç‰ˆCSToolsç²¾ç®€ç‰ˆ" 
	button btnAnimCopyPaste "æš´åŠ›è´´"  pos:[160,165] width:50 height:25 \
	toolTip:"å·¦é”®åŠ¨ç”»æš´åŠ›ç²˜è´´ä¸œè§äº‘ä¼˜åŒ–ç‰ˆ\r\nå³é”®åŸç‰ˆæœªä¿®æ”¹ç‰ˆ\r\n(æœ‰æ—¶é—´æˆ‘ä¹Ÿä¼šä¼˜åŒ–æˆ–æ–°å†™)" 
	checkButton ckbIsoSelection "ç‹¬æ˜¾" pos:[10,190] width:40 height:25 highlightcolor:myCheckedColor \
	toolTip:"éšè—å½“å‰æ˜¾ç¤ºçš„æœªé€‰ä¸­ç‰©ä½“\r\nå†æ¬¡ç‚¹å‡»å¯é‡æ–°æ˜¾ç¤º\r\nåˆ©ç”¨ IsolateSelection\r\nä½†æ˜¯ä¸æ”¹å˜é•œå¤´ç¼©è¿›"
	button btnLayerManager "å±‚" pos:[50,190] width:20 height:25 \
	toolTip:"æ¨¡æ‹Ÿæ—§ç‰ˆå±‚ç®¡ç†å™¨\r\nå·¦é”®å¯åµŒå¥—å±‚ç®¡ç†å™¨\r\nå³é”®æ—§ç‰ˆå±‚ç®¡ç†å™¨" 
	button btnSelectionsetTools "é›†" pos:[70,190] width:20 height:25 \
	toolTip:"é€‰æ‹©é›†å·¥å…·å¢å¼ºç‰ˆ" 
	button btnPoseTool "åº“" pos:[90,190] width:20 height:25 \
	toolTip:"å‚è€ƒåº“å·¥å…·,å¾…å®Œå–„"
	button btnSetFps "" pos:[110,190] width:50 height:25 \
	toolTip:"è®¾ç½®å¸§ç‡" 
	button btnSetSpeed "" pos:[160,190] width:50 height:25 \
	toolTip:"è®¾ç½®æ’­æ”¾é€Ÿåº¦" 
	timer clock "PlayClock" interval:1 active:false
	
	groupbox gbxMinTools "" pos:[220,5] width:130 height:240

	checkbutton ckbC1 "" width:30 height:29 highlightcolor:(myCheckedColor) \
	pos:[225,15] toolTip:"" border:true
	checkbutton ckbC2 "" width:30 height:29 highlightcolor:(myCheckedColor) \
	pos:[255,15] toolTip:"" border:true
	checkbutton ckbC3 "" width:30 height:29 highlightcolor:(myCheckedColor) \
	pos:[285,15] toolTip:"" border:true
	checkbutton ckbC4 "" width:30 height:29 highlightcolor:(myCheckedColor) \
	pos:[315,15] toolTip:"" border:true

	local btnHeight = 32
	local btnWidth = 60
	local btnPos = [999999,999999]
	button btnPicker "é€‰é€‰æ‹©å™¨" width:btnWidth height:btnHeight visible:false \
	tooltip:"åˆ›å»ºå¸¦èƒŒæ™¯çš„é€‰æ‹©é¢æ¿\r\n\r\nå·¦å³é”®åˆ†åˆ«ä¸¤ä¸ªå·¥å…·" pos:btnPos
	button btnFastAlign "å¯¹é½å‡å¸§" width:btnWidth height:btnHeight visible:false \
	toolTip:"å¿«é€Ÿå¯¹é½å·¥å…·ï¼Œæ”¯æŒ Biped\r\nCreated by Alex Velez" pos:btnPos
	checkbutton ckbPerspLock "é€è§†é”å®š" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ—‹è½¬è§†å›¾åè‡ªåŠ¨æ‰“å¼€é€è§†ï¼ˆç±»ä¼¼æŒ‰ P é”®ï¼‰\r\nå†æ¬¡ç‚¹å‡»å¯åˆ‡æ¢å¼€å…³" pos:btnPos
	button btnAnimMirror "åŠ¨ç”»é•œåƒ" width:btnWidth height:btnHeight visible:false \
	toolTip:"ç›®å‰å¼•ç”¨4698toå¤§ä½¬çš„æ’ä»¶\r\nåé¢éšç¼˜æ–°å†™" pos:btnPos
	button btnVportTools "è§†çª—åˆ‡é•œ" width:btnWidth height:btnHeight visible:false \
	toolTip:"å‚¨å­˜è§†è§’å‚æ•°ï¼Œä¾¿äºåˆ†é•œå¤´" pos:btnPos
	button btnBatchExport "æ‰¹é‡é™ä½" width:btnWidth height:btnHeight visible:false \
	toolTip:"å·¦:æ–°ç‰ˆæ‰¹é‡é™ç‰ˆæœ¬å·¥å…·\r\n\r\nå³:è€ç‰ˆæ‰¹é‡è½¬æ¢\r\n\r\n2021 ä»¥ä¸Šé™ç‰ˆæœ¬å¯èƒ½æœ‰æŸå®³ï¼Œå·¥å…·åšäº†ä¿®å¤å¤„ç†ï¼Œæ³¨æ„ä¿å­˜è’™çš®" pos:btnPos
	button btnTweenMachine "è¡¥é—´å·¥å…·" width:btnWidth height:btnHeight visible:false pos:btnPos \
	tooltip:"å‰ååˆ‡å…³é”®å¸§è®¾ç½®ï¼Œ\r\nå¯é…åˆåˆ å¸§æˆ–å•è½´ä¿®å¸§"
	button btnProTraj "è½¨è¿¹ç¼–è¾‘" width:btnWidth height:btnHeight visible:false \
	toolTip:"å·¦ï¼šè°ƒèŠ‚è½¨è¿¹æ”¹å˜åŠ¨ç”»çš„å·¥å…·,\r\næš‚ä¸æ”¯æŒBipedï¼Œé«˜ç‰ˆæœ¬ä¹Ÿæœ‰è‡ªå¸¦åŠŸèƒ½\r\nå³ï¼šä¸ºé€‰æ‹©ç‰©ä½“æ˜¾ç¤ºç®€å•è½¨è¿¹" pos:btnPos
	button btnRescaleWU "è’™çš®ç¼©æ”¾" width:btnWidth height:btnHeight visible:false \
	toolTip:"å¸¦æœ‰Skinçš„ç¼©æ”¾,å¸¦æ‰¹å¤„ç†\r\n(å³é”®æ‰“å¼€è€ç‰ˆæœ¬)" pos:btnPos
	button btnXrSkinTool "è’™çš®è¾…åŠ©" width:btnWidth height:btnHeight visible:false \
	tooltip:"by:ä¸œè§äº‘" pos:btnPos
	button btnFnFrame "æ•´å°æ•°å¸§" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ•´æ•°å°æ•°å¸§åˆ‡æ¢,\r\nå¹³æ»‘æ‹–å¸§çœ‹å¡é¡¿" pos:btnPos
	button btnRetargetTools "FBXè½¬CS" width:btnWidth height:btnHeight visible:false \
	tooltip:"FBXè½¬CSéª¨éª¼ï¼Œé™„å¸¦åŠ¨ç”»é‡å®šå‘å·¥å…·" pos:btnPos
	button btnTrackBarTools "å¸§æ å·¥å…·" width:btnWidth height:btnHeight visible:false \
	toolTip:"å¸§æ å·¥å…·æ¡" pos:btnPos
	button btnDemoTool "ä½œå“é¢„è®¾" width:btnWidth height:btnHeight visible:false pos:btnPos \
	toolTip:"[å·²æœ‰æƒ³æ³•å¾…è¡¥å……]\r\næ–¹ä¾¿æ¸²æŸ“ä½œå“å’Œç»ƒä¹ çš„å·¥å…·"
	button btnSelBiped "é€‰æ‹©Biped" width:btnWidth height:btnHeight visible:false \
	toolTip:"é€‰æ‹©æ‰€æœ‰biped" pos:btnPos
	button btnSelBone "é€‰æ‹©Bone" width:btnWidth height:btnHeight  visible:false \
	toolTip:"é€‰æ‹©æ‰€æœ‰bone" pos:btnPos
	button btnFnTCB "TCB/æ¬§æ‹‰" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ¬§æ‹‰å’ŒTCBäº’è½¬" pos:btnPos
	button btnEulerFilter "æ¬§æ‹‰è¿‡æ»¤" width:btnWidth height:btnHeight visible:false \
	tooltip:"Boneéª¨éª¼è¿‡æ»¤æ¬§æ‹‰æ—‹è½¬" pos:btnPos
	button btnDelOutKeys "æ¸…æ‰€æœ‰å¸§" width:btnWidth height:btnHeight visible:false \
	toolTip:"æ¸…é™¤æ‰€æœ‰å…³é”®å¸§" pos:btnPos
	button btnCleanOutKeys "æ¸…æ— é™å¸§" width:btnWidth height:btnHeight visible:false \
	toolTip:"æ¸…èŒƒå›´å¤–å¸§(æ— é™å¸§)" pos:btnPos
	button btnEndBone "å¢åˆ æœ«ç«¯" width:btnWidth height:btnHeight visible:false \
	toolTip:"æ·»åŠ é€‰æ‹©çš„Boneæœ«ç«¯ï¼Œå¯å›é€€\r\nå³é”®æ¸…é™¤ï¼ˆæ³¨æ„ \"tempBoneEndAll\" å±‚ï¼‰" pos:btnPos
	button btnRenameTools "æ”¹åå·¥å…·" width:btnWidth height:btnHeight visible:false \
	toolTip:"è¶…çº§é‡å‘½åå·¥å…·" pos:btnPos
	button btnBipedScale "CSç¼©æ”¾" width:btnWidth height:btnHeight visible:false \
	toolTip:"æ•ˆæœå±•ç¤ºå¯ç”¨ï¼Œå¯¼å…¥å¼•æ“åˆ«ç”¨\r\nå†æ¬¡ç‚¹å‡»å¯è§£é™¤" pos:btnPos
	button btnSelByColor "åŒè‰²é€‰æ‹©" width:btnWidth height:btnHeight visible:false \
	tooltip:"é€‰æ‹©åŒé¢œè‰²ç‰©ä½“" pos:btnPos
	button btnMeshToBone "ç ´ç¢å·¥å…·" width:btnWidth height:btnHeight visible:false \
	toolTip:"ç ´ç¢ç¢å—å¿«é€ŸåŠ éª¨éª¼" pos:btnPos
	button btnMassFX "åŠ¨åŠ¨åŠ›å­¦" width:btnWidth height:btnHeight visible:false \
	tooltip:"3dsMax è‡ªå¸¦ MassFX æ¨¡æ‹Ÿï¼Œå¼•æ“åº”è¯¥æ— æ•ˆ" pos:btnPos
	button btnCollider "ç¢°æ’æ¨¡æ‹Ÿ" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ¨¡æ‹Ÿç¢°æ’ï¼Œåˆ†å¼€ç‰©ä½“" pos:btnPos
	button btnBakeAnim "åŠ¨ç”»çƒ˜ç„™" width:btnWidth height:btnHeight visible:false \
	tooltip:"å¯ä¿æŒåç§»" pos:btnPos
	button btnHideBipedTwists "éšè—Twist" width:btnWidth height:btnHeight visible:false \
	toolTip:"éšè—æ‰€æœ‰ Biped è‡ªå¸¦ Twistsï¼Œå†ç‚¹æ˜¾ç¤º" pos:btnPos
	button btnQuickPrev "å¿«é€Ÿæ‹å±" width:btnWidth height:btnHeight visible:false \
	toolTip:"å·¦ï¼šå¿«é€Ÿæ‹å±é¢„è§ˆ\r\nå³ï¼šæ‰“å¼€é¢„è§ˆæ–‡ä»¶å¤¹" pos:btnPos
	button btnChainsTools "é“¾æ¡å·¥å…·" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ ¹æ®æ ·æ¡çº¿åˆ›å»ºé“¾æ¡ç»‘å®šçš„å·¥å…·" pos:btnPos
	button btnCutSequence "åŠ¨ç”»åˆ†æ®µ" width:btnWidth height:btnHeight visible:false pos:btnPos \
	toolTip:"ä¸ºé•¿åŠ¨ç”»åˆ†æ®µåŠ¨ä½œåŒºé—´ (ä¿®æ”¹è‡ªSan_oOo)"
	button btnSkinTools "Skin å·¥å…·" width:btnWidth height:btnHeight visible:false \
	toolTip:"Skinå·¥å…·é›†æˆ (ä¿®æ”¹è‡ªSan_oOo)" pos:btnPos
	button btnCombineDetachSkin "Skin æ‹†åˆ" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ‹†åˆ†åˆå¹¶ Mesh å¹¶ä¸”ä¿ç•™ Skin ä¿¡æ¯ï¼Œé€‰ä¸­ Mesh æ‰§è¡Œ" pos:btnPos
	button btnBoxMan "æ–¹å—è¶…äºº" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ–¹å—ç»ƒä¹ äººåˆ¶ä½œå·¥å…·ï¼ŒåŠæˆå“å¾…å®Œå–„" pos:btnPos
	button btnTwistBones "Twiståˆ›å»º" width:btnWidth height:btnHeight visible:false \
	tooltip:"ç”¨ bone ä»£æ›¿ Biped è‡ªå¸¦ Twistï¼Œé¿å…è¿‡åº¦ç¿»è½¬" pos:btnPos
	button btnFnKeyType "æ”¹æ»‘åŠ¨å¸§" width:btnWidth height:btnHeight visible:false \
	toolTip:"æ‰¹é‡è½¬æ¢æ»‘åŠ¨å…³é”®å¸§ç­‰,\r\nåç»­å¯èƒ½æŒ‰éœ€ä¼˜åŒ–æ›´å¤šè®¾ç½®" pos:btnPos
	button btnRenderTools "å¤šå‘æ¸²æŸ“" width:btnWidth height:btnHeight visible:false \
	tooltip:"å¤šæ–¹å‘æ¸²æŸ“å·¥å…·" pos:btnPos
	button btnMopherSlider "è¡¨æƒ…æ»‘æ¡" width:btnWidth height:btnHeight visible:false \
	toolTip:"é€‰æ‹©å¸¦morpherçš„meshï¼Œ\r\næ‰“å¼€å¿«é€Ÿè°ƒèŠ‚æ»‘æ¡æ–¹ä¾¿Kè¡¨æƒ…~" pos:btnPos
	button btnMorpherCtrl "è¡¨æƒ…æ§ä»¶" width:btnWidth height:btnHeight visible:false \
	tooltip:"å¿«é€Ÿåˆ›å»ºè¡¨æƒ…æ§åˆ¶å™¨" pos:btnPos
	button btnMirrorMoph "Morphé•œåƒ" width:btnWidth height:btnHeight visible:false \
	toolTip:"é•œåƒ Morpher æ‹¾å–å¯¹è±¡ï¼Œæ–¹ä¾¿è¡¨æƒ…ç»‘å®š" pos:btnPos
	button btnDelDecimalKeys "åˆ å°æ•°å¸§" width:btnWidth height:btnHeight visible:false \
	toolTip:"åˆ é™¤æ‰€æœ‰å°æ•°å¸§" pos:btnPos
	button btnReplaceSkinBones "è’™çš®æ¢éª¨" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ›¿æ¢Skinè’™çš®éª¨éª¼~\r\nï¼ˆå·¦å³é”®ç‚¹å‡»æœ‰2ä¸ªä¸åŒæ’ä»¶ï¼‰" pos:btnPos
	checkbutton ckbFnMtlDisplay "ç´ æ¨¡åˆ‡æ¢" width:btnWidth height:btnHeight visible:false \
	toolTip:"å·¦:åˆ‡æ¢æ˜¾ç¤ºéšè—è´´å›¾,æ–¹ä¾¿ç™½æ¨¡é¢„è§ˆ\r\nå³:Clayæ˜¾ç¤ºå¼€å…³(çº¢è‰²æ¨¡å‹æ˜¾ç¤º)\r\næš‚ä¸æ”¯æŒå­æè´¨å’ŒVrayæè´¨..."
	button btnXpsConvert "XPS è½¬æ¢" width:btnWidth height:btnHeight visible:false \
	tooltip:"Xnalara å¯¼å…¥ 3dsMax" pos:btnPos
	button btnCleanCustomAtts "æ¸…ç†å†—ä½™" width:btnWidth height:btnHeight visible:false \
	tooltip:"æ¸…ç†å†—ä½™è‡ªå®šä¹‰å±æ€§ï¼Œ\r\nå¦‚ day1reCA å’Œ SimpleFaceData ï¼Ÿ\r\nè¯·æ³¨æ„å¤‡ä»½å’Œä¿å­˜æ–‡ä»¶" pos:btnPos
	button btnLODCreate "LOD åˆ›å»º" width:btnWidth height:btnHeight visible:false \
	tooltip:"åˆ›å»º LODï¼Œä¿ç•™ Skinï¼Œæ–¹ä¾¿é¢æ•°å¤šçš„æ¨¡å‹åšåŠ¨ç”»" pos:btnPos
	checkbutton ckbIsoMesh "å•æ˜¾æ¨¡å‹" width:btnWidth height:btnHeight visible:false \
	toolTip:"å•ç‹¬æ˜¾ç¤ºæ¨¡å‹é¢„è§ˆ" pos:btnPos highlightcolor:myCheckedColor 
	pos:btnPos highlightcolor:myCheckedColor 

	groupbox gbxTips "" pos:[5,215] width:210 height:30
	
	-- label lblLink "2019.9[Bullet.S]4869" pos:[12,226] width:145 height:15
	dotnetcontrol lblLink "Label" text:"2019.9 _ [ Bullet.S ]âœ¨" pos:[12,226] width:145 height:15
	checkbutton btnConfig "è®¾ç½®" pos:[170,223] width:40 height:20 border:false checked:true highlightColor:myCheckedColor

	timer timerTickTock interval:200 active:true

	dotNetControl dotLVFilesList "system.windows.forms.listView" selection:0 height:150 width:160 pos:[0,585]
	-- checkbutton ckbOpenConfigFilePath "æ‰“å¼€é…ç½®æ–‡ä»¶ç›®å½•" width:120 height:20 pos:btnPos  border:false checked:true highlightColor:myCheckedColor

	progressBar pgbLine01 "" pos:[0,-9999] width:160 height:9 color:white value:100
	progressBar pgbLine02 "" pos:[0,-9999] width:160 height:9 color:yellow value:100
	progressBar pgbLine03 "" pos:[0,-9999] width:160 height:9 color:(color myCheckedColor.r myCheckedColor.g myCheckedColor.b) value:100

	local m_PBKeyTimeArray
	local m_PBKeyMiliSecArray
	local m_PBStartTime
	local m_PBPointer
----------------------------------UIåŠä½œè€…ID------------------------------------------------
	fn fnInitDotNetListView =
	(	
		local align = dotNetClass "HorizontalAlignment"
		
		dotLVFilesList.Clear()
		dotLVFilesList.View = (dotNetClass "System.Windows.Forms.View").Details	
		dotLVFilesList.FullRowSelect = true
		dotLVFilesList.GridLines = false		
		dotLVFilesList.ShowItemToolTips = true
		dotLVFilesList.MultiSelect = false
		dotLVFilesList.CheckBoxes = false
		dotLVFilesList.HideSelection = false
		dotLVFilesList.Columns.Add "æ‰“å¼€æœ€è¿‘æ–‡ä»¶" 150
		dotLVFilesList.ForeColor = BsDotForeColor
		dotLVFilesList.BackColor = BsDotBackColor
		if dotLVFilesList.SelectedItems.Count > 0 then
		(
			dotLVFilesList.SelectedItems[0].BackColor = BsDotCheckColor
		)

		dotLVFilesList.Update()
		dotLVFilesList.Refresh()
	)

	fn fnAddToLbxList r =
	(				
		dotLVFilesList.Items.Clear()
		rows = #()	
		i = 1
		for x in r do	
		(
			li = dotNetObject "System.Windows.Forms.ListViewItem" ""
			li.useItemStyleForSubItems = false
			bold = (dotnetclass "System.Drawing.FontStyle").Bold
						
			li.text = (x as string)
			li.subitems.add x	
			
			append rows li		
			i += 1
		)
		
		dotLVFilesList.Items.addRange rows
	)

	fn fnRefreshRecentFiles =
	(
		fnInitDotNetListView()
		local recentfiles = (getdir #maxData) + "RecentDocuments.xml"
		if doesfileexist recentfiles then
		(
			local arrRecentFiles     = #()
			local xDoc = dotnetobject "system.xml.xmldocument"	
			xDoc.Load recentfiles
			local Rootelement = xDoc.documentelement

			arrRecentFiles = for i = 0 to rootelement.childnodes.item[4].childnodes.itemof[0].childnodes.count-1 collect 
			(
				rootelement.childnodes.item[4].childnodes.itemof[0].childnodes.itemof[i].childnodes.itemof[3].innertext	
			)
			LRXML = Undefined
			XDoc = Undefined
			XDoc = nothing	
		)
		return arrRecentFiles
	)

	fn fnRefreshRecentFileList =
	(
		local arrRecentFiles = fnRefreshRecentFiles()
		local arrRecentFilesName = #()
		if arrRecentFiles[1] != undefined then
		(
			for i in arrRecentFiles do 
			(
				if doesFileExist i then
				(
					append arrRecentFilesName ("ğŸ“„ " + (getFilenameFile i) + ".max")
				)
				else append arrRecentFilesName ("ğŸ“„ ( X ) " + (getFilenameFile i) + ".max")
			)
			-- dotLVFilesList.items = arrRecentFilesName
			fnAddToLbxList arrRecentFilesName
		)
	)
	
	fn fnGetSelectedId =
	(
		c = dotLVFilesList.SelectedItems.Count - 1		
		id = 0		
		for i = 0 to c do id = dotLVFilesList.SelectedItems.Item[i].Index + 1
		return id
	)

	fn fnOpenRecentFile =
	(
		local idSelFile = fnGetSelectedId()
		local arrRecentFiles = fnRefreshRecentFiles()

		if idSelFile > 0  then
		(
			if doesFileExist arrRecentFiles[idSelFile] then
			(
				loadMaxFile (arrRecentFiles[idSelFile] as string) useFileUnits:true quiet:true
			)
			else (messagebox ("æ–‡ä»¶å¯èƒ½å·²è¢«åˆ é™¤æˆ–ç§»èµ°ï¼Œè¯·æ£€æŸ¥ï¼ï¼š\r\n\r\n" + (arrRecentFiles[idSelFile] as string) + "                                                                            ") title:"æç¤º")
		)
		fnRefreshRecentFileList()
	)

	fn fnOpenRecentFilePath =
	(
		local idSelFile = fnGetSelectedId()
		local arrRecentFiles = fnRefreshRecentFiles()

		if idSelFile > 0 and arrRecentFiles[idSelFile] != undefined then
		(
			if doesFileExist arrRecentFiles[idSelFile] then
			(
				shellLaunch (getFilenamePath (arrRecentFiles[idSelFile])) ""
			)
		)
		fnRefreshRecentFileList()
	)

	fn fnDotnetBitmap fName =
	(
		if doesFileExist fName then
		(
			local img = (dotnetclass "System.Drawing.Image").fromfile fName 
			local retBmp = dotnetObject "System.Drawing.Bitmap" (img.Width + 2) (img.height + 2)
			local g = (dotnetclass "system.drawing.graphics").fromImage retBmp
			g.drawimage img 0 0 	
			img.Dispose();
			retBmp
		)
		else return undefined
	)

	fn fnSwitchToolBtnName =
	(
		ToolTipObj = dotnetobject "System.Windows.Forms.ToolTip"
		ToolTipObj.SetToolTip btnelement "æ‰‹æŒ‡è§£å‹æ”¾æ¾æŒ‰é’®"

		ckbC1.text = strBtnName[1][1]
		ckbC2.text = strBtnName[1][2]
		ckbC3.text = strBtnName[1][3]
		ckbC4.text = strBtnName[1][4]

		btnElement.flatstyle                         = btnElement.flatstyle.flat
		btnElement.FlatAppearance.BorderSize         = 0
		btnElement.backcolor                         = BsDotBackColor
		btnelement.FlatAppearance.MouseDownBackColor = BsDotBackColor
		btnelement.FlatAppearance.MouseOverBackColor = BsDotBackColor
		-- btnElement.TextAlign                         = (dotnetclass "System.Drawing.ContentAlignment").MiddleCenter
		btnElement.image                             = (fnDotnetBitmap iconElement)
	)

	fn fnSetBtnPrimogem =
	(
		ToolTipObj = dotnetobject "System.Windows.Forms.ToolTip"
		ToolTipObj.SetToolTip btnPrimogem "ç‚¹å‡»æ‰“å¼€è‡ªå®šä¹‰è„šæœ¬é›†"

		btnPrimogem.flatstyle                         = btnPrimogem.flatstyle.flat
		btnPrimogem.FlatAppearance.BorderSize         = 0
		btnPrimogem.backcolor                         = BsDotBackColor
		btnPrimogem.FlatAppearance.MouseDownBackColor = BsDotBackColor
		btnPrimogem.FlatAppearance.MouseOverBackColor = BsDotCheckColor
		btnPrimogem.image                             = (fnDotnetBitmap iconPrimogem)
	)

	fn fnSwitchMagicBtn toggleID =
	(
		if toggleID == 1 then
		(
			rolBsKeyTools.width        = 220
			-- rolBsKeyTools.height       = 250
			btnMagicBtn.text           = "(â‰– â—¡ â‰–)âœ§"
			switchToolPanel            = 0
		)
		else
		(
			rolBsKeyTools.width        = 355
			-- rolBsKeyTools.height       = 250
			btnMagicBtn.text           = "( = `â–½`)ãƒ"
			switchToolPanel            = 1
		)
	)

	fn fnRefreshMagicBtn =
	(
		if switchToolPanel == 0 then (fnSwitchMagicBtn 1) else (fnSwitchMagicBtn 0)
	)

	fn fnReloadToolsBtn =
	(
		arrSourToolC1 = #(rolBsKeyTools.btnPicker,rolBsKeyTools.btnFastAlign,
						rolBsKeyTools.ckbPerspLock,rolBsKeyTools.btnAnimMirror,
						rolBsKeyTools.btnVportTools,rolBsKeyTools.btnBatchExport,
						rolBsKeyTools.btnTweenMachine,rolBsKeyTools.btnProTraj,
						rolBsKeyTools.btnRescaleWU,rolBsKeyTools.btnXrSkinTool,
						rolBsKeyTools.btnFnFrame,rolBsKeyTools.btnRetargetTools)
		arrSourToolC2 = #(rolBsKeyTools.btnTrackBarTools,rolBsKeyTools.btnDemoTool,
						rolBsKeyTools.btnSelBiped,rolBsKeyTools.btnSelBone,
						rolBsKeyTools.btnFnTCB,rolBsKeyTools.btnEulerFilter,
						rolBsKeyTools.btnDelOutKeys,rolBsKeyTools.btnCleanOutKeys,
						rolBsKeyTools.btnEndBone,rolBsKeyTools.btnRenameTools,
						rolBsKeyTools.btnBipedScale,rolBsKeyTools.btnSelByColor)
		arrSourToolC3 = #(rolBsKeyTools.btnMeshToBone,rolBsKeyTools.btnMassFX,
						rolBsKeyTools.btnCollider,rolBsKeyTools.btnBakeAnim,
						rolBsKeyTools.btnHideBipedTwists,rolBsKeyTools.btnQuickPrev,
						rolBsKeyTools.btnChainsTools,rolBsKeyTools.btnCutSequence,
						rolBsKeyTools.btnSkinTools,rolBsKeyTools.btnCombineDetachSkin,
						rolBsKeyTools.btnBoxMan,rolBsKeyTools.btnTwistBones)
		arrSourToolC4 = #(rolBsKeyTools.btnFnKeyType,rolBsKeyTools.btnRenderTools,
						rolBsKeyTools.btnMopherSlider,rolBsKeyTools.btnMorpherCtrl,
						rolBsKeyTools.btnMirrorMoph,rolBsKeyTools.btnDelDecimalKeys,
						rolBsKeyTools.btnReplaceSkinBones,rolBsKeyTools.ckbFnMtlDisplay,
						rolBsKeyTools.btnXpsConvert,rolBsKeyTools.btnCleanCustomAtts,
						rolBsKeyTools.btnLODCreate,rolBsKeyTools.ckbIsoMesh)
		
		fnLoadToolBtnConfig()
		arrToolsAllTemp = arrSourToolC1 + arrSourToolC2 + arrSourToolC3 + arrSourToolC4
		arrTargetTemp = #()
		for i in iniToolBtnAll where i != undefined do
		(
			local strSortID = i as string
			local indexToolID = (strSortID[1] as number - 1) * 12 + (strSortID[2] + strSortID[3]) as Number
			append arrTargetTemp arrToolsAllTemp[indexToolID]
		)
		arrToolC1 = for i = 1 to arrTargetTemp.count/4 collect arrTargetTemp[i]
		arrToolC2 = for i = (arrTargetTemp.count/4 + 1) to (2 * arrTargetTemp.count/4) collect arrTargetTemp[i]
		arrToolC3 = for i = (2 * arrTargetTemp.count/4 + 1) to (3 * arrTargetTemp.count/4) collect arrTargetTemp[i]
		arrToolC4 = for i = (3 * arrTargetTemp.count/4 + 1) to (4 * arrTargetTemp.count/4) collect arrTargetTemp[i]
	)

	fn fnSwitchToolsBtn idBtn =
	(
		local arrBtnAll = arrToolC1 + arrToolC2 + arrToolC3 + arrToolC4
		local curMaxVersion = ((maxVersion())[1] / 1000)
		for b in arrBtnAll do (b.visible = false)

		if not rolBsKeyTools.dialogBar then 
		(
			str  = "for b = 1 to arrToolC" + idBtn as string + ".count do" + "\r\n"
			str += "(" + "\r\n"
			str += "	arrToolC" + idBtn as string + "[b].visible = true" + "\r\n"
			str += "	if (mod b 2 == 1) then \r\n"
			str += "	("
			str += "		arrToolC" + idBtn as string + "[b].pos = " + [225,45] as string + " + [0,(b - 1) * 16.5]" + "\r\n"
			str += "	)"
			str += "	else if (mod b 2 == 0) then"
			str += "	("
			str += "		arrToolC" + idBtn as string + "[b].pos = " + [285,45] as string + " + [0,(b - 2) * 16.5]" + "\r\n"
			str += "	)"
			str += ")"
		)
		else if rolBsKeyTools.dialogBar and ((cui.getDockState rolBsKeyTools) as string == "cui_dock_left" or (cui.getDockState rolBsKeyTools) as string == "cui_dock_right") then
		(
			str  = "for b = 1 to arrToolC" + idBtn as string + ".count do" + "\r\n"
			str += "(" + "\r\n"
			str += "	arrToolC" + idBtn as string + "[b].visible = true" + "\r\n"
			str += "	if (mod b 2 == 1) then \r\n"
			str += "	("
			str += "        if " + curMaxVersion as string + " > 20 then "
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [5,490] as string + " + [0,(b - 1) * 17]" + "\r\n"
			str += "		)"
			str += "		else"
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [15,370] as string + " + [0,(b - 1) * 17]" + "\r\n"
			str += "		)"
			str += "	)"
			str += "	else if (mod b 2 == 0) then"
			str += "	("
			str += "		if " + curMaxVersion as string + " > 20 then "
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [65,490] as string + " + [0,(b - 2) * 17]" + "\r\n"
			str += "		)"
			str += "		else"
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [85,370] as string + " + [0,(b - 2) * 17]" + "\r\n"
			str += "		)"
			str += "	)"
			str += ")"
		)
		else if rolBsKeyTools.dialogBar and ((cui.getDockState rolBsKeyTools) as string == "cui_dock_top" or (cui.getDockState rolBsKeyTools) as string == "cui_dock_bottom") then
		(
			str  = "for b = 1 to arrToolC" + idBtn as string + ".count do" + "\r\n"
			str += "(" + "\r\n"
			str += "	arrToolC" + idBtn as string + "[b].visible = true" + "\r\n"
			str += "	if (mod b 2 == 1) then \r\n"
			str += "	("
			str += "        if " + curMaxVersion as string + " > 20 then "
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [1090,0] as string + " + [(b - 1) * 30,0]" + "\r\n"
			str += "		)"
			str += "		else"
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [1090,10] as string + " + [(b - 1) * 60,0]" + "\r\n"
			str += "		)"
			str += "	)"
			str += "	else if (mod b 2 == 0) then"
			str += "	("
			str += "		if " + curMaxVersion as string + " > 20 then "
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [1090,20] as string + " + [(b - 2) * 30,0]" + "\r\n"
			str += "		)"
			str += "		else"
			str += "		("
			str += "			arrToolC" + idBtn as string + "[b].pos = " + [1090,10] as string + " + [(b - 1) * 60,0]" + "\r\n"
			str += "		)"
			str += "	)"
			str += ")"
		)
		execute str
	)

	fn fnSwitchMsBtn idMsBtn =
	(
		strMsBtn = idMsBtn as string
		execute ("arrMsTemp = for i in iniArrMyScripts" + strMsBtn + " collect i")
	)

	fn fnSwitchToolBtnChecked Btn =
	(
		arrToolsBtn = #(rolBsKeyTools.ckbC1,rolBsKeyTools.ckbC2,rolBsKeyTools.ckbC3,rolBsKeyTools.ckbC4)
		arrBtn = arrToolsBtn
		for i = 1 to arrBtn.count do
		(
			if i != Btn then 
			(
				arrBtn[i].checked = false
			)
			else 
			(
				idBtn = Btn
				arrBtn[Btn].checked = true
			)
		)
	)

	fn fnIsBipRoot obj = 
	(
		if ((classof obj.baseobject) == Biped_Object) do 
		(
			if (obj.controller.rootNode == obj) do (return true)
		)
		return false
	)

	fn fnBipedScale =
	(
		if (selection.count != 0) then 
		(
			for i in selection as Array do
			(
				if ((fnIsBipRoot i) == false) then 
				(
					subAnimSelected = getSubAnimName (i.transform.controller[1][1]) 1
					undo "addDelBipedScale" on
					(
						if (subAnimSelected == #ScaleXYZ) then 
						try (i.transform.controller[1][1].delete 1)catch()
						else if (subAnimSelected == #available) then 
						(
							try
							(
								rootnodeSelected = i.transform.controller.rootnode
								rootnodeSelected.transform.controller.enableSubAnims = true
								i.transform.controller[1][1][1].controller = ScaleXYZ ()
							)catch()
						)
					)
				)
			)
		)
	else (messagebox "è¯·é€‰æ‹©ä¸€æ ¹æˆ–å¤šæ ¹ Biped éª¨éª¼!    \r\n" beep:false title:"é€‰æ‹©æœ‰è¯¯ï¼")
	)

	Fn fnCleanOutRangeKeys inputObject =  ---æ¸…ç†æ— é™å¸§,ä»¥å‰æ”¶é›†çš„,æ‰¾ä¸åˆ°æ¥æºäº†,å¤§æ¦‚æ˜¯éå†å­åŠ¨ç”»
	(
		startTime = AnimationRange.Start
		endTime = AnimationRange.End
		for i = 1 to inputObject.numSubs do
		(
			tempSubAnim = GetSubAnim inputObject i
			tempController = tempSubAnim.Controller
			
			if tempController != undefined do
			(
				tempKeyList = tempController.Keys
				
				outEndKeysIndex = for i = 1 to tempKeyList.Count where tempKeyList[i].Time > endTime collect i
				if outEndKeysIndex.Count > 0 do for i = 1 to outEndKeysIndex.Count do DeleteKey tempKeyList tempKeyList.count
				
				outStartKeysIndex = for i = 1 to tempKeyList.Count where  tempKeyList[i].Time < startTime collect i
				for i = 1 to outStartKeysIndex.Count do DeleteKey tempKeyList 1
			)
			if tempSubAnim.numSubs > 0 do fnCleanOutRangeKeys tempSubAnim
		)
	)

	-- fn fnDelSelKeys =
	-- (
	-- 	for o in selection where (o.ishidden == false) do 
	-- 	(
	-- 		if (classof o == Biped_Object) then
	-- 		(
	-- 			if classof o.controller == Vertical_Horizontal_Turn then  --æ¸…ç†è´¨å¿ƒå¸§
	-- 			(
	-- 				biped.deleteKeys o.controller.vertical #selection
	-- 				biped.deleteKeys o.controller.horizontal #selection
	-- 				if (((sysinfo.GetMaxLanguage())[3]=="CHS") and ((maxVersion())[1] < 20000)) then 
	-- 					(biped.deleteKeys o.controller.flip #selection)
	-- 					else(biped.deleteKeys o.controller.turning #selection)
	-- 			)
	-- 			else if classof o.controller == BipSlave_Control then  --æ¸…ç†bipedæ­£å¸¸å¸§
	-- 			(
	-- 				biped.deleteKeys o.controller #selection
	-- 				subanimBipedScale = GetSubAnim o.controller[1] 1
	-- 				if ((subanimBipedScale != undefined) and \
	-- 				(GetSubAnimName subanimBipedScale 1 == #ScaleXYZ)) then  --æ¸…ç†bipedçš„ç¼©æ”¾é’ˆ
	-- 				(
	-- 					deleteKeys subanimBipedScale.controller #selection
	-- 				)
	-- 			)
	-- 		)
	-- 		else (deleteKeys o #selection)   ---æ¸…ç†ébipedå¸§
	-- 	)
	-- )

	fn fnDelAllDecimalKeys arrAllKey = 
	(
		local arrDelKeyIndex = #()
		for i in arrAllKey do ----è·å–å°æ•°å¸§çš„å¸§æ•°
		(
			if (int(i) as time) != i then appendIfUnique arrDelKeyIndex i
		)
		for o in objects do 
		(
			deselectKeys o --å–æ¶ˆä¹‹å‰é€‰æ‹©çš„å¸§é˜²æ­¢è¯¯åˆ 
			for k in arrDelKeyIndex do
			(
				case of 
				(
					(classof o.controller == Vertical_Horizontal_Turn): --åˆ é™¤Bipedè´¨å¿ƒå°æ•°å¸§
					(
						selectkeys o.controller.vertical k
						selectkeys o.controller.horizontal k
						if (((sysinfo.GetMaxLanguage())[3]=="CHS") and ((maxVersion())[1] < 20000)) then 
						(selectkeys o.controller.flip k)
						else(selectkeys o.controller.turning k)
						biped.deleteKeys o.controller.vertical #selection
						biped.deleteKeys o.controller.horizontal #selection
						if (((sysinfo.GetMaxLanguage())[3]=="CHS") and ((maxVersion())[1] < 20000)) then 
						(biped.deleteKeys o.controller.flip #selection)
						else(biped.deleteKeys o.controller.turning #selection)
					)
					(classof o.controller == BipSlave_Control):
					(
						selectkeys o.controller k
						biped.deleteKeys o.controller #selection  --æ¸…ç†bipedæ­£å¸¸å°æ•°å¸§
						subanimBipedScale = GetSubAnim o.controller[1] 1
						if ((subanimBipedScale != undefined) and \
						(GetSubAnimName subanimBipedScale 1 == #ScaleXYZ)) then  --æ¸…ç†bipedçš„ç¼©æ”¾å°æ•°é’ˆ
						(
							selectkeys subanimBipedScale.controller k
							deleteKeys subanimBipedScale.controller #selection
						)
					)
					default:(selectkeys o k;deleteKeys o #selection)   ---æ¸…ç†ébipedå¸§
				)
			)
		)
	)

	fn fnAddAllSubsKeys tempObj =
	(
		for i = 1 to tempObj.numSubs do
		(
			tempSubAnim     = GetSubAnim tempObj i
			tempSubAnimName = getSubAnimName tempObj i
			tempController  = tempSubAnim.Controller
			
			if tempController != undefined do
			(
				for j in tempController.Keys do
				(
					if (tempSubAnimName == #Link_Times or tempSubAnimName == ("é“¾æ¥æ—¶é—´" as name)) then
					(
						appendIfUnique arrLinkKeys j  ---------æ·»åŠ linkå¸§åˆ°æ•°ç»„
					)
					appendIfUnique arrKeysTime j.time
					appendIfUnique arrBlockingKeys j.time
					if j.selected == true then (appendIfUnique arrKeysSelected j.time)
				)
			)
			if tempSubAnim.numSubs > 0 do fnAddAllSubsKeys tempSubAnim
		)
	)

	-- -- fn fnAddLinkKeys tempObj =
	-- -- (
	-- 	fn fnAddLinkTimesKeys tempObj i=     --æ·»åŠ linkTimeså…³é”®å¸§
	-- 	(
	-- 		-- for i = 1 to tempObj.controller.numsubs do 
	-- 		-- (
	-- 			if ((GetSubAnimName tempObj.controller i) == #Link_Times or (GetSubAnimName tempObj.controller i) == ("é“¾æ¥æ—¶é—´" as name)) then
	-- 			(
	-- 				if tempObj.controller[i].keys[1] != undefined then
	-- 				(
	-- 					for i in tempObj.controller[i].keys do 
	-- 					(
	-- 						appendIfUnique arrLinkKeys i  ---------æ·»åŠ linkå¸§åˆ°æ•°ç»„
	-- 						appendIfUnique arrKeysTime i.time
	-- 						appendIfUnique arrBlockingKeys i.time
	-- 						if i.selected == true then (appendIfUnique arrKeysSelected i.time)
	-- 					)
	-- 				)
	-- 			)
	-- 		-- )
	-- 	)
	-- 	fn fnAddLinkParamsKeys tempObj i=   ----æ·»åŠ LinkParamsä¸‹é¢çš„Transformå¸§
	-- 	(
	-- 		local tempLinkController
	-- 		local keyTimeStartTemp
	-- 		local keyTimeEndTemp
			
	-- 		-- for i = 1 to tempObj.controller.numsubs do 
	-- 		-- (
	-- 			if ((GetSubAnimName tempObj.controller i) == #Link_Params) then
	-- 			(
	-- 				tempLinkController = tempObj.controller[i]
	-- 				if tempLinkController[1] != undefined then
	-- 				(
	-- 					for i = 1 to tempLinkController.numsubs do -----linkå±æ€§çš„boneä¸‹é¢çš„prså¸§------
	-- 					(
	-- 						if (((tempLinkController[i]).name == "Position") or \
	-- 						((tempLinkController[i]).name == "Rotation") or \
	-- 						((tempLinkController[i]).name == "Scale")) then
	-- 						(
	-- 							if tempLinkController[i].keys[1] != undefined then
	-- 							(
	-- 								keyTimeStartTemp = tempLinkController[i].keys[1].time
	-- 								keyTimeEndTemp = tempLinkController[i].keys[tempLinkController[i].keys.count].time
	-- 								appendIfUnique arrKeysTime keyTimeStartTemp
	-- 								appendIfUnique arrKeysTime keyTimeEndTemp
	-- 								for i in tempLinkController[i].keys do 
	-- 								(
	-- 									appendIfUnique arrBlockingKeys i.time
	-- 									if i.selected == true then (
	-- 										appendIfUnique arrKeysSelected i.time
	-- 									)
	-- 								)
	-- 							)
	-- 						)
	-- 					)
	-- 				)
	-- 			)
	-- 		-- )
	-- 	)
	-- 	-- fnAddLinkTimesKeys tempObj
	-- 	-- fnAddLinkParamsKeys tempObj
	-- -- )

	-- fn fnAddPrsKeys tempObj i=  ---------æ·»åŠ æ­£å¸¸ébipedçš„prså¸§(æ²¡åŠ link),iæ˜¯å­åŠ¨ç”»ID,åé¢ç”¨åˆ°,æå‰ä¼ å…¥å‡å°‘éå†
	-- (
	-- 	local keyTimeStartTemp
	-- 	local keyTimeEndTemp
		
	-- 	-- for i = 1 to tempObj.controller.numsubs do 
	-- 	-- (
	-- 		if (((tempObj.controller[i]).name == "Position") or \
	-- 		((tempObj.controller[i]).name == "Rotation") or \
	-- 		((tempObj.controller[i]).name == "Scale")) then
	-- 		(
	-- 			if tempObj.controller[i].keys[1] != undefined then
	-- 			(
	-- 				keyTimeStartTemp = tempObj.controller[i].keys[1].time
	-- 				keyTimeEndTemp = tempObj.controller[i].keys[tempObj.controller[i].keys.count].time
	-- 				appendIfUnique arrKeysTime keyTimeStartTemp
	-- 				appendIfUnique arrKeysTime keyTimeEndTemp
	-- 				for i in tempObj.controller[i].keys do 
	-- 				(
	-- 					appendIfUnique arrBlockingKeys i.time
	-- 					if i.selected == true then (
	-- 						appendIfUnique arrKeysSelected i.time
	-- 					)
	-- 				)
	-- 			)
	-- 		)
	-- 	-- )
	-- )

	fn fnAddBipedKeys tempObj =  ---------æ”¶é›†Bipedå¸§
	(
		local keyTimeStartTemp
		local keyTimeEndTemp
		local subanimBipedScale

		if classof tempObj.controller != Footsteps then
		(
			if classof tempObj.controller != Vertical_Horizontal_Turn then
			(
				--ç­›é€‰å‡ºéè´¨å¿ƒçš„bipedå¸§
				fnAddAllSubsKeys tempObj
				-- if (tempObj.controller.keys[1] != undefined) then
				-- (
				-- 	for i in tempObj.controller.keys do 
				-- 	(
				-- 		appendIfUnique arrKeysTime i.time   ---æ·»åŠ åˆ°æ•°ç»„
				-- 		appendIfUnique arrBlockingKeys i.time
				-- 		if i.selected == true then (
				-- 			appendIfUnique arrKeysSelected i.time
				-- 		)
				-- 	)
				-- )
				-- subanimBipedScale = GetSubAnim tempObj.controller[1] 1
				-- if ((subanimBipedScale != undefined) and \
				-- (GetSubAnimName subanimBipedScale 1 == #ScaleXYZ)) then  ----ç­›é€‰å‡ºbipedçš„ç¼©æ”¾å¸§
				-- (
				-- 	if subanimBipedScale[1].keys[1] != undefined then
				-- 	(
				-- 		keyTimeStartTemp = subanimBipedScale[1].keys[1].time
				-- 		keyTimeEndTemp = subanimBipedScale[1].keys[subanimBipedScale[1].keys.count].time
				-- 		appendIfUnique arrKeysTime keyTimeStartTemp
				-- 		appendIfUnique arrKeysTime keyTimeEndTemp
				-- 		for i in subanimBipedScale[1].keys do 
				-- 		(
				-- 			appendIfUnique arrBlockingKeys i.time
				-- 			if i.selected == true then (
				-- 				appendIfUnique arrKeysSelected i.time
				-- 			)
				-- 		)
				-- 	)
				-- )
			)
			else
			(-------------------ä¸‹é¢æ˜¯æ”¶é›†è´¨å¿ƒçš„å…³é”®å¸§,å‘åœ¨äºä¸­è‹±æ–‡turningåå­—è¿˜ä¸ä¸€æ ·...
				if classof tempObj.controller == Vertical_Horizontal_Turn then
				(
					bipCtrl  = tempObj.controller
					vertCtrl = bipCtrl.vertical.controller
					horzCtrl = bipCtrl.horizontal.controller
					if (((sysinfo.GetMaxLanguage())[3]=="CHS") and ((maxVersion())[1] < 20000)) then 
						(turnCtrl = bipCtrl.flip.controller)
						else(turnCtrl = bipCtrl.turning.controller)
					bipCtrlTemp = #(vertCtrl,horzCtrl,turnCtrl)
					for c in bipCtrlTemp do
					(
						if c.keys[1] != undefined then
						(
							keyTimeStartTemp = c.keys[1].time
							keyTimeEndTemp = c.keys[c.keys.count].time
							appendIfUnique arrKeysTime keyTimeStartTemp
							appendIfUnique arrKeysTime keyTimeEndTemp
							for i in c.keys do 
							(
								appendIfUnique arrBlockingKeys i.time
								if i.selected == true then (
									appendIfUnique arrKeysSelected i.time
								)
							)
						)
					)
				)
			)
		)
	)
-- å»æ‰ link åˆ¤æ–­ fnLink
	fn fnAddKyes tempObj =   ---æ·»åŠ å¸§(ä¸»è¦æ˜¯é¦–å°¾å¸§),åŠ ä¸ªåˆ¤æ–­æ˜¯å¦å‹¾é€‰link
	(	
		if (classof tempObj != Biped_Object) then
		(
			-- if tempObj.controller != undefined then
			-- (
			-- 	if (classof tempObj.controller) == prs then
			-- 	(
			-- 		for i = 1 to tempObj.controller.numsubs do 
			-- 		(
			-- 			fnAddPrsKeys tempObj i        ---ébipedç‰©ä½“çš„ä½ç§»æ—‹è½¬ç¼©æ”¾å¸§
			-- 		)
			-- 	)
			-- 	if (classof tempObj.controller) == Link_Constraint then
			-- 	(
			-- 		for i = 1 to tempObj.controller.numsubs do 
			-- 		(
			-- 			if fnLink == 1 then (fnAddLinkTimesKeys tempObj i)         ---------linkå±æ€§çš„ç‰©ä½“linkå¸§å’Œélinkå¸§
			-- 			fnAddLinkParamsKeys tempObj i
			-- 		)
			-- 	)
			-- )
			fnAddAllSubsKeys tempObj ---é Biped çš„ç‰©ä½“æ‰€æœ‰å­åŠ¨ç”»å¸§
		)
		else
		(
			fnAddBipedKeys tempObj   ---------bipedå¸§
		)

		-- arrKeysTime = makeUniqueArray arrKeysTime  ---å»é™¤é‡å¤å¸§æ•°
		sort arrKeysTime  ----å¸§æ•°æ’åº
		sort arrKeysSelected
		if (arrKeysTime.count != 0) then
		(
			case of 
			(
				(arrKeysTime.count > 1):
				(
					keyFirst = arrKeysTime[1]            ------æ‰¾åˆ°é¦–å¸§
					keyEnd = arrKeysTime[arrKeysTime.count]   -----------æ‰¾åˆ°å°¾å¸§
				)
				(arrKeysTime.count == 1):   --é˜²æ­¢é¦–å°¾åŒå¸§çš„ä¿é™©
				(
					keyFirst = arrKeysTime[1]
					keyEnd = keyFirst + 1
				)
			)
		)
		if (arrKeysSelected.count != 0) then
		(
			case of 
			(
				(arrKeysSelected.count > 1):
				(
					keySelFirst = arrKeysSelected[1]            ------æ‰¾åˆ°é¦–å¸§
					keySelEnd = arrKeysSelected[arrKeysSelected.count]   -----------æ‰¾åˆ°å°¾å¸§
				)
				(arrKeysSelected.count == 1):   --é˜²æ­¢é¦–å°¾åŒå¸§çš„ä¿é™©
				(
					keySelFirst = arrKeysSelected[1]
					keySelEnd = keySelFirst + 1
				)
			)
		)
	)

	fn fnCollectKeys = ---------æ”¶é›†å…³é”®å¸§
	(
		arrKeysTime     = #()
		arrKeysSelected = #() ----------------å…ˆæ¸…ç©ºæ•°ç»„
		arrLinkKeys     = #()
		arrBlockingKeys = #()
		case of  -----------å¤„ç†é€‰ä¸­,æœªé€‰ä¸­åˆ™å¤„ç†å…¨éƒ¨
		(
			(selection.count == 0):
			(
				for i in (objects as array) where (i.ishidden == false) do 
				(
					fnAddKyes i
				)
			)
			default:
			(
				for i in (selection as array) where (i.ishidden == false) do 
				(
					fnAddKyes i
				)
			)
		)
	)

	fn fnSelLinkKeys keyFirst KeyEnd symbol =  ---------------é€‰æ‹©linkå¸§æ–¹æ³•
	(
		if arrLinkKeys.count != 0 then
		(
			for i in arrLinkKeys do   -------linkå¸§é€‰ä¸­
			(
				i.selected = false ---å…ˆå–æ¶ˆä¹‹å‰linkå¸§é€‰ä¸­çŠ¶æ€
				case of  -------------åˆ¤æ–­linkå¸§ä½ç½®,æ•°å­—æ˜¯éšä¾¿å–çš„æ–¹ä¾¿åˆ¤æ–­æƒ…å†µ
				(
					(symbol == 0):(if i.time <= KeyEnd then i.selected = true)
					(symbol == 1):(if i.time >= keyFirst then i.selected = true)
					(symbol == 2):(i.selected = true)
				)
			)
		)
	)

	fn fnSelKeys keyFirst KeyEnd symbol =  ---------------é€‰æ‹©å¸§çš„æ–¹æ³•
	(
		fn fnSelectKeys keyFirst KeyEnd symbol =  -------å› ä¸ºæœ‰é€‰ä¸­å’Œæ²¡é€‰æ‹©çŠ¶æ€, æ‰€ä»¥åŠ ä¸€ä¸ªæ–¹æ³•ç²¾ç®€ä¸‹
		(
			for i in objects where (i.ishidden == false) do deselectKeys i          --æ¸…é™¤ä¹‹å‰é€‰ä¸­çš„å…³é”®å¸§
			if arrKeysTime.count != 0 then
			(
				selectkeys $ keyFirst KeyEnd  -------------é€‰ä¸­æ­£å¸¸å¸§
				-- if rolBsKeyTools.chkJudgeLinkKey.state == true then
				-- (
					fnSelLinkKeys keyFirst KeyEnd symbol --------------é€‰ä¸­linkå¸§
				-- )
			)
			else
			(
				-- if rolBsKeyTools.chkJudgeLinkKey.state == true then
				-- (
					fnSelLinkKeys keyFirst KeyEnd symbol
				-- )
			)
		)
		case of 
		(
			(selection.count == 0):  ----------åˆ¤æ–­æ˜¯å¦æœ‰é€‰ä¸­ç‰©ä½“
			(
				actionMan.executeAction 0 "40021"    ---æ²¡æœ‰é€‰æ‹©ç‰©ä½“åˆ™é€‰æ‹©æ‰€æœ‰ç‰©ä½“
				fnSelectKeys keyFirst KeyEnd symbol
			)
			default:  ----------------
			(
				fnSelectKeys keyFirst KeyEnd symbol
			)
		)
	)

	mapped fn fnMoveKeysAndLinkKeys obj offset =  ----https://forums.cgsociety.org/t/moving-keys-from-link-constraint-keys-access/1575053
	(
		local arrTargetID  = #()
		moveKeys obj offset #selection  ---å…ˆç§»åŠ¨élinkå¸§
		-- if rolBsKeyTools.chkJudgeLinkKey.state == true then 
		-- (
			if classof obj.controller == Link_Constraint do
			(
				nTargets = obj.controller.getNumTargets()  ---å¾—åˆ°linkçš„å¸§æ•°é‡

				if nTargets > 0 do
				(
					--æ’åº link å¸§
					obj.controller.setFrameNo 1 (obj.controller.getFrameNo 1)

					-- for i = nTargets to 1 by -1 do  ------å¦‚æœå¤§äº0åˆ™ä»æœ€ålinkå¸§å¼€å§‹ç§»
					-- (
					-- 	fNumber = obj.controller.getFrameNo i
					-- 	if ((fNumber >= keySelFirst) and (fNumber <= keySelEnd)) then
					-- 	(
					-- 		appendIfUnique arrTargetID i
					-- 	)
					-- )
					if offset > 0 then  --------åˆ¤æ–­å‘å‰è¿˜æ˜¯å‘åç§»åŠ¨å¸§
					(
						for i = nTargets to 1 by -1 do  ------å¦‚æœå¤§äº0åˆ™ä»æœ€ålinkå¸§å¼€å§‹ç§»
						(
							fNumber = obj.controller.getFrameNo i
							obj.controller.setFrameNo i (fNumber + offset)
						)
					)
					else
					(
						for i = 1 to nTargets do  ---å¦‚æœç§»åŠ¨å¸§å°äº0,ä»ç¬¬ä¸€ä¸ªlinkå¸§å¼€å§‹ç§»
						(
							fNumber = obj.controller.getFrameNo i
							obj.controller.setFrameNo i (fNumber + offset)
						)
					)
				)
			)
		-- )
	)

	-- fn fnSplitSelBiped = --åˆ†å¼€é€‰æ‹©å››è‚¢å’Œèº«ä½“,ä¾‹å¦‚åŒä¸€æ¡æ‰‹è‡‚åªé€‰æ‹©æœ€çˆ¶çº§çš„(æ–¹ä¾¿ç§»åŠ¨å¸§)
	-- (
	-- 	arrSelBiped = for i in selection where classof i.controller == BipSlave_Control collect i 

	-- )

	fn fnMoveBipedKeys offsetFrame =  -------ç§»åŠ¨Bipedå¸§
	(
		bipedRoot = #()   -------åˆ¤æ–­é€‰æ‹©äº†å‡ ä¸ªbipedéª¨æ¶
		for i in selection where ((classof i == Biped_Object) and (i.ishidden == false)) do  
		(
			appendIfUnique bipedRoot i.controller.rootNode  --æ·»åŠ åˆ°éª¨æ¶æ•°ç»„
		)
		for c in bipedRoot do  ---æŒ‰æ¯ä¸ªéª¨æ¶å¤„ç†
		(
			ctrlBiped = c.controller
			bipedAll = #(biped.getNode ctrlBiped #pelvis, -----å››è‚¢åŒå¸§å¤„ç†,åªå¤„ç†ä»–é¦–èŠ‚biped
						biped.getNode ctrlBiped #spine,
						biped.getNode ctrlBiped #neck,
						biped.getNode ctrlBiped #larm,
						biped.getNode ctrlBiped #rarm,
						biped.getNode ctrlBiped #lleg,
						biped.getNode ctrlBiped #rleg,
						biped.getNode ctrlBiped #prop1,
						biped.getNode ctrlBiped #prop2,
						biped.getNode ctrlBiped #prop3,
						biped.getNode ctrlBiped #tail)

			vertCtrl = ctrlBiped.vertical.controller  -----è´¨å¿ƒctrlå…³é”®å¸§
			horzCtrl = ctrlBiped.horizontal.controller
			if (((sysinfo.GetMaxLanguage())[3]=="CHS") and ((maxVersion())[1] < 20000)) then 
			(turnCtrl = ctrlBiped.flip.controller)
			else(turnCtrl = ctrlBiped.turning.controller)
			bipCtrlTemp = #(vertCtrl,horzCtrl,turnCtrl)
			for c in bipCtrlTemp do
			(
				biped.moveKeys c offsetFrame #selection  -----ç§»åŠ¨é€‰å®šçš„è´¨å¿ƒå¸§
			)
			for nodeBiped in bipedAll where nodeBiped != undefined do  -----ç§»åŠ¨å…¶ä»–bipedçš„é€‰å®šå¸§
			(
				biped.moveKeys nodeBiped.controller offsetFrame #selection
			)
		)
	)		

	mapped fn fnMoveBipedScaleKeys tempObj offsetFrame =  -------ç§»åŠ¨bipedçš„ç¼©æ”¾å¸§
	(
		ctrlBiped = tempObj.controller
		if classof ctrlBiped == BipSlave_Control then  --------ä¸‹é¢åˆ¤å®šå­åŠ¨ç”»æ˜¯å¦ä¸ºscaleXYZ
		(
			if ((ctrlBiped[1][1] != undefined) and ((getSubAnimName ctrlBiped[1][1] 1) == #ScaleXYZ)) then
			(
				movekeys ctrlBiped[1][1][1] offsetFrame #selection
			)
		)
	)

	fn fnMoveAllKeys keyMovedOffset fnRange:off =
	(
		local rangEnd = animationrange.end
		local rangeStart = animationrange.start
		local n = 0  --næ¥åˆ¤å®šæ˜¯å¦æœ‰é€‰ä¸­biped

		if keyMovedOffset != undefined and keySelFirst != undefined and keySelEnd != undefined then
		(
			if selection.count != 0 then
			(
				for i in selection where (i.ishidden == false) do
				(
					if classof i != Biped_Object then
					(
						fnMoveKeysAndLinkKeys i keyMovedOffset
					)
					else 
					(
						fnMoveBipedScaleKeys i keyMovedOffset
						n += 1
					)
				)
				if n != 0 then  ----------åˆ†å¼€è§£å†³bipedå¤šç§»åŠ¨çš„é—®é¢˜,å‚»ç“œå¼æ–¹æ³•
				(
					fnMoveBipedKeys keyMovedOffset
				)
			)
			else  ---è·Ÿä¸Šé¢ä¸€æ ·,åªæ˜¯å¯¹æ‰€æœ‰ç‰©ä½“
			(
				for i in objects where (i.ishidden == false) do
				(
					if classof i != Biped_Object then
					(
						fnMoveKeysAndLinkKeys i keyMovedOffset
					)
					else fnMoveBipedScaleKeys i keyMovedOffset
				)
				fnMoveBipedKeys keyMovedOffset
			)
			if fnRange == on then
			(
				if keyMovedOffset > 0 then 
				(
					rangEnd = animationrange.end + keyMovedOffset
					animationrange = interval animationrange.start rangEnd
				)
				else if keyMovedOffset < 0 then 
				(
					rangeStart = animationrange.start + keyMovedOffset
					animationrange = interval rangeStart animationrange.end
				)
			)
			keySelFirst += keyMovedOffset
			keySelEnd  += keyMovedOffset
		)
	)

	fn fnAddTrajLayer strlayerName templayerTarget =
	(
		if (LayerManager.getLayerFromName strlayerName) != undefined then
		(
			templayerTarget = LayerManager.getLayerFromName strlayerName
		)
		else templayerTarget = LayerManager.newLayerFromName strlayerName
		templayerTarget.lock = on
		templayerTarget
	)

	fn fnAddBipedTraj tempBiped =
	(
		pointTraj = point name:("Traj_" + tempBiped.name) size:0 cross:true 
		appendIfUnique arrTraj pointTraj
		freeze pointTraj
		arrBipedSonTemp = tempBiped.children
		bipedTarget = arrBipedSonTemp[(arrBipedSonTemp.count + 1)/2]
		pointTraj.transform = bipedTarget.transform
		pointTraj.parent = tempBiped
		layerTraj.addNode pointTraj
		deleteKeys pointTraj #allKeys
		pointTraj.showTrajectory = true
		-- ResetXForm pointTraj
	)

	fn fnDeleteTraj tempBiped =
	(
		local deleteTraj
		local deleteTrajName = ("Traj_" + tempBiped.name)
		local deleteTraArrID = findItem arrTraj deleteTrajName
		if deleteTraArrID != 0 then
		(
			deleteTraj = arrTraj[deleteTraArrID]
			deleteItem arrTraj deleteTraArrID
		)
		if (getNodeByName deleteTrajName) != undefined then (delete (getNodeByName deleteTrajName))
	)

	fn fnBSQuickSave =
	(
		local strCurFilePath    = (maxFilePath + maxFileName)
		local strCurFileName    = getFilenameFile maxFileName
		local strBackupPathRoot = maxFilePath + strCurFileName + ".backup"
		local arrBackupFiles = getfiles (strBackupPathRoot + "\\*.max")
		qsort arrBackupFiles fnPseudoNaturalSort
		-- print arrBackupFiles

		if matchpattern strCurFilePath pattern:("*.backup\\*.max") then 
		(
			strBackupPathRoot = maxFilePath
			arrBackupFiles    = getfiles (strBackupPathRoot + "\\*.max")
			qsort arrBackupFiles fnPseudoNaturalSort
			strSaveFileName   = getFilenameFile arrBackupFiles[arrBackupFiles.count]
			arrEndCountFilter = (filterString strSaveFileName "_")
			strSaveCount      = ((execute arrEndCountFilter[arrEndCountFilter.count])) as string
			strSaveName       = substring strSaveFileName 1 (strSaveFileName.count - strSaveCount.count - 1)
			strSaveCount      = ((execute strSaveCount) + 1) as string
			strBackupFilePath = strBackupPathRoot + "\\" + strSaveName + "_" + strSaveCount + ".max"
			saveMaxFile strBackupFilePath
			displayTempPrompt ("å·²å¤‡ä»½å¹¶æ‰“å¼€ï¼š" + strBackupFilePath) 10000
			messagebox ("å½“å‰å¤‡ä»½çš„æ˜¯å·²å¤‡ä»½æ–‡ä»¶ï¼Œè¯·æ³¨æ„è·Ÿæºæ–‡ä»¶å¯¹æ¯”æ–°æ—§ï¼\r\n\r\nå¯èƒ½çš„æºæ–‡ä»¶ï¼š" + strSaveName + ".max\r\n\r\nåˆšæ‰å¤‡ä»½çš„æ–‡ä»¶ï¼š" + strCurFileName + ".max                                                                           ") title:"BsKeyTools"
		) 
		else
		(
			if (not (SIODir.Exists strBackupPathRoot))
			do (SIODir.CreateDirectory strBackupPathRoot)
			if arrBackupFiles.count == 0 then 
			(
				strSaveCount = "1"
			) 
			else if arrBackupFiles.count > 0 then
			(
				strSaveFileName   = getFilenameFile arrBackupFiles[arrBackupFiles.count]
				arrEndCountFilter = (filterString strSaveFileName "_")
				strSaveCount      = ((execute arrEndCountFilter[arrEndCountFilter.count]) + 1) as string
			)
			strBackupFilePath = strBackupPathRoot + "\\" + strCurFileName + "_" + strSaveCount + ".max"
			-- saveMaxFile strCurFilePath
			if (not (SIOFile.Exists strBackupFilePath)) do
			(
				try 
				(
					-- SIOFile.Copy strCurFilePath strBackupFilePath
					-- FileIO.Copyfile strCurFilePath strBackupFilePath UIOption
					saveMaxFile strBackupFilePath clearNeedSaveFlag:false useNewFile:false
					displayTempPrompt ("å·²å¤‡ä»½è‡³ï¼š" + strBackupFilePath) 10000 
				)
				catch()
			)
		)
	)

	fn fnCutDisplayKeyRange keyFirst keyEnd isSelected:false =  ---æ˜¾ç¤ºé¦–å°¾å¸§èŒƒå›´
	(
		if ((keyFirst != undefined) and (keyEnd != undefined)) then
		(
			if (arrKeysTime.count != 0) then
			(
				if not isSelected then
				(
					if (arrLinkKeys.count != 0) then
					(
						case of  ------ä¸‡æ¶çš„linkå¸§å¯¼è‡´æ›´å¤šåˆ¤å®š
						(
							((arrLinkKeys[1].time >= keyFirst) and (arrLinkKeys[arrLinkKeys.count].time <= keyEnd)):
							(animationrange = (interval keyFirst keyEnd))
							((arrLinkKeys[1].time < keyFirst) and (arrLinkKeys[arrLinkKeys.count].time <= keyEnd)):
							(animationrange = (interval arrLinkKeys[1].time keyEnd))
							((arrLinkKeys[1].time < keyFirst) and (arrLinkKeys[arrLinkKeys.count].time >= keyEnd)):
							(animationrange = (interval arrLinkKeys[1].time arrLinkKeys[arrLinkKeys.count].time))
							((arrLinkKeys[1].time >= keyFirst) and (arrLinkKeys[arrLinkKeys.count].time > keyEnd)):
							(animationrange = (interval keyFirst arrLinkKeys[arrLinkKeys.count].time))
							((arrLinkKeys[1].time < keyFirst) and (arrLinkKeys[arrLinkKeys.count].time > keyEnd)):
							(animationrange = (interval arrLinkKeys[1].time arrLinkKeys[arrLinkKeys.count].time))
						)
					)
					else
					(
						animationrange = interval keyFirst keyEnd
					)
				)
				else animationrange = interval keyFirst keyEnd
			)
			else 
			(
				if ((arrLinkKeys.count != 0) and (arrLinkKeys.count > 1)) then 
				(
					animationrange = (interval arrLinkKeys[1].time arrLinkKeys[arrLinkKeys.count].time)
				)
				else 
				(
					if (arrLinkKeys.count == 1) then
					(
						animationrange = (interval arrLinkKeys[1].time (arrLinkKeys[1].time + 1))
					)
				)
			)
		)
	)

	fn fnGetPlaySpeedValue =
	(
		case of
		(
			(timeConfiguration.playbackSpeed == 1):(return 0.25)
			(timeConfiguration.playbackSpeed == 2):(return 0.5)
			(timeConfiguration.playbackSpeed == 3):(return 1)
			(timeConfiguration.playbackSpeed == 4):(return 2)
			(timeConfiguration.playbackSpeed == 5):(return 4)
		)
	)

	-- https://cafe.naver.com/pinksox/6131
	-- ä¼˜åŒ–æ”¯æŒ bone

	fn FramToMilisecond frame = 
	(
		return ((((frame - animationRange.start) as integer) * (10.0 / 48.0) * fnGetPlaySpeedValue()) as integer)
    )

	fn AppendKeyTimeArray m_PBKeyMiliSecArray keys = 
	(
        if keys.count == 0 do return()
        for i = 1 to keys.count do (
            if (keys[i] >= animationRange.start) AND (keys[i] <= animationRange.end) do (
                appendifUnique m_PBKeyMiliSecArray (FramToMilisecond keys[i])
                appendifUnique m_PBKeyTimeArray keys[i]
            )
        )
        appendifUnique m_PBKeyMiliSecArray (FramToMilisecond animationRange.start)
        appendifUnique m_PBKeyTimeArray animationRange.start
        appendifUnique m_PBKeyMiliSecArray (FramToMilisecond animationRange.end)
        appendifUnique m_PBKeyTimeArray animationRange.end
	)

	fn StopBlocking = 
	(
        clock.active = false
        ckbPlayBlocking.state = false
        ckbPlayBlocking.text = "è·³å¸§æ’­"
	)

	fn PlayBlocking = 
	(
		fnCollectKeys ()
		m_PBKeyTimeArray = #()
		m_PBKeyMiliSecArray = #()
		local nowTime = timeStamp()
		AppendKeyTimeArray m_PBKeyMiliSecArray arrBlockingKeys
		if m_PBKeyMiliSecArray.count == 0 do (
			StopBlocking()
			return()
		)
		
		if (isAnimPlaying()) do (
			stopAnimation()
		)		
		
		sort m_PBKeyTimeArray
		sort m_PBKeyMiliSecArray
		m_PBPointer = 1
		while (m_PBKeyTimeArray[m_PBPointer] < sliderTime) do (m_PBPointer += 1)

		m_PBStartTime = timeStamp() - (FramToMilisecond sliderTime)
		sliderTime = m_PBKeyTimeArray[m_PBPointer]
		clock.active = true
		ckbPlayBlocking.text = "åœæ­¢!"
	)

	fn ReplayBlocking = 
	(
		m_PBPointer = 1
		m_PBStartTime = timeStamp()
		sliderTime = m_PBKeyTimeArray[m_PBPointer]
	)

	fn fnGetAllBipedTwist =
	(
		arrBipedRootAll = $'Bip00?'
		arrBipedTwistAll = #()
		for r in arrBipedRootAll do
		(
			nn = biped.maxTwistNodes r
			nl = biped.maxTwistLinks r
			ts = biped.getTwistStartId r
			
			for i = ts to ts+nn-1 do
			(
				anode = biped.getNode r i
				if anode != undefined do
				(
				for j = 1 to nl do
					(
						alink = biped.getNode r i link:j
						if alink != undefined do
						(
							appendIfUnique arrBipedTwistAll alink
						)
					)
				)
			)
		)
		for j in arrBipedTwistAll where j != undefined do
		(
			j.isHidden = not (j.isHidden)
		)
	)

	fn fnOrthoToPersp =
	(
		--DON'T CONVERT VIEWPORT IF ORBITING / PANNING
		mouseControl = (dotNetClass "Control")
		mouseDown = dotnet.CompareEnums mouseControl.MouseButtons.value__ mouseControl.MouseButtons.Middle.value__
		
		if not mouseDown and viewport.getType() == #view_iso_user do
		(
			viewport.setType #view_persp_user
			ForceCompleteRedraw()
		)
	)

	on rolBsKeyTools open do  ----æ‰“å¼€è„šæœ¬æ—¶æ“ä½œ
	(
		-- panelMyTools.backcolor = BsDotBackColor
		-- panelMyTools.autoScroll = true
		-- fnAddDotButton()
		arrNewCostTime 		= iniCostTime
		lblLink.font        = BsDotFont
		lblLink.backcolor   = BsDotBackColor
		lblLink.forecolor   = BsDotForeColor
		fnSwitchToolBtnName()
		fnSetBtnPrimogem()
		------åˆ·æ–°å›¾æ ‡, å›¾æ ‡æ˜¯maxè‡ªå¸¦çš„,ä¸»è¦æ˜¯æ‡’å¾—åš
		btnSelBeforeKeys.images = #("VCRControls_24i.bmp","VCRControls_24i.bmp",28,3,3,3,3,true,true) 
		btnSelAfterKeys.images = #("VCRControls_24i.bmp","VCRControls_24i.bmp",28,11,11,11,11,true,true) 
		btnSelAllKeys.images = #("VCRControls_24i.bmp","VCRControls_24i.bmp",28,26,26,26,26,true,true)
		-- btnMoveKeys.images = #("VCRControls_24i.bmp","VCRControls_24i.bmp",28,21,21,21,21,true,true)
		-- btnMoveAfterKeys.images = #("VCRControls_24i.bmp","VCRControls_24i.bmp",28,13,13,13,13,true,true)
		-- dotnet.AddEventHandler myTimer #elapsed fnRefreshHelpText
		-- myTimer.Start()
		-- timeDIsTemp      = timeDisplayMode  ----å°æ•°å¸§è¿˜æ˜¯æ•´æ•°å¸§
		-- iniPos = (GetDialogPos rolBsKeyTools) 
		stLoadConfigAll.fnLoadConfigBsKeyToolsAll ()  ---------------è„šæœ¬ä½ç½®èµ‹å€¼
		stSetConfigAll.fnSetConfigBsKeyTools ()  ----------------ä¿å­˜ä½ç½®ä¿¡æ¯åˆ°iniæ–‡ä»¶
		fnReloadToolsBtn()
		-- if(switchMSPanel == 0) then (ckbSwitchMyScripts.checked = false)
		-- else (ckbSwitchMyScripts.checked = true)
		fnRefPlaySpeedValue ()  -----åˆ¤æ–­æ’­æ”¾é€Ÿåº¦
		fnBsRefFps ()
		-- fnRefreshMsPanel ()
		-- if (switchToolPanel == 1) then
		-- (
		-- )
		ckbIsoSelection.state = IsolateSelection.IsolateSelectionModeActive()
		ckbPlayBlocking.state = false
		clock.active = false
		ckbPerspLock.state = tooglePersp
		fnRefreshRecentFileList()
		menuConfig.fnLoadDockPos rolBsKeyTools widthBsSize heightBsSize
		fnSwitchToolsBtn idBtn
		fnSwitchToolBtnChecked idBtn
		if not rolBsKeyTools.dialogBar then fnRefreshMagicBtn ()
		if iniIsIcon do fnSwitchIconStyle()
		if (iniBsAutoCheckUpdate == true) then 
		(fnAutoCheckVersion curVerBsKeyTools verUrlBsKeyTools dlUrlBsKeyTools dlFileBsKeyTools)
		if iniCollopseType == 1 or iniCollopseType == 2 then
		(
			tempTogglePanelPos = (getDialogPos rolBsKeyTools)
			SetINISetting BulletConfig "BsTogglePanelSet"  "TogglePanelPos" (tempTogglePanelPos as string)
			rolBsKeyTools.height = 0
			try(fileIn ((getDir #Scripts)+ @"\\BulletScripts\\BsTogglePanel.ms"))
			catch(messagebox "æ‰“å¼€BsKeyToolså¤±è´¥,\r\nå»ºè®®é‡å¯Maxæˆ–é‡æ–°å®‰è£…...          ")
		)
		-- print ("iniBsAutoCheckUpdate: " + iniBsAutoCheckUpdate as string)
	)
	
	on rolBsKeyTools close do -- å…³é—­è®°å¿†æµ®åŠ¨çª—å£ä½ç½®
	(
		iniPos = (GetDialogPos rolBsKeyTools)
		stSetConfigAll.fnSetConfigBsKeyTools ()
		try (callbacks.removeScripts #animationRangeChange id:#BsUpdateTimeRange) catch ()
		try (callbacks.removeScripts #filePostOpen id:#BsUpdateFps) catch ()
		try (callbacks.removeScripts #timeunitsChange id:#BsUpdateFps) catch ()
		try (callbacks.removeScripts #filePostOpen id:#BsUpdatePlaySpeed) catch ()
		try (callbacks.removeScripts #timeunitsChange id:#BsUpdatePlaySpeed) catch ()
		try (callbacks.removeScripts #filePostOpen id:#BsRefreshRecentFiles) catch ()
		try(destroydialog rolTogglePanel)catch()
		unRegisterRedrawViewsCallback fnOrthoToPersp
		tooglePersp = false
	)
	-----------------------------------------------------------------------------------------
	on rolBsKeyTools rbuttondown pos do 
	(
		popupMenu menuConfig pos:(GetDialogPos rolBsKeyTools)
	)

	on btnConfig changed state do 
	(
		btnConfig.state = true
		popupMenu menuConfig pos:(GetDialogPos rolBsKeyTools)
	)

	on btnConfig rightclick do 
	(
		btnConfig.state = true
		popupMenu menuConfig pos:(GetDialogPos rolBsKeyTools)
	)

	-- on rolBsKeyTools mbuttondown pos do 
	-- (
	-- 	try(cui.UnRegisterDialogBar rolBsKeyTools) catch()
	-- 	try (destroydialog rolBsKeyTools) catch ()
	-- )
	
	on rolBsKeyTools lbuttondown posMou do
	(
		setSysCur #move
		posMouMoved = posMou
		switchMouseState = on
	)
	
	on rolBsKeyTools lbuttonup posMou do
	(
		switchMouseState = off
		iniPos = (GetDialogPos rolBsKeyTools)
		stSetConfigAll.fnSetConfigBsKeyTools()
	)
	
	on rolBsKeyTools mouseMove pos do
	(
		if not rolBsKeyTools.dialogBar then
		(
			-- myTimer.Start()
			if (ui_clientOffset == undefined) and (switchMouseState == off) then 
			(ui_clientOffset = pos - (mouse.screenPos - (getDialogPos rolBsKeyTools)))
			if switchMouseState == on then
			(
				SetDialogPos rolBsKeyTools (mouse.screenpos - posMouMoved)
			)
		)
	)

	on timerTickTock tick do 
    (
        if (ui_clientOffset != undefined) and (iniCollopseType == 1 or iniCollopseType == 2) then 
		(
            local mouseClientPos = mouse.screenPos - (getDialogPos rolBsKeyTools) + ui_clientOffset
            
            local dialogPos = getDialogPos rolBsKeyTools
            local dialogBox = 
			(if switchToolPanel == 1 then (Box2 (dialogPos.x - 30) (dialogPos.y - 30) (rolBsKeyTools.width + 60) (rolBsKeyTools.height + 60))
			else (Box2 (dialogPos.x - 30) (dialogPos.y - 30) (rolBsKeyTools.width + 360)  (rolBsKeyTools.height + 60)))

			if not (contains dialogBox mouse.screenPos) then
			(
				if rolTogglePanel == undefined or rolTogglePanel.open == false then 
				(
					SetINISetting BulletConfig "BsTogglePanelSet"  "TogglePanelPos" ((getDialogPos rolBsKeyTools) as string)
					rolBsKeyTools.height = 0
					try(fileIn ((getDir #Scripts)+ @"\\BulletScripts\\BsTogglePanel.ms"))
					catch(messagebox "æ‰“å¼€BsKeyToolså¤±è´¥,\r\nå»ºè®®é‡å¯Maxæˆ–é‡æ–°å®‰è£…...          ")
				)
				else 
				(
					rolTogglePanel.timerTickTock.active = true
					SetDialogPos rolTogglePanel (getDialogPos rolBsKeyTools)
					if iniCollopseType == 1 then 
					(
						rolTogglePanel.height = 30
						rolTogglePanel.width  = 355
					) 
					else 
					(
						rolTogglePanel.height = 100
						rolTogglePanel.width  = 355
					)
					rolTogglePanel.lblOneWord.height = (rolTogglePanel.height - 4)
					rolTogglePanel.lblOneWord.width  = (rolTogglePanel.width - 4)
					rolBsKeyTools.height = 0
				)
					-- isMouseInBsKeyTools = true
				rolBsKeyTools.timerTickTock.active = false
			)
			else (if rolTogglePanel != undefined then (rolTogglePanel.timerTickTock.active = false))
        )
    )
	---------------------ä¸Šé¢è®¾ç½®æ‹–åŠ¨è„šæœ¬çª—å£,å»æ‰æ ‡é¢˜æ åé»˜è®¤æ— æ³•æ‹–åŠ¨---------------------
	on btnSelBiped pressed do ----é€‰æ‹©biped
	(
		-- for o in objects where (o.ishidden == false) do 
		-- (
		-- 	if classof o == Biped_Object then selectmore o
		-- 	-- if (matchpattern o.name pattern:"*Bip*") then selectmore o
		-- )
		if ((selection.count == 1) and (classof $ == Biped_Object) and ($.ishidden == false)) then 
		(
			local tempSel = $
			execute ("select $'" + tempSel.controller.rootNode.name + "*'")
			execute ("deselect $'" + tempSel.controller.rootNode.name + "*Footsteps'")
		)
		else 
		(
			select $'Bip*'
			deselect $'Bip*Footsteps'
		)
	)

	on btnSelBone pressed do ----é€‰æ‹©bone
	(
		clearselection ()
		for o in objects where (o.ishidden == false) do 
		(
			if classof o == BoneGeometry then selectmore o
		)
	)

	on spiStartTime changed valTime do  --------åˆå§‹å¸§å®šä½åˆ°è¾“å…¥çš„å¸§æ•°
	(		
		local rangeStart = valTime as time
		if ((valTime != ".") and (valTime as time != undefined) and \
		(valTime != "")) then
		(
			if (rangeStart < animationrange.end) then 
			(animationrange = (interval rangeStart animationrange.end))
			else (animationrange = (interval rangeStart (rangeStart + 60)))
		)
		else messageBox "----------------------\r\nè¯·è¾“å…¥æ­£ç¡®å¸§æ•°!"
	)

	on spiEndTime changed valTime do  --------åˆå§‹å¸§å®šä½åˆ°è¾“å…¥çš„å¸§æ•°
	(		
		local rangEnd = valTime as time
		if ((valTime != ".") and (valTime as time != undefined) and \ 
		(valTime != "")) then
		(
			if (rangEnd > animationrange.start) then
			(animationrange = (interval animationrange.start rangEnd))
			else (animationrange = (interval (rangEnd - 60) rangEnd))
		)
		else messageBox "----------------------\r\nè¯·è¾“å…¥æ­£ç¡®å¸§æ•°!"
	)
	
	on btnFnFrame pressed do  -------------åˆ‡æ¢æ•´æ•°å¸§å°æ•°å¸§,æ–¹ä¾¿æ‹–åŠ¨æ»‘æ¡å¹³æ»‘é¢„è§ˆ
	(
		if timeDisplayMode != #frameTicks then 
		(
			timeDisplayMode = #frameTicks
		)
		else 
		(
			timeDisplayMode = #frames
		)
		-- slidertime -= 1
		-- slidertime += 1  ----------é»˜è®¤æ”¹äº†è¦åˆ’ä¸€ä¸‹æ»‘æ¡æ‰ç”Ÿæ•ˆ,è„šæœ¬ç›´æ¥æ“ä½œäº†~~æ²¡æ‰¾åˆ°refreshçš„
		disableSceneRedraw()
		trackbar.visible = false
		trackbar.visible = true
		enableSceneRedraw()
	)
	
	on btnMagicBtn pressed do  -------------åˆ‡æ¢æ•´æ•°å¸§å°æ•°å¸§,æ–¹ä¾¿æ‹–åŠ¨æ»‘æ¡å¹³æ»‘é¢„è§ˆ
	(
		setfocus rolbskeytools.btnPrimogem
		fnSwitchMagicBtn switchToolPanel
		-- fnRefreshMsPanel()
	)

	on ckbPlayBlocking changed state do (
        -- if (selection.count == 0) do (
        --     StopBlocking()
        --     return()
        -- )
		if state then (
            PlayBlocking()
        )
        else (
            StopBlocking()
        )
    )
    
    -- Play Blockingìš© í‹± ì´ë²¤íŠ¸ ì²˜ë¦¬
    on clock tick do (
        if (m_PBPointer > m_PBKeyMiliSecArray.count) do return()
		local now = timeStamp()
		local pointer
		if (m_PBKeyMiliSecArray.count == m_PBPointer) then (
			ReplayBlocking()
			pointer = 1
		)
		else (
			pointer = m_PBStartTime + m_PBKeyMiliSecArray[m_PBPointer + 1]
		)
        
        if ( now > pointer ) do (
            m_PBPointer += 1
            sliderTime = m_PBKeyTimeArray[m_PBPointer]
        )
        
        if (m_PBPointer >= m_PBKeyMiliSecArray.count) do (
            ReplayBlocking()
        )

        if keyboard.escPressed do (
            StopBlocking()
		)
		
		if (sliderTime != m_PBKeyTimeArray[m_PBPointer]) do (
			StopBlocking()
		)
    )

	on btnCSTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts" + "\\BsBipedTools.ms"))
		catch(messagebox "æ‰“å¼€ BsBipedTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnCSTools rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\cstools.ms"))
		catch(messagebox "æ‰“å¼€ cstools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)
	on btnSpringMagic pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\SpringMagic_Enhanced.ms"))
		catch(messagebox "æ‰“å¼€ SpringMagic_Enhanced.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)
	on btnSpringMagic rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\SpringMagic_Old.mse"))
		catch(messagebox "æ‰“å¼€ SpringMagic_Old.mse å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnFileOpen pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts" + "\\BsOpenTools.ms"))
		catch(messagebox "æ‰“å¼€ BsOpenTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on ckbIsoMesh changed state do
	(
		if state then
		(
			hideByCategory.geometry = false
			hideByCategory.shapes = true
			-- hideByCategory.lights = true
			-- hideByCategory.cameras = true
			hideByCategory.helpers = true
			-- hideByCategory.spacewarps = true
			-- hideByCategory.particles = true
			hideByCategory.bones = true
		)
		else 
		(
			hideByCategory.shapes = false
			-- hideByCategory.lights = false
			-- hideByCategory.cameras = false
			hideByCategory.helpers = false
			-- hideByCategory.spacewarps = false
			-- hideByCategory.particles = false
			hideByCategory.bones = false
		)
	)
	on btnProTraj pressed do 
	(
		-- layerTraj = (fnAddTrajLayer "Biped_Trajectories" layerTraj) ----æ˜¯å¦åˆ›å»ºè½¨è¿¹å±‚
		-- if (selection.count > 1) then
		-- (
		-- 	for i in (selection as array) do
		-- 	(
		-- 		if classof i == Biped_Object then
		-- 		(
		-- 			if (getNodeByName ("Traj_" + i.name)) != undefined then 
		-- 			(
		-- 				fnDeleteTraj i
		-- 			)
		-- 		)
		-- 	)
		-- )
		-- else if selection.count == 1 then
		-- (
		-- 	if classof $ == Biped_Object then
		-- 		(
		-- 			if (getNodeByName ("Traj_" + $.name)) != undefined then 
		-- 			(
		-- 				fnDeleteTraj $
		-- 			)
		-- 			else fnAddBipedTraj $
		-- 		)
		-- )
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\ProTrajectoryHandles.ms"))
		catch(messagebox "æ‰“å¼€ ProTrajectoryHandles.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnProTraj rightclick do
	(
		actionMan.executeAction 0 "276"  -- Tools: Show Trajectories Toggle
	)

	-- on btnProTraj rightclick do
	-- (
	-- 	-- bipedRoot = #()   -------åˆ¤æ–­é€‰æ‹©äº†å‡ ä¸ªbipedéª¨æ¶
	-- 	if (selection.count > 0) then
	-- 	(
	-- 		-- for i in (selection as array) where classof i == Biped_Object do  
	-- 		-- (
	-- 		-- 	appendIfUnique bipedRoot i.controller.rootNode  --æ·»åŠ åˆ°éª¨æ¶æ•°ç»„
	-- 		-- )
	-- 		for i in (selection as array) do 
	-- 		(
	-- 			if (classof i == Biped_Object) then
	-- 			(
	-- 				nodeTemp = i.controller.rootNode
	-- 				trajDisFn = nodeTemp.controller.displayTrajectories
	-- 				if trajDisFn == true then nodeTemp.controller.displayTrajectories = false
	-- 				else nodeTemp.controller.displayTrajectories = true
	-- 				exit
	-- 			)
	-- 		)
	-- 	)
	-- )

	on edtMoveKey entered val do   -----ç§»åŠ¨å¸§æ•°è‡ªå®šä¹‰,è¾“å…¥å³å¯
	(
		if ((val != ".") and (val as time != undefined) and (val != "")) then
		(------"."ä»–ä¹Ÿè®¤ä¸ºæ˜¯æ•°å­—...
			keyMovedOffset = val as integer
			rolBsKeyTools.edtMoveKey.text = keyMovedOffset as string + "f"
		)
		else (print "[BskeyTools] warning: è¯·è¾“å…¥æ­£ç¡®ç§»åŠ¨å¸§æ•°!";edtMoveKey.text = "5f")
	)

	on btnSet5 pressed do 
	(
		edtMoveKey.text = "5f"
		keyMovedOffset = 5
	)

	on btnSet5 rightclick do 
	(
		edtMoveKey.text = "-5f"
		keyMovedOffset = -5
	)

	on btnSetAdd pressed do 
	(
		keyMovedOffset += 5
		edtMoveKey.text = keyMovedOffset as string + "f"
	)

	on btnSetAdd rightclick do 
	(
		keyMovedOffset -= 5
		edtMoveKey.text = keyMovedOffset as string + "f"
	)
	-- on btnSetOpposite pressed do
	-- (
	-- 	keyMovedOffset = - keyMovedOffset
	-- 	edtMoveKey.text = keyMovedOffset as string + "f"
	-- )
	on btnMoveKeys pressed do with undo on   ------ç§»åŠ¨é€‰å®šå¸§
	(
		if (selection as array).count == 0 then select objects
		if arrKeysSelected.count == 0 then (btnSelAllKeys.pressed())
		fnCollectKeys ()
		fnMoveAllKeys keyMovedOffset fnRange:off
	)
	on btnMoveKeys rightclick do with undo on
	(
		if (selection as array).count == 0 then select objects
		if arrKeysSelected.count == 0 then (btnSelAllKeys.pressed())
		fnCollectKeys ()
		fnMoveAllKeys keyMovedOffset fnRange:on
	)
	on btnSelBeforeKeys pressed do  ------------é€‰æ‹©æ»‘æ¡ä¹‹å‰å¸§
	(
		symbol = 0
		fnCollectKeys ()
		if arrLinkKeys.count != 0 then
		(
			for i in arrLinkKeys do i.selected = false
		)
		if arrKeysTime.count != 0 then
		(
			if keyFirst <= sliderTime then 
			(
				fnSelKeys keyFirst sliderTime symbol
			)
			else 
			(
				fnSelKeys sliderTime sliderTime symbol
			)
		)
		else
		(
			if arrLinkKeys.count != 0 then
			(
				if arrLinkKeys[1].time <= sliderTime then 
				(
					fnSelLinkKeys arrLinkKeys[1].time sliderTime symbol
				)
				else 
				(
					fnSelLinkKeys sliderTime sliderTime symbol
				)
			)
		)
	)
	
	on btnSelAfterKeys pressed do  -------------é€‰æ‹©æ»‘æ¡ä¹‹åå¸§
	(
		symbol = 1
		fnCollectKeys ()
		if arrKeysTime.count != 0 then
		(
			if arrLinkKeys.count != 0 then
			(
				for i in arrLinkKeys do i.selected = false
			)
			if keyEnd >= sliderTime then 
			(
				fnSelKeys sliderTime keyEnd symbol
			)
			else 
			(
				fnSelKeys sliderTime sliderTime symbol
			)
		)
		else
		(
			if arrLinkKeys.count != 0 then
			(
				if arrLinkKeys[1].time >= sliderTime then 
				(
					fnSelLinkKeys sliderTime arrLinkKeys[1].time symbol
				)
				else 
				(
					fnSelLinkKeys sliderTime sliderTime symbol
				)
			)
		)
	)
	
	on btnSelAllKeys pressed do     ------------------é€‰æ‹©æ‰€æœ‰å¸§
	(
		symbol = 2
		fnCollectKeys ()
		if arrKeysTime.count != 0 then
		(
			fnSelKeys keyFirst keyEnd symbol
		)
		else
		(
			if arrLinkKeys.count != 0 then
			(
				fnSelLinkKeys arrLinkKeys[1].time arrLinkKeys[arrLinkKeys.count].time symbol
			)
		)
	)
	
	on btnSetFps pressed do (popupMenu menuSetFps pos:[mouse.screenpos.x - 120,mouse.screenpos.y - 120])
		
	on btnSetSpeed pressed do (popupMenu menuSetSpeed pos:[mouse.screenpos.x,mouse.screenpos.y - 160])

	-- on chkJudgeLinkKey changed state do   --åˆ‡æ¢æ˜¯å¦å‹¾é€‰link
	-- (
	-- 	if chkJudgeLinkKey.state == false then
	-- 	(
	-- 		if arrLinkKeys.count != 0 then
	-- 		(
	-- 			for i in arrLinkKeys do i.selected = false
	-- 		)
	-- 	)
	-- 	else 
	-- 	(
	-- 		fnCollectKeys ()
	-- 		(messagebox "æ— æ³•ç§»åŠ¨é€‰å®š Link å¸§ï¼Œ\r\n\r\nåªèƒ½å…¨å±€ç§»åŠ¨ï¼Œ\r\n\r\nå…¶ä»–åŠŸèƒ½æ­£å¸¸ç”Ÿæ•ˆï¼Œ\r\n\r\nåæ­£ Link ä¹Ÿå¾ˆå‘è¿˜è¦é‡æ–°è°ƒæ•´ä½ è¯´æ˜¯å§~                            " title:"BsKeyTools" beep:false)
	-- 	)
	-- )

	on btnCleanOutKeys pressed do with undo on  -----------æ¸…ç†èŒƒå›´å¤–å¸§(æ— é™å¸§)
	(
		if (queryBox "æ˜¯å¦æ¸…é™¤èŒƒå›´å¤–å…³é”®å¸§ï¼Ÿ\r\n( Link å¸§è¯·æ‰‹åŠ¨åˆ é™¤ )    " \
		title:"æ˜¯å¦æ¸…é™¤èŒƒå›´å¤–å…³é”®å¸§ï¼Ÿ" beep:false) then
		(
			if (selection as array).count == 0 then 
			(
				for tempObject in (objects as Array) do fnCleanOutRangeKeys tempObject
			)
			else
			(
				for tempObject in (selection as Array) do fnCleanOutRangeKeys tempObject
			)
			messagebox "æ¸…ç†æˆåŠŸï¼    " beep:false
		)
	)

	on btnDelOutKeys pressed do with undo on --æ¸…ç†é€‰æ‹©å¸§
	(
		if (queryBox "æ˜¯å¦æ¸…é™¤æ‰€æœ‰å…³é”®å¸§ï¼Ÿ\r\n\r\næœ‰é€‰æ‹©ç‰©ä½“åˆ™åˆ é€‰æ‹©ç‰©ä½“çš„å¸§ï¼Œ\r\n\r\nå¦åˆ™åˆ æ‰€æœ‰ç‰©ä½“çš„å…³é”®å¸§ã€‚\r\n\r\n(è¯·æ³¨æ„ä¿å­˜ Skin Pose å’Œå¤‡ä»½æ–‡ä»¶ï¼)                                " \
		title:"æ˜¯å¦æ¸…é™¤æ‰€æœ‰å…³é”®å¸§" beep:false) then
		(
			-- max select all  -- Selection: Select All
			-- fnCollectKeys ()
			-- fnSelKeys keyFirst keyEnd 2
			-- fnDelSelKeys ()
			-- if arrLinkKeys.count != 0 then (
			-- 	fnSelLinkKeys arrLinkKeys[1].time arrLinkKeys[arrLinkKeys.count].time 2
			-- )
			if selection.count == 0 then
			(
				max select all
				maxops.deleteSelectedAnimation()
			)
			else (maxops.deleteSelectedAnimation())
		)
	)

	on btnBoxMan pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts" + "\\BsBoxMan.ms"))
		catch(messagebox "æ‰“å¼€ BsBoxMan.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on ckbHideBones changed state do
	(
		if state == false then
		(
			for o in geometry as array where (classof o == BoneGeometry and o.layer.ishidden != true) do o.isHidden = false
			rolBsKeyTools.ckbHideBones.text = "éšBone"
		)
		else
		(
			arrHiddenBones = #()
			for o in geometry as array where (classof o == BoneGeometry) do o.isHidden = true
			rolBsKeyTools.ckbHideBones.text = "æ˜¾Bone"
		)
	)
	
	on ckbHideBiped changed state do
	(
		if state == false then
		(
			for o in geometry as array where (classof o == Biped_Object and o.layer.ishidden != true) do o.isHidden = false
			rolBsKeyTools.ckbHideBiped.text = "éšBiped"
		)
		else
		(
			arrHiddenBones = #()
			for o in geometry as array where (classof o == Biped_Object) do o.isHidden = true
			rolBsKeyTools.ckbHideBiped.text = "æ˜¾Biped"
		)
	)

	on ckbFreezeMesh changed state do 
	(
		if state == on then
		(
			rolBsKeyTools.ckbFreezeMesh.text = "è§£æ¨¡å‹"
			for o in objects where (((classof o == Editable_mesh) \
			or (classof o == Editable_Poly) or (classof o == PolyMeshObject) or (classof o == Plane) or (classof o == Box)) \
			and (o.isHidden == false)) do
			(
				freeze o
				o.showFrozenInGray = off
			)
		)
		else
		(
			rolBsKeyTools.ckbFreezeMesh.text = "å†»æ¨¡å‹"
			for o in objects where (((classof o == Editable_mesh) \
			or (classof o == Editable_Poly) or (classof o == PolyMeshObject) or (classof o == Plane) or (classof o == Box)) \
			and (o.isHidden == false)) do
			(
				unfreeze o
				o.showFrozenInGray = off
			)
		)
	)

	on btnQuicksave pressed do 
	(
		if maxFilePath == "" then 
		(
			messagebox "------------------------------------\r\n\r\nå½“å‰åœºæ™¯æœªä¿å­˜è¿‡,\r\n\r\nè¯·å…ˆä¿å­˜åˆå§‹ç‰ˆæœ¬~\r\n\r\n------------------------------------"
			max file saveas
		)
		else fnBSQuickSave ()
	)

	on btnQuicksave rightclick do 
	(
		if matchpattern (maxFilePath + maxFileName) pattern:("*.backup\\*.max") then 
		(
			try(shellLaunch maxfilepath "")catch()
		)
		else
		(
			try(shellLaunch (maxfilepath + (getFilenameFile maxFileName) + ".backup") "")catch()
		)
	)

	on btnCutFrameDisplay pressed do with undo on  ---------------å¸§æ æ˜¾ç¤ºé€‰å®šå¸§èŒƒå›´
	(
		if switchSelKeyRange == 0 then
		(
			fnCollectKeys ()
			arrLastSelRange = #(animationrange.start,animationrange.end)
			fnCutDisplayKeyRange keySelFirst keySelEnd isSelected:true
			switchSelKeyRange = 1
		)
		else 
		(
			animationrange = interval arrLastSelRange[1] arrLastSelRange[2]
			switchSelKeyRange = 0
			arrLastSelRange = #()
		)
	)
	on btnAllFrameDisplay pressed do with undo on  ---------------å¸§æ æ˜¾ç¤ºé¦–å°¾å¸§èŒƒå›´
	(
		if switchAllKeyRange == 0 then
		(
			fnCollectKeys ()
			arrLastAllRange = #(animationrange.start,animationrange.end)
			fnCutDisplayKeyRange keyFirst keyEnd isSelected:false
			switchAllKeyRange = 1
		)
		else 
		(
			animationrange = interval arrLastAllRange[1] arrLastAllRange[2]
			switchAllKeyRange = 0
			arrLastAllRange = #()
		)
	)

	-- on btnZeroFrameDisplay pressed do with undo on  ---------------å¸§æ æ˜¾ç¤º0å¸§
	-- (
	-- 	animationrange = interval 0f animationrange.end
	-- )

	------------åˆ‡æ¢å·¥å…·æ åˆ†ç±»--------------------------------------------
	on ckbC1 changed state do 
	(
		setfocus rolbskeytools.btnPrimogem
		if state == true then 
		(
			fnSwitchToolBtnChecked 1
			fnSwitchToolsBtn 1
		)
		else ckbC1.checked = true
	)
	on ckbC2 changed state do 
	(
		setfocus rolbskeytools.btnPrimogem
		if state == true then 
		(
			fnSwitchToolBtnChecked 2
			fnSwitchToolsBtn 2
		)
		else ckbC2.checked = true
	)
	on ckbC3 changed state do 
	(
		setfocus rolbskeytools.btnPrimogem
		if state == true then 
		(
			fnSwitchToolBtnChecked 3
			fnSwitchToolsBtn 3
		)
		else ckbC3.checked = true
	)
	on ckbC4 changed state do 
	(
		setfocus rolbskeytools.btnPrimogem
		if state == true then 
		(
			fnSwitchToolBtnChecked 4
			fnSwitchToolsBtn 4
		)
		else ckbC4.checked = true
	)
	-- on ckbSwitchMyScripts changed state do 
	-- (
	-- 	if state then switchMSPanel = 1 else switchMSPanel = 0
	-- 	fnRefreshMsPanel()
	-- )
	--------------------------------------------------------------------

	on btnFnTCB pressed do 
	(
		for i in selection where classof i == BoneGeometry do
		(
			if classof i.rotation.controller == tcb_rotation then
				(i.rotation.controller = Euler_XYZ ())
				else (i.rotation.controller = tcb_rotation ())
		)
	)

	on btnImageComp pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\ImageCompHelper.ms"))
		catch(messagebox "æ‰“å¼€ ImageCompHelper.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)
	
	on btnFnKeyType pressed do 
	(
		try(destroydialog rolFnKeys)catch()
		Createdialog rolFnKeys  fgcolor:myFgColor \
		pos:[mouse.screenpos.x,mouse.screenpos.y]
	)

	on btnEulerFilter pressed do 
	(
		for i in selection where classof i == BoneGeometry do
		(
			if classof i.rotation.controller == Euler_XYZ then
			(
				i.rotation.controller = tcb_rotation ()
				i.rotation.controller = Euler_XYZ ()
			)
		)
	)

	on ckbFnBoxDisplay changed state do 
	(
		if state == on then ckbFnBoxDisplay.text = "å®ä½“"
				else ckbFnBoxDisplay.text = "BOXæ˜¾"
		for o in Geometry where (o.isHidden == false) do 
		(
			if ((classof o == BoneGeometry) or (classof o == Biped_Object)) then
			(
				if state == on then o.boxmode = on 
				else o.boxmode = off
			)
		)
	)
	
	on ckbFnMtlDisplay changed state do 
	(
		if state == off then
		(
			-- for mat in (getClassInstances vrayMtl processAllAnimatables:true) do showTextureMap mat on
			for mat in (getClassInstances standard processAllAnimatables:true) do showTextureMap mat on
		)
		else
		(
			-- for mat in (getClassInstances vrayMtl processAllAnimatables:true) do showTextureMap mat off
			for mat in (getClassInstances standard processAllAnimatables:true) do showTextureMap mat off
		)
	)

	on ckbFnMtlDisplay rightclick do 
	(
		local disp = NitrousGraphicsManager.GetActiveViewportSetting() 
		if disp.VisualStyleMode == #clay then disp.VisualStyleMode = #Realistic
		else disp.VisualStyleMode =  #clay
	)

	on btnMopherSlider pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\MorphSliders_11.ms"))
		catch(messagebox "æ‰“å¼€ MorphSliders_11.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnLayerManager rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\LayerManagerAlternative.ms"))
		catch(messagebox "æ‰“å¼€ ayerManagerAlternative.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnLayerManager pressed do 
	(
		if keyboard.controlpressed == true then
		(
			try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\nestedLayerManager.mzp"))
			catch(messagebox "æ‰“å¼€ nestedLayerManager.mzp å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
		)
		else
		(
			try(macros.run "Layers" "nestedLayerManagerMacro")
			catch
			(
				FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\nestedLayerManager.mzp")
			)
		)
	)

	on btnAnimMirror pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote" + "\\Anim_mirror.ms"))
		catch(messagebox "æ‰“å¼€ Anim_mirror.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on ckbIsoSelection changed stateIso do 
	(
		-- local arrTempSelObj = #()
		-- local arrTemp = objects as array
		-- local arrTempAllObj = for o in arrTemp where o.isHidden == false collect o
		-- local numTempCurrentSel = selection.count
		-- if arrTempAllObj.count > numTempCurrentSel then
		-- (
		-- 	if numTempCurrentSel != 0 then 
		-- 	(
		-- 		arrTempSelObj = selection as array
		-- 	)
		-- 	for i in arrTempSelObj where (arrTempSelObj.count != 0) do
		-- 	(
		-- 		num = finditem arrTempAllObj i
		-- 		if num != 0 then deleteItem arrTempAllObj num
		-- 	)
		-- 	arrTempUnSelection = arrTempAllObj
		-- 	actionMan.executeAction 0 "281"
		-- )
		if stateIso == true then
		(
			if selection.count != 0 then
			(
				if (not IsolateSelection.IsolateSelectionModeActive()) then
				(
					IsolateSelection.EnterIsolateSelectionMode()
					actionMan.executeAction 0 "40104"  -- Views: Undo Viewport Operation
				)
				else 
				(
					ckbIsoSelection.state = false
					IsolateSelection.ExitIsolateSelectionMode()
					actionMan.executeAction 0 "40104"  -- Views: Undo Viewport Operation
				)
			)
			else ckbIsoSelection.state = false
		)
		else
		(
			if (IsolateSelection.IsolateSelectionModeActive()) then 
			(
				IsolateSelection.ExitIsolateSelectionMode()
				actionMan.executeAction 0 "40104"  -- Views: Undo Viewport Operation
			)
		)
	)

	-- on ckbIsoSelection rightclick do
	-- (
	-- 	if arrTempUnSelection.count != 0 then
	-- 	(
	-- 		for i in arrTempUnSelection do i.isHidden = false
	-- 	)
	-- )

	on btnQuickPrev pressed do 
	(
		createPreview percentSize:100 \
		dspGeometry:true dspShapes:false dspLights:false \
		dspCameras:false dspHelpers:false dspParticles:true dspBones:false \
		dspGrid:true dspSafeFrame:false dspFrameNums:false dspBkg:true \
		rndLevel:#smoothhighlights
	)

	on btnQuickPrev rightclick do (shellLaunch (getdir #preview) "")

	on btnSelByColor pressed do
	(
		for i in selection as array where (i.ishidden == false) do
		(
			for o in objects as array where (i.ishidden == false) do
			(
				if o.wirecolor == i.wirecolor then selectmore o
			)
		)
	)

	on btnBipedScale pressed do (fnBipedScale ())

	on btnReplaceSkinBones pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\sox_replacebonefromskin.ms"))
		catch(messagebox "æ‰“å¼€ sox_replacebonefromskin.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnReplaceSkinBones rightclick do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\ChangeSkinBones.ms"))
		catch(messagebox "æ‰“å¼€ ChangeSkinBones.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnAnimCopyPaste pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\CPTools_New.ms"))
		catch(messagebox "æ‰“å¼€ CPTools_New.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnAnimCopyPaste rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\CPTools.ms"))
		catch(messagebox "æ‰“å¼€ CPTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnPoseTool pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsRefTools.ms"))
		catch(messagebox "æ‰“å¼€ BsRefTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnTrajedit pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\DTrajEdit.ms"))
		catch(messagebox "æ‰“å¼€ DTrajEdit.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnTrajedit rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\DTrajEdit_New.ms"))
		catch(messagebox "æ‰“å¼€ DTrajEdit_New.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnTrackBarTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts" + "\\BsTrackBarTools.ms"))
		catch(messagebox "æ‰“å¼€ BsTrackBarTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on ckbShadowCut changed state do
	(
		if state then
		(
			actionMan.executeAction 0 "63566"
			ambientColor = color 0 0 0
			lightTintColor = color 0 0 0
			redrawViews()
		)
		else 
		(
			ambientColor=color 0 0 0
			lightTintColor=color 255 255 255
			redrawViews()
		)
		deletekeys ambientColorController #allKeys
		deletekeys lightTintColorController #allKeys
	)

	on ckbShadowCut rightclick do 
	(
		actionMan.executeAction 0 "40029"  -- Render: Environment Dialog Toggle
	)

	on btnRenameTools pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\P_ObjectRenamer.ms"))
		catch(messagebox "æ‰“å¼€ P_ObjectRenamer.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnMirrorMoph pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\mirrormorph.ms"))
		catch(messagebox "æ‰“å¼€ mirrormorph.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnVportTools pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsVportTools.ms"))
		catch(messagebox "æ‰“å¼€ BsVportTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnMeshToBone pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\FractureVoronoi.ms"))
		catch(messagebox "æ‰“å¼€ FractureVoronoi.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnLightTable pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\LightTable.ms"))
		catch(messagebox "æ‰“å¼€ LightTable.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnCutSequence pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\AnimaRange.ms"))
		catch(messagebox "æ‰“å¼€ AnimaRange.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnTwistBones pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\twistbones.ms"))
		catch(messagebox "æ‰“å¼€ twistbones.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnChainsTools pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\ChainsTools.ms"))
		catch(messagebox "æ‰“å¼€ ChainsTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnBatchExport pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Batch version down.ms"))
		catch(messagebox "æ‰“å¼€ Batch version down.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnBatchExport rightclick do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Batch Import Convert.ms"))
		catch(messagebox "æ‰“å¼€ Batch Import Convert.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnFastAlign pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\alexanimalign_0.ms"))
		catch(messagebox "æ‰“å¼€ alexanimalign_0.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnCollider pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Collider.ms"))
		catch(messagebox "æ‰“å¼€ Collider.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnMassFX pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\MassFX.ms"))
		catch(messagebox "æ‰“å¼€ MassFX.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnPicker pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\UILayout_V1.01_HPK.ms"))
		catch(messagebox "æ‰“å¼€ UILayout_V1.01_HPK.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnPicker rightclick do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\objectPicker.ms"))
		catch(messagebox "æ‰“å¼€ objectPicker.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnBakeAnim pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\BakeAnim.ms"))
		catch(messagebox "æ‰“å¼€ BakeAnim.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnXpsConvert pressed do
	(
		try(messagebox "è‹¥å¯¼å…¥æŠ¥é”™ï¼Œå¯å°è¯•ç”¨é«˜ç‰ˆæœ¬ 3dsMax é‡æ–°å¯¼å…¥ï¼ŒåŸºæœ¬å¯è§£å†³ï¼                                       " beep:false title:"BsKeyTools";FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\XnaLara Converter.ms"))
		catch(messagebox "æ‰“å¼€ XnaLara Converter.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnCleanCustomAtts pressed do
	(
		if (queryBox "æ˜¯å¦æ¸…ç†å†—ä½™è‡ªå®šä¹‰å±æ€§ï¼Œ\r\n\r\nå¦‚ day1reCA å’Œ SimpleFaceData ï¼Ÿ\r\n\r\nè¯·æ³¨æ„å¤‡ä»½å’Œä¿å­˜æ–‡ä»¶ï¼                                               " \
		title:"BsKeyTools" beep:false) then
		(
			cusAtt = rootscene.custAttributes
			for i =1 to cusAtt.count do deleteItem cusAtt 1
		)
	)

	on btnLODCreate pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\lod_creator.ms"))
		catch(messagebox "æ‰“å¼€ lod_creator.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnMorpherCtrl pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\pxMorphSliders.ms"))
		catch(messagebox "æ‰“å¼€ pxMorphSliders.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnEndBone pressed do 
	(
		local tempLayerBoneEnd
		if (LayerManager.getLayerFromName "tempBoneEndAll") != undefined then
		(tempLayerBoneEnd = LayerManager.getLayerFromName "tempBoneEndAll")
		else (tempLayerBoneEnd = LayerManager.newLayerFromName "tempBoneEndAll")
		if selection.count != 0 then with undo on 
		(
			arrSel = selection as array
			for i in 1 to arrSel.count do
			(
				arrChild = (execute ("$'" + arrSel[i].name + "'/...*")) as array
				for c in arrChild where c.children.count == 0 do 
				(
					if (c != undefined) then 
					(
						parentBone = c
					)
					else (parentBone  = arrSel[i])
					parentTrans = parentBone.transform
					parentPos   = parentTrans.translation
			
					newBone = BoneSys.createBone parentPos (parentPos+6) parentBone.dir
					newBone.transform = parentTrans
					newBone.taper     = 90
			
					if iskindof arrSel[i] BoneGeometry==true do 
					(
						in coordSys Local move newBone [parentBone.length,0,0]
						newBone.parent    = parentBone
						newBone.width     = parentBone.width
						newBone.height    = parentBone.height
						newBone.length    = (parentBone.width+parentBone.height)/2
						newBone.wirecolor = parentBone.wirecolor
					)
					append arrBoneEndAll newBone
					tempLayerBoneEnd.addNode newBone
				)
			)
			messageBox "æ³¨æ„ï¼š\r\n\r\nç‚¹ç¡®å®šå®Œæˆæ·»åŠ ï¼Œ\r\n\r\nä¼šåˆ›å»ºæ–°å±‚å­˜æ”¾æœ«ç«¯ï¼Œ\r\n\r\né‡å¯è½¯ä»¶åæ— æ³•å›é€€ï¼Œ\r\n\r\nå¯ç‚¹å‡»å³é”®æˆ–æ‰‹åŠ¨æ¸…é™¤ä¹‹å‰æ·»åŠ çš„æœ«ç«¯ï¼Œ\r\n\r\nï¼ˆåœ¨ tempBoneEndAll å±‚ä¸­ï¼‰                                     "
		)
		else (messagebox "è¯·é€‰æ‹©è¦æ·»åŠ æœ«ç«¯çš„ Bone éª¨éª¼~                    " beep:false)
	)

	on btnEndBone rightclick do with undo on
	(
		if (LayerManager.getLayerFromName "tempBoneEndAll") != undefined then
		(
			tempLayerBoneEnd = LayerManager.getLayerFromName "tempBoneEndAll"
			tempLayerBoneEnd.nodes &arrLayerNodeTemp
			for i in arrLayerNodeTemp do delete i
			(LayerManager.getLayer 0).current = true
			LayerManager.deleteLayerByName "tempBoneEndAll"
			arrBoneEndAll = #()
			messagebox "ç‚¹ç¡®å®šæ¸…ç†æ·»åŠ çš„éª¨éª¼æœ«ç«¯ (åœ¨ tempBoneEndAll å±‚ä¸­çš„éª¨éª¼) ~          "
		)
	)

	on btnHideBipedTwists pressed do (fnGetAllBipedTwist())

	on btnDelDecimalKeys pressed do 
	(
		fnCollectKeys ()
		fnDelAllDecimalKeys arrBlockingKeys
		(messagebox "å·²æ¸…ç†æ‰€æœ‰å°æ•°å¸§ï¼ŒLinkå¸§è¯·è‡ªè¡Œæ¸…ç†                    " beep:false)
	)

	on btnRescaleWU pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsBatchRescaleWU.ms"))
		catch(messagebox "æ‰“å¼€ BsBatchRescaleWU.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnRescaleWU rightclick do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\RescaleWU.ms"))
		catch(messagebox "æ‰“å¼€ RescaleWU.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnSkinTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\SkinTools.ms"))
		catch(messagebox "æ‰“å¼€ SkinTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnTweenMachine pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\TweenMachine.ms"))
		catch(messagebox "æ‰“å¼€ BsKeyStepMode.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnSelectionsetTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsSelSetTools.ms"))
		catch(messagebox "æ‰“å¼€ BsSelSetTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)
	on btnXrSkinTool pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Xr_SkinTool.ms"))
		catch(messagebox "æ‰“å¼€ Xr_SkinTool.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnRetargetTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsRetargetTools.ms"))
		catch(messagebox "æ‰“å¼€ BsRetargetTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnCombineDetachSkin pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\Rigging_CombineSkin.ms"))
		catch(messagebox "æ‰“å¼€ Rigging_CombineSkin.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnRenderTools pressed do 
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\Quote\\å¤šæ–¹å‘æ¸²æŸ“å·¥å…·ï¼ˆé›†æˆä¿®æ”¹ç‰ˆï¼‰.ms"))
		catch(messagebox "æ‰“å¼€ å¤šæ–¹å‘æ¸²æŸ“å·¥å…·ï¼ˆé›†æˆä¿®æ”¹ç‰ˆï¼‰.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on btnElement mouseDown senderArg arg do
	(
		iconCurStr = (fnChangeBtnElement iconCurStr)
		iconElement = (iconPath + @"\\" + iconCurStr)
		btnElement.image = (fnDotnetBitmap iconElement)
	)

	on btnPrimogem mouseDown senderArg arg do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsScriptsSet.ms"))
		catch(messagebox "æ‰“å¼€ BsScriptsSet.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on ckbPerspLock changed state do
	(
		msgPersp = ""
		if state then 
		(
			registerRedrawViewsCallback fnOrthoToPersp 
			msgPersp = "å·²å¼€å¯"
			tooglePersp = true
		)
		else
		(
			unRegisterRedrawViewsCallback fnOrthoToPersp
			msgPersp = "å·²å…³é—­"
			tooglePersp = false
		)
		tooglePersp = (not tooglePersp)
		messagebox ("BsKeyToolsï¼šé€è§†é”å®šï¼ˆæ—‹è½¬é•œå¤´è‡ªåŠ¨æŒ‰ P è½¬é€è§†ï¼‰-- " + msgPersp + "                                ") beep:false title:"BsKeyTools" 
	)

	on btnDemoTool pressed do
	(
		try(FileIn ((getDir #scripts) + "\\BulletScripts\\BsAnimDemoTools.ms"))
		catch(messagebox "æ‰“å¼€ BsAnimDemoTools.ms å¤±è´¥ï¼Œå¯èƒ½è„šæœ¬é”™è¯¯æˆ–å®‰è£…ä¸å®Œå…¨ï¼Œ\r\n\r\nå»ºè®®æŸ¥çœ‹è®¾ç½®ä¸­çš„å¸®åŠ©æˆ–é‡æ–°å®‰è£…ï¼Œè¿˜æœ‰é—®é¢˜çƒ¦è¯·è”ç³»æˆ‘...                            " beep:false title:"BsKeyTools")
	)

	on dotLVFilesList DoubleClick do
	(		
		fnOpenRecentFile()
	)

	on dotLVFilesList mouseup sender args do
	(
		if args.Button == (dotNetClass "System.Windows.Forms.MouseButtons").Right do fnOpenRecentFilePath()
	)

	-- on ckbOpenConfigFilePath changed state do
	-- (
	-- 	ckbOpenConfigFilePath.state = true
	-- 	if (queryBox "æ˜¯å¦æ‰“å¼€é…ç½®æ–‡ä»¶ç›®å½•ï¼Ÿï¼ˆé…ç½®æ–‡ä»¶ï¼šBulletConfig.iniï¼‰\r\n\r\nã€å¦å­˜æˆ–æ›¿æ¢æ­¤æ–‡ä»¶å¯æ‰‹åŠ¨å¤„ç†å¤‡ä»½æˆ–å¯¼å…¥è„šæœ¬é…ç½®ã€‘                                                     " \
	-- 	title:"é…ç½®æ–‡ä»¶" beep:false) then (shellLaunch (getFilenamePath BulletConfig) "")
	-- )
	-- on ckbOpenConfigFilePath rightClick do
	-- (
	-- 	ckbOpenConfigFilePath.state = true
	-- 	if (queryBox "æ˜¯å¦æ‰“å¼€é…ç½®æ–‡ä»¶ç›®å½•ï¼Ÿï¼ˆé…ç½®æ–‡ä»¶ï¼šBulletConfig.iniï¼‰\r\n\r\nã€å¦å­˜æˆ–æ›¿æ¢æ­¤æ–‡ä»¶å¯æ‰‹åŠ¨å¤„ç†å¤‡ä»½æˆ–å¯¼å…¥è„šæœ¬é…ç½®ã€‘                                                     " \
	-- 	title:"é…ç½®æ–‡ä»¶" beep:false) then (shellLaunch (getFilenamePath BulletConfig) "")
	-- )
)
if (iniPos != 0) then (Createdialog rolBsKeyTools fgcolor:myFgColor pos:iniPos style:#())
else (Createdialog rolBsKeyTools fgcolor:myFgColor style:#())

fn fnBsUpdateTimeRange = 
(
	rolBsKeyTools.spiStartTime.value = (animationRange.start.frame as integer)   
	rolBsKeyTools.spiEndTime.value = (animationRange.end.frame as integer)
)

fnDelFileDir ((getDir #StartupScripts)+ "\\BsGetTimeCost.ms")

callbacks.addScript #animationRangeChange "fnBsUpdateTimeRange()" id:#BsUpdateTimeRange
callbacks.addScript #filePostOpen "fnBsRefFps()" id:#BsUpdateFps
callbacks.addScript #timeunitsChange "fnBsRefFps()" id:#BsUpdateFps
callbacks.addScript #filePostOpen "fnRefPlaySpeedValue()" id:#BsUpdatePlaySpeed
callbacks.addScript #timeunitsChange "fnRefPlaySpeedValue()" id:#BsUpdatePlaySpeed
callbacks.addScript #filePostOpen "rolBsKeyTools.fnRefreshRecentFileList()" id:#BsRefreshRecentFiles
-- gc()
clearListener()  ---------æ¸…é™¤ä¾¦å¬å™¨